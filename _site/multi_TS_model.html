<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Time Series Analysis - Multivariate TS Models (ARIMAX/SARIMAX/VAR)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Time Series Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About You</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ds.html"> 
<span class="menu-text">Data Sources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dv.html"> 
<span class="menu-text">Data Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./explore_analysis.html"> 
<span class="menu-text">Exploratory Data Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./uni_TS_model.html"> 
<span class="menu-text">Univariate TS Models (ARIMA/SARIMA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./multi_TS_model.html" aria-current="page"> 
<span class="menu-text">Multivariate TS Models (ARIMAX/SARIMAX/VAR)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./financial_time_series.html"> 
<span class="menu-text">Financial Time Series Models (ARCH/GARCH)</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./dl_time_series.ipynb"> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./others_analysis.html"> 
<span class="menu-text">Other: Interrupted TS/ARFIMA/ Spectral Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusions.html"> 
<span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#key-questions-and-model-equations" id="toc-key-questions-and-model-equations" class="nav-link active" data-scroll-target="#key-questions-and-model-equations">Key Questions and Model Equations:</a></li>
  <li><a href="#relationship-between-different-parts-of-the-healthcare-industry" id="toc-relationship-between-different-parts-of-the-healthcare-industry" class="nav-link" data-scroll-target="#relationship-between-different-parts-of-the-healthcare-industry">1. Relationship between different parts of the Healthcare Industry</a></li>
  <li><a href="#how-the-lifestyle-influences-the-mortality-rates-of-major-diseases" id="toc-how-the-lifestyle-influences-the-mortality-rates-of-major-diseases" class="nav-link" data-scroll-target="#how-the-lifestyle-influences-the-mortality-rates-of-major-diseases">2. How the lifestyle influences the mortality rates of major diseases?</a></li>
  <li><a href="#how-the-average-life-expectancy-of-the-us-be-influenced-by-the-mortality-rates-of-cancer-heart-diseases-diabetes-and-infant-mortality-rates" id="toc-how-the-average-life-expectancy-of-the-us-be-influenced-by-the-mortality-rates-of-cancer-heart-diseases-diabetes-and-infant-mortality-rates" class="nav-link" data-scroll-target="#how-the-average-life-expectancy-of-the-us-be-influenced-by-the-mortality-rates-of-cancer-heart-diseases-diabetes-and-infant-mortality-rates">3. How the average life expectancy of the US be influenced by the mortality rates of Cancer, Heart Diseases, Diabetes, and infant mortality rates?</a></li>
  <li><a href="#will-the-us-average-life-expectancy-increase-with-prescription-drug-expenditure" id="toc-will-the-us-average-life-expectancy-increase-with-prescription-drug-expenditure" class="nav-link" data-scroll-target="#will-the-us-average-life-expectancy-increase-with-prescription-drug-expenditure">4. Will the US Average Life Expectancy Increase with Prescription Drug Expenditure?</a></li>
  <li><a href="#how-public-health-crisiscovid-19-influences-the-financial-market-of-healthcare" id="toc-how-public-health-crisiscovid-19-influences-the-financial-market-of-healthcare" class="nav-link" data-scroll-target="#how-public-health-crisiscovid-19-influences-the-financial-market-of-healthcare">5. How Public Health Crisis(Covid-19) influences the financial market of Healthcare</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multivariate TS Models (ARIMAX/SARIMAX/VAR)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get the covid data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># covid &lt;- read_csv("data/COVID_usa_Vacc_new.csv")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># covid &lt;- covid %&gt;% </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(date, new_cases, new_vaccinations)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># covid$date &lt;- as.Date(covid$date, format = "%Y-%m-%d")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># covid$new_cases &lt;- as.double(covid$new_cases)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># covid$new_vaccacination &lt;- as.double(covid$new_vaccinations)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># #replace 0's with nas</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># covid$new_cases[covid$new_cases==0] = NA</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># covid$new_vaccinations[covid$new_vaccinations==0] = NA</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># #Missing Value Imputation by Last Observation Carried Forward</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># covid[,"new_cases"] = na_locf(covid[,"new_cases"],option = 'locf',na_remaining="rev")</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># covid[,"new_vaccinations"] = na_locf(covid[,"new_vaccinations"],option = 'locf',na_remaining="rev")</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># covid = covid[, c('date', 'new_cases', 'new_vaccinations')]</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># health_unique &lt;- health[!duplicated(health$date), ]</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># covid_unique &lt;- covid[!duplicated(covid$date), ]</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># health_stock_covid &lt;- merge(health_unique, covid_unique, by = "date")</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Import data of Public Health Outcomes</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # Average Life Expectancy</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># average_life_expectancy &lt;- read_xlsx("data/life_expectancy_7countries_2000_2022.xlsx")</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change it to long format</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># average_life_expectancy &lt;- average_life_expectancy %&gt;% </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols = -Year, </span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                names_to = "Country", </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = "Life_Expectancy")</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># average_life_expectancy$Year &lt;- as.Date(paste(average_life_expectancy$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># average_life_expectancy$Life_Expectancy &lt;- as.double(average_life_expectancy$Life_Expectancy)</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter to only include the US</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># average_life_expectancy &lt;- average_life_expectancy %&gt;% </span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Country == "United States")</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ale_ts &lt;- ts(average_life_expectancy$Life_Expectancy, start = c(year(min(average_life_expectancy$Year)), month(min(average_life_expectancy$Year))), end = c(year(max(average_life_expectancy$Year)), month(max(average_life_expectancy$Year))), frequency = 1) # Yearly data</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of deaths due to major diseases</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># death_cancer &lt;- read_xlsx("data/deaths_cancer_us_1950_2019.xlsx")</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># death_heart &lt;- read_xlsx("data/deaths_heart_diseases_us_1950_2019.xlsx")</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># death_diabetes &lt;- read_xlsx("data/deaths_diabetes_us_1950_2019.xlsx")</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # Merge these three datasets</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases &lt;- merge(death_cancer, death_heart, by = "Year")</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases &lt;- merge(death_major_diseases, death_diabetes, by = "Year")</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a new column for total deaths</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases$Total_Deaths &lt;- death_major_diseases$Death_Cancer + death_major_diseases$Death_Heart_Disease + death_major_diseases$Death_Diabetes</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases$Year &lt;- as.Date(paste(death_major_diseases$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases$Death_Cancer &lt;- as.double(death_major_diseases$Death_Cancer)</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases$Death_Heart_Disease &lt;- as.double(death_major_diseases$Death_Heart_Disease)</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># death_major_diseases$Death_Diabetes &lt;- as.double(death_major_diseases$Death_Diabetes)</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co"># major_diseases_ts &lt;- ts(death_major_diseases$Total_Deaths, start = c(year(min(death_major_diseases$Year)), month(min(death_major_diseases$Year))), end = c(year(max(death_major_diseases$Year)), month(max(death_major_diseases$Year))), frequency = 1) # Yearly data</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of infant mortality rates</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co"># infant_mortality &lt;- read_xlsx("data/infant_mortality_rate_us_1990_2021.xlsx")</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co"># infant_mortality$Year &lt;- as.Date(paste(infant_mortality$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># infant_mortality$Infant_Mortality_Rates &lt;- as.double(infant_mortality$Infant_Mortality_Rates)</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co"># infant_mortality_ts &lt;- ts(infant_mortality$Infant_Mortality_Rates, start = c(year(min(infant_mortality$Year)), month(min(infant_mortality$Year))), end = c(year(max(infant_mortality$Year)), month(max(infant_mortality$Year))), frequency = 1) # Yearly data</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of share of people without health insurance</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co"># health_insurance &lt;- read_xlsx("data/share_of_people_us_without_health_insurance_age_1997_2022.xlsx")</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="co"># health_insurance$Year &lt;- as.Date(paste(health_insurance$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change it to long format</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="co"># health_insurance &lt;- health_insurance %&gt;% </span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols = -Year, </span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co">#                names_to = "Age_Group", </span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = "Percentage")</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co"># # Filter to all ages </span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="co"># health_insurance &lt;- health_insurance %&gt;% </span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Age_Group == "All ages")</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="co"># health_insurance_ts &lt;- ts(health_insurance$Percentage, start = c(year(min(health_insurance$Year)), month(min(health_insurance$Year))), end = c(year(max(health_insurance$Year)), month(max(health_insurance$Year))), frequency = 1) # Yearly data</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of emergency room visits</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="co"># emergency_room &lt;- read_xlsx("data/us_emergency_room_visits_1997_2019_by_age.xlsx")</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change it to long format</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="co"># emergency_room &lt;- emergency_room %&gt;% </span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols = -Year, </span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co">#                names_to = "Age_Group", </span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = "Visits_Percent")</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co"># emergency_room$Year &lt;- as.Date(paste(emergency_room$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get the average visits percentage for all ages</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co"># emergency_room &lt;- emergency_room %&gt;% </span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Year) %&gt;%</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(Average_Visits_Percent = mean(Visits_Percent))</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># emergency_room_ts &lt;- ts(emergency_room$Average_Visits_Percent, start = c(year(min(emergency_room$Year)), month(min(emergency_room$Year))), end = c(year(max(emergency_room$Year)), month(max(emergency_room$Year))), frequency = 1)</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of prescription drug expenditure</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co"># prescription_drug &lt;- read_xlsx("data/prescription_drug_expenditure_us_1960_2022.xlsx")</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="co"># prescription_drug$Year &lt;- as.Date(paste(prescription_drug$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="co"># prescription_drug_ts &lt;- ts(prescription_drug$Expenditure, start = c(year(min(prescription_drug$Year)), month(min(prescription_drug$Year))), end = c(year(max(prescription_drug$Year)), month(max(prescription_drug$Year))), frequency = 1)</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of GDP by industry</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_industry &lt;- read_csv("data/GDP_by_Industry.csv", skip = 4) %&gt;%</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(-Line)</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(gdp_industry) &lt;- c("Industry", "2018-Q1", "2018-Q2", "2018-Q3", "2018-Q4", "2019-Q1", "2019-Q2", "2019-Q3", "2019-Q4", "2020-Q1", "2020-Q2", "2020-Q3", "2020-Q4", "2021-Q1", "2021-Q2", "2021-Q3", "2021-Q4", "2022-Q1", "2022-Q2", "2022-Q3", "2022-Q4", "2023-Q1", "2023-Q2", "2023-Q3")</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare &lt;- gdp_industry %&gt;%</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">#            (Industry == "Health care and social assistance")</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Change it to long format</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare &lt;- gdp_healthcare %&gt;%</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols = -Industry, </span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co">#                names_to = "Date", </span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = "GDP")</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change date to Date format</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare$Date &lt;- as.yearqtr(gdp_healthcare$Date, format = "%Y-Q%q")</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare$Date &lt;- as.Date(gdp_healthcare$Date)</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare$GDP &lt;- as.double(gdp_healthcare$GDP)</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare &lt;- gdp_healthcare %&gt;%</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a><span class="co">#     year = year(Date)</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="co"># gdp_healthcare_ts &lt;- ts(gdp_healthcare$GDP, start = c(year(min(gdp_healthcare$Date))), end = c(year(max(gdp_healthcare$Date))), frequency = 4) # Quarterly data</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of number of adult smokers</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="co"># adult_smokers &lt;- read_xlsx("data/number_of_adult_smokers_us_1965_2021.xlsx")</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a><span class="co"># adult_smokers$Year &lt;- as.Date(paste(adult_smokers$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co"># adult_smokers_ts &lt;- ts(adult_smokers$Number, start = c(year(min(adult_smokers$Year)), month(min(adult_smokers$Year))), end = c(year(max(adult_smokers$Year)), month(max(adult_smokers$Year))), frequency = 1)</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a><span class="co"># # Importing the dataset of per capita alcohol consumption</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a><span class="co"># alcohol_consumption &lt;- read_xlsx("data/per_capita_alcohol_consumption_of_all_beverages_us_1850_2021.xlsx")</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="co"># # Change Date format</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="co"># alcohol_consumption$Year &lt;- as.Date(paste(alcohol_consumption$Year, "01", "01", sep = "-"), format = "%Y-%m-%d")</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create time series</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="co"># alcohol_consumption_ts &lt;- ts(alcohol_consumption$Consumption, start = c(year(min(alcohol_consumption$Year)), month(min(alcohol_consumption$Year))), end = c(year(max(alcohol_consumption$Year)), month(max(alcohol_consumption$Year))), frequency = 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="key-questions-and-model-equations" class="level1">
<h1>Key Questions and Model Equations:</h1>
<ol type="1">
<li>What’s the relationship between different parts of the Healthcare Industry? (Yousaf, Pham, &amp; Goodwill, 2023)</li>
</ol>
<ul>
<li><strong>(VAR) Pfizer Stock ~ Vertex stock + TEVA stock + SAGE stock</strong></li>
</ul>
<ol start="2" type="1">
<li>How the lifestyle influences the mortality rates of major diseases?</li>
</ol>
<ul>
<li><strong>(VAR) Mortality rates of major disease(Cancer, Heart Disease, Diabetes) ~ Smoking Prevalance + Alcohol Consumption</strong></li>
</ul>
<ol start="3" type="1">
<li>How the average life expectancy of the US be influenced by the mortality rates of Cancer, Heart Diseases, Diabetes, and infant mortality rates? (Adu, Appiahene, Afrifa, 2023)</li>
</ol>
<ul>
<li><strong>(ARIMAX) Average Life Expectancy ~ Mortality rates of major disease(Cancer, Heart Diseases, Diabetes) + Infant Mortality rates</strong></li>
</ul>
<ol start="4" type="1">
<li>Will the US Average Life Expectancy Increase with Prescription Drug Expenditure?</li>
</ol>
<ul>
<li><strong>(VAR) Average Life Expectancy ~ Prescription Drug Expenditure</strong></li>
</ul>
<ol start="5" type="1">
<li>How Public Health Crisis(Covid-19) influences the financial market of Healthcare <strong>(Still have two parts to finish)</strong></li>
</ol>
<ul>
<li><strong>(ARIMAX) Pfizer Stock ~ Vertex stock + TEVA stock + SAGE stock + Covid-19 Cases</strong></li>
</ul>
</section>
<section id="relationship-between-different-parts-of-the-healthcare-industry" class="level1">
<h1>1. Relationship between different parts of the Healthcare Industry</h1>
<p><strong>(VAR)Pfizer stock ~ Vertex stock + Teva stock + SAGE stock</strong></p>
<p>We chose these stocks because they can each represent different pharmaceutical companies. Pfizer is a large pharmaceutical company, Vertex is a biotech company, Teva is a drug company, and SAGE is a small biotech company. They play different roles in the pharmaceutical industry, and <strong>Pfizer was chosen as our primary research subject</strong> because it made the COVID-19 vaccines. It has substantial market cap and prominent role in pharmaceuticals.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Data Visualization</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">VARselect</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Initial Model Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Cross-validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Model Creation and Diagnostics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Forecasting</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>Pfizer (PFE)</strong> shows a generally positive trend over a long period with some volatility, indicating periods of growth and market confidence, reflecting successful product launches(vaccine). <strong>Vertex Pharmaceuticals (VRTX)</strong> shows steady growth over time, but a huge drop in 2022. <strong>Teva Pharmaceutical(TEVA)</strong>shows a peak followed by a decline and then a period of stable with volatility. <strong>Sage Therapeutics (SAGE)</strong>, as a smaller biotech company, it shows significant volatility, which is typical for such firms. Spikes in the stock price might correspond to positive news about drug trials or FDA approvals, while declines may indicate setbacks in development or other challenges.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stock_ts <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pharma_ts, biotech_ts, drug_ts, small_biotech_ts)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(stock_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pharma"</span>, <span class="st">"biotech"</span>, <span class="st">"drug"</span>, <span class="st">"small_biotech"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(stock_ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/dv_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>As we can see from the results, the p recommended by VARselect() are 10 and 1.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(stock_ts, <span class="at">lag.max=</span><span class="dv">10</span>, <span class="at">type=</span><span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
    10      1      1     10 

$criteria
               1         2         3         4         5         6         7
AIC(n)  2.357832  2.352112  2.358823  2.355605  2.356543  2.354853  2.358775
HQ(n)   2.390402  2.406394  2.434818  2.453314  2.475964  2.495988  2.521623
SC(n)   2.445117  2.497586  2.562486  2.617458  2.676585  2.733085  2.795197
FPE(n) 10.568020 10.507745 10.578518 10.544564 10.554498 10.536746 10.578239
               8         9        10
AIC(n)  2.365996  2.371767  2.349877
HQ(n)   2.550557  2.578041  2.577863
SC(n)   2.860607  2.924568  2.960867
FPE(n) 10.655015 10.716828 10.484958</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>As we can see from the results, VAR(1) model is better than VAR(10) model, based on the residual errors and significance of the coefficients. What’s more, except small-biotech stock, all the other stocks are correlated with each other.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitvar1<span class="ot">&lt;-</span>vars<span class="sc">::</span><span class="fu">VAR</span>(stock_ts, <span class="at">p=</span><span class="dv">10</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: pharma, biotech, drug, small_biotech 
Deterministic variables: both 
Sample size: 1452 
Log Likelihood: -9779.206 
Roots of the characteristic polynomial:
0.9925 0.9925 0.9897 0.8963 0.8963 0.8844 0.8844 0.8304 0.8304 0.8153 0.8153 0.8109 0.8109 0.7968 0.7968 0.7622 0.7622 0.7443 0.7443 0.7417 0.7417 0.7309 0.7309 0.7126 0.7126 0.7122 0.7122 0.7091 0.7091 0.6601 0.6292 0.6292 0.6236 0.6236 0.6151 0.6151 0.5956 0.5956 0.5617 0.5617
Call:
vars::VAR(y = stock_ts, p = 10, type = "both")


Estimation results for equation pharma: 
======================================= 
pharma = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + pharma.l2 + biotech.l2 + drug.l2 + small_biotech.l2 + pharma.l3 + biotech.l3 + drug.l3 + small_biotech.l3 + pharma.l4 + biotech.l4 + drug.l4 + small_biotech.l4 + pharma.l5 + biotech.l5 + drug.l5 + small_biotech.l5 + pharma.l6 + biotech.l6 + drug.l6 + small_biotech.l6 + pharma.l7 + biotech.l7 + drug.l7 + small_biotech.l7 + pharma.l8 + biotech.l8 + drug.l8 + small_biotech.l8 + pharma.l9 + biotech.l9 + drug.l9 + small_biotech.l9 + pharma.l10 + biotech.l10 + drug.l10 + small_biotech.l10 + const + trend 

                    Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1          9.655e-01  2.714e-02  35.574  &lt; 2e-16 ***
biotech.l1        -5.299e-03  2.463e-03  -2.151 0.031614 *  
drug.l1           -6.689e-02  5.996e-02  -1.116 0.264722    
small_biotech.l1  -6.720e-03  7.606e-03  -0.884 0.377107    
pharma.l2          3.605e-03  3.796e-02   0.095 0.924352    
biotech.l2         4.074e-03  3.393e-03   1.201 0.230079    
drug.l2            1.020e-01  8.545e-02   1.194 0.232600    
small_biotech.l2   1.078e-02  1.089e-02   0.989 0.322663    
pharma.l3          7.828e-02  3.799e-02   2.060 0.039556 *  
biotech.l3         5.924e-04  3.393e-03   0.175 0.861434    
drug.l3            4.240e-02  8.557e-02   0.495 0.620355    
small_biotech.l3   7.559e-03  1.090e-02   0.693 0.488192    
pharma.l4         -5.744e-02  3.813e-02  -1.506 0.132203    
biotech.l4         3.194e-03  3.394e-03   0.941 0.346825    
drug.l4           -2.166e-01  8.554e-02  -2.532 0.011449 *  
small_biotech.l4  -1.360e-02  1.089e-02  -1.249 0.211983    
pharma.l5          5.466e-02  3.812e-02   1.434 0.151815    
biotech.l5        -6.002e-03  3.404e-03  -1.763 0.078050 .  
drug.l5            3.085e-01  8.568e-02   3.601 0.000328 ***
small_biotech.l5  -4.774e-03  1.092e-02  -0.437 0.662152    
pharma.l6         -8.343e-02  3.800e-02  -2.195 0.028307 *  
biotech.l6         2.726e-03  3.406e-03   0.800 0.423636    
drug.l6           -3.008e-01  8.586e-02  -3.503 0.000474 ***
small_biotech.l6   1.137e-02  1.093e-02   1.041 0.298131    
pharma.l7          1.758e-02  3.793e-02   0.463 0.643151    
biotech.l7        -1.808e-03  3.398e-03  -0.532 0.594844    
drug.l7            6.673e-02  8.569e-02   0.779 0.436274    
small_biotech.l7  -1.537e-03  1.093e-02  -0.141 0.888194    
pharma.l8         -1.153e-02  3.788e-02  -0.304 0.760957    
biotech.l8         2.563e-03  3.404e-03   0.753 0.451754    
drug.l8           -6.665e-02  8.564e-02  -0.778 0.436508    
small_biotech.l8  -6.567e-03  1.093e-02  -0.601 0.548074    
pharma.l9          1.085e-01  3.782e-02   2.867 0.004201 ** 
biotech.l9         5.615e-03  3.406e-03   1.648 0.099474 .  
drug.l9            1.352e-01  8.545e-02   1.582 0.113822    
small_biotech.l9   2.195e-02  1.094e-02   2.007 0.044956 *  
pharma.l10        -8.871e-02  2.695e-02  -3.292 0.001021 ** 
biotech.l10       -7.045e-03  2.461e-03  -2.862 0.004271 ** 
drug.l10          -5.664e-02  6.006e-02  -0.943 0.345758    
small_biotech.l10 -2.088e-02  7.663e-03  -2.725 0.006513 ** 
const              1.468e+00  2.893e-01   5.075 4.39e-07 ***
trend              8.407e-06  4.015e-05   0.209 0.834193    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.6332 on 1410 degrees of freedom
Multiple R-Squared: 0.9917, Adjusted R-squared: 0.9915 
F-statistic:  4119 on 41 and 1410 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation biotech: 
======================================== 
biotech = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + pharma.l2 + biotech.l2 + drug.l2 + small_biotech.l2 + pharma.l3 + biotech.l3 + drug.l3 + small_biotech.l3 + pharma.l4 + biotech.l4 + drug.l4 + small_biotech.l4 + pharma.l5 + biotech.l5 + drug.l5 + small_biotech.l5 + pharma.l6 + biotech.l6 + drug.l6 + small_biotech.l6 + pharma.l7 + biotech.l7 + drug.l7 + small_biotech.l7 + pharma.l8 + biotech.l8 + drug.l8 + small_biotech.l8 + pharma.l9 + biotech.l9 + drug.l9 + small_biotech.l9 + pharma.l10 + biotech.l10 + drug.l10 + small_biotech.l10 + const + trend 

                    Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1         -0.5394701  0.3307112  -1.631  0.10306    
biotech.l1         0.9374168  0.0300145  31.232  &lt; 2e-16 ***
drug.l1           -1.4363837  0.7305535  -1.966  0.04948 *  
small_biotech.l1  -0.1375213  0.0926745  -1.484  0.13805    
pharma.l2          0.2732731  0.4625105   0.591  0.55472    
biotech.l2         0.0799656  0.0413446   1.934  0.05330 .  
drug.l2            0.6845236  1.0411831   0.657  0.51100    
small_biotech.l2   0.2115728  0.1327460   1.594  0.11120    
pharma.l3          0.6956494  0.4629651   1.503  0.13317    
biotech.l3        -0.1185444  0.0413455  -2.867  0.00420 ** 
drug.l3            2.5388051  1.0426828   2.435  0.01502 *  
small_biotech.l3  -0.1735611  0.1328426  -1.307  0.19159    
pharma.l4         -0.8436640  0.4646582  -1.816  0.06963 .  
biotech.l4         0.0852964  0.0413570   2.062  0.03935 *  
drug.l4           -1.5481429  1.0423288  -1.485  0.13770    
small_biotech.l4   0.1004235  0.1327192   0.757  0.44938    
pharma.l5          0.5638751  0.4644401   1.214  0.22491    
biotech.l5        -0.0008106  0.0414726  -0.020  0.98441    
drug.l5            0.2396961  1.0440281   0.230  0.81845    
small_biotech.l5  -0.0933255  0.1330992  -0.701  0.48331    
pharma.l6         -0.7427872  0.4630731  -1.604  0.10893    
biotech.l6        -0.0503808  0.0415044  -1.214  0.22500    
drug.l6           -0.7064417  1.0462163  -0.675  0.49964    
small_biotech.l6   0.0652105  0.1331520   0.490  0.62439    
pharma.l7          0.3714212  0.4622259   0.804  0.42179    
biotech.l7         0.1121950  0.0414046   2.710  0.00682 ** 
drug.l7           -0.7947298  1.0440870  -0.761  0.44668    
small_biotech.l7   0.1869697  0.1332014   1.404  0.16064    
pharma.l8         -0.2217761  0.4616055  -0.480  0.63099    
biotech.l8        -0.1051238  0.0414831  -2.534  0.01138 *  
drug.l8           -0.3286745  1.0434655  -0.315  0.75282    
small_biotech.l8  -0.3386215  0.1331950  -2.542  0.01112 *  
pharma.l9          0.8171618  0.4608944   1.773  0.07645 .  
biotech.l9         0.1072026  0.0415069   2.583  0.00990 ** 
drug.l9            1.1643985  1.0411697   1.118  0.26361    
small_biotech.l9   0.3889292  0.1332582   2.919  0.00357 ** 
pharma.l10        -0.4393476  0.3283823  -1.338  0.18114    
biotech.l10       -0.0658918  0.0299908  -2.197  0.02818 *  
drug.l10          -0.3742151  0.7317882  -0.511  0.60917    
small_biotech.l10 -0.2463090  0.0933743  -2.638  0.00843 ** 
const             14.5976426  3.5245187   4.142 3.65e-05 ***
trend             -0.0000865  0.0004893  -0.177  0.85970    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 7.716 on 1410 degrees of freedom
Multiple R-Squared: 0.9808, Adjusted R-squared: 0.9802 
F-statistic:  1756 on 41 and 1410 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation drug: 
===================================== 
drug = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + pharma.l2 + biotech.l2 + drug.l2 + small_biotech.l2 + pharma.l3 + biotech.l3 + drug.l3 + small_biotech.l3 + pharma.l4 + biotech.l4 + drug.l4 + small_biotech.l4 + pharma.l5 + biotech.l5 + drug.l5 + small_biotech.l5 + pharma.l6 + biotech.l6 + drug.l6 + small_biotech.l6 + pharma.l7 + biotech.l7 + drug.l7 + small_biotech.l7 + pharma.l8 + biotech.l8 + drug.l8 + small_biotech.l8 + pharma.l9 + biotech.l9 + drug.l9 + small_biotech.l9 + pharma.l10 + biotech.l10 + drug.l10 + small_biotech.l10 + const + trend 

                    Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1         -1.128e-02  1.321e-02  -0.854  0.39310    
biotech.l1        -8.603e-04  1.199e-03  -0.718  0.47305    
drug.l1            9.889e-01  2.917e-02  33.897  &lt; 2e-16 ***
small_biotech.l1   3.841e-03  3.701e-03   1.038  0.29952    
pharma.l2          1.334e-02  1.847e-02   0.722  0.47039    
biotech.l2         4.731e-03  1.651e-03   2.865  0.00423 ** 
drug.l2           -6.208e-02  4.158e-02  -1.493  0.13566    
small_biotech.l2   3.736e-03  5.301e-03   0.705  0.48107    
pharma.l3         -2.260e-02  1.849e-02  -1.223  0.22167    
biotech.l3        -3.639e-03  1.651e-03  -2.204  0.02768 *  
drug.l3            7.669e-02  4.164e-02   1.842  0.06571 .  
small_biotech.l3  -1.811e-03  5.305e-03  -0.341  0.73284    
pharma.l4          3.595e-02  1.856e-02   1.937  0.05291 .  
biotech.l4        -2.728e-03  1.652e-03  -1.652  0.09878 .  
drug.l4            5.328e-02  4.163e-02   1.280  0.20075    
small_biotech.l4  -1.595e-02  5.300e-03  -3.009  0.00267 ** 
pharma.l5         -1.959e-02  1.855e-02  -1.056  0.29096    
biotech.l5         1.852e-03  1.656e-03   1.118  0.26366    
drug.l5           -1.293e-02  4.169e-02  -0.310  0.75659    
small_biotech.l5   7.352e-03  5.315e-03   1.383  0.16683    
pharma.l6          1.189e-02  1.849e-02   0.643  0.52027    
biotech.l6        -1.978e-03  1.657e-03  -1.193  0.23301    
drug.l6           -8.702e-02  4.178e-02  -2.083  0.03745 *  
small_biotech.l6   4.756e-03  5.317e-03   0.894  0.37127    
pharma.l7         -2.629e-02  1.846e-02  -1.424  0.15464    
biotech.l7         2.646e-03  1.653e-03   1.600  0.10980    
drug.l7            5.727e-02  4.170e-02   1.374  0.16980    
small_biotech.l7   6.565e-03  5.319e-03   1.234  0.21736    
pharma.l8          1.040e-02  1.843e-02   0.564  0.57279    
biotech.l8        -1.959e-03  1.657e-03  -1.183  0.23712    
drug.l8           -4.526e-02  4.167e-02  -1.086  0.27765    
small_biotech.l8  -1.129e-02  5.319e-03  -2.123  0.03394 *  
pharma.l9          3.580e-02  1.841e-02   1.945  0.05200 .  
biotech.l9         4.124e-03  1.658e-03   2.488  0.01296 *  
drug.l9           -4.726e-02  4.158e-02  -1.137  0.25592    
small_biotech.l9   6.399e-03  5.322e-03   1.203  0.22936    
pharma.l10        -3.207e-02  1.311e-02  -2.446  0.01458 *  
biotech.l10       -2.331e-03  1.198e-03  -1.946  0.05184 .  
drug.l10           3.304e-02  2.922e-02   1.130  0.25849    
small_biotech.l10 -3.268e-03  3.729e-03  -0.876  0.38101    
const              6.302e-01  1.408e-01   4.477 8.17e-06 ***
trend             -3.409e-06  1.954e-05  -0.174  0.86153    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.3081 on 1410 degrees of freedom
Multiple R-Squared: 0.9525, Adjusted R-squared: 0.9511 
F-statistic: 689.9 on 41 and 1410 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation small_biotech: 
============================================== 
small_biotech = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + pharma.l2 + biotech.l2 + drug.l2 + small_biotech.l2 + pharma.l3 + biotech.l3 + drug.l3 + small_biotech.l3 + pharma.l4 + biotech.l4 + drug.l4 + small_biotech.l4 + pharma.l5 + biotech.l5 + drug.l5 + small_biotech.l5 + pharma.l6 + biotech.l6 + drug.l6 + small_biotech.l6 + pharma.l7 + biotech.l7 + drug.l7 + small_biotech.l7 + pharma.l8 + biotech.l8 + drug.l8 + small_biotech.l8 + pharma.l9 + biotech.l9 + drug.l9 + small_biotech.l9 + pharma.l10 + biotech.l10 + drug.l10 + small_biotech.l10 + const + trend 

                    Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1         -1.711e-01  1.015e-01  -1.686   0.0921 .  
biotech.l1         7.012e-03  9.214e-03   0.761   0.4468    
drug.l1            7.975e-03  2.243e-01   0.036   0.9716    
small_biotech.l1   1.039e+00  2.845e-02  36.509   &lt;2e-16 ***
pharma.l2          2.631e-01  1.420e-01   1.853   0.0641 .  
biotech.l2        -1.640e-02  1.269e-02  -1.293   0.1964    
drug.l2            9.605e-02  3.196e-01   0.301   0.7638    
small_biotech.l2  -6.604e-02  4.075e-02  -1.621   0.1053    
pharma.l3         -1.736e-01  1.421e-01  -1.221   0.2222    
biotech.l3         2.317e-02  1.269e-02   1.826   0.0681 .  
drug.l3           -3.106e-01  3.201e-01  -0.970   0.3320    
small_biotech.l3   3.491e-02  4.078e-02   0.856   0.3921    
pharma.l4          1.145e-01  1.426e-01   0.803   0.4221    
biotech.l4        -1.092e-02  1.270e-02  -0.860   0.3900    
drug.l4            2.837e-01  3.200e-01   0.886   0.3755    
small_biotech.l4  -2.376e-02  4.074e-02  -0.583   0.5599    
pharma.l5         -1.511e-01  1.426e-01  -1.060   0.2895    
biotech.l5        -8.980e-03  1.273e-02  -0.705   0.4807    
drug.l5            2.016e-01  3.205e-01   0.629   0.5294    
small_biotech.l5  -3.130e-02  4.086e-02  -0.766   0.4438    
pharma.l6          7.105e-02  1.422e-01   0.500   0.6173    
biotech.l6        -5.298e-03  1.274e-02  -0.416   0.6776    
drug.l6           -4.770e-01  3.212e-01  -1.485   0.1377    
small_biotech.l6   2.295e-02  4.088e-02   0.561   0.5746    
pharma.l7          5.261e-02  1.419e-01   0.371   0.7109    
biotech.l7         1.037e-02  1.271e-02   0.816   0.4147    
drug.l7            2.947e-01  3.205e-01   0.919   0.3580    
small_biotech.l7   7.281e-03  4.089e-02   0.178   0.8587    
pharma.l8          5.686e-02  1.417e-01   0.401   0.6883    
biotech.l8        -1.173e-02  1.273e-02  -0.921   0.3571    
drug.l8            2.023e-01  3.203e-01   0.632   0.5278    
small_biotech.l8   1.783e-03  4.089e-02   0.044   0.9652    
pharma.l9          5.435e-02  1.415e-01   0.384   0.7009    
biotech.l9         1.833e-02  1.274e-02   1.438   0.1506    
drug.l9           -1.789e-01  3.196e-01  -0.560   0.5757    
small_biotech.l9   5.691e-02  4.091e-02   1.391   0.1644    
pharma.l10        -1.250e-01  1.008e-01  -1.240   0.2153    
biotech.l10       -3.745e-03  9.207e-03  -0.407   0.6843    
drug.l10          -1.382e-01  2.246e-01  -0.615   0.5386    
small_biotech.l10 -4.822e-02  2.866e-02  -1.682   0.0928 .  
const              3.010e-01  1.082e+00   0.278   0.7809    
trend              3.827e-05  1.502e-04   0.255   0.7989    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 2.369 on 1410 degrees of freedom
Multiple R-Squared: 0.9842, Adjusted R-squared: 0.9838 
F-statistic:  2149 on 41 and 1410 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
               pharma biotech    drug small_biotech
pharma        0.40096  0.2439 0.02854       0.27136
biotech       0.24387 59.5311 0.87782      -4.91190
drug          0.02854  0.8778 0.09494       0.03908
small_biotech 0.27136 -4.9119 0.03908       5.61017

Correlation matrix of residuals:
               pharma  biotech    drug small_biotech
pharma        1.00000  0.04992 0.14629       0.18093
biotech       0.04992  1.00000 0.36924      -0.26878
drug          0.14629  0.36924 1.00000       0.05355
small_biotech 0.18093 -0.26878 0.05355       1.00000</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitvar2<span class="ot">&lt;-</span>vars<span class="sc">::</span><span class="fu">VAR</span>(stock_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: pharma, biotech, drug, small_biotech 
Deterministic variables: both 
Sample size: 1461 
Log Likelihood: -9983.058 
Roots of the characteristic polynomial:
0.9909 0.9906 0.9906 0.9577
Call:
vars::VAR(y = stock_ts, p = 1, type = "both")


Estimation results for equation pharma: 
======================================= 
pharma = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + const + trend 

                   Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1         9.893e-01  2.904e-03 340.707  &lt; 2e-16 ***
biotech.l1       -1.155e-03  3.870e-04  -2.985  0.00288 ** 
drug.l1          -4.275e-02  1.430e-02  -2.989  0.00285 ** 
small_biotech.l1 -1.824e-03  1.195e-03  -1.526  0.12722    
const             1.200e+00  2.582e-01   4.647 3.68e-06 ***
trend             4.345e-06  4.038e-05   0.108  0.91432    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.6451 on 1455 degrees of freedom
Multiple R-Squared: 0.9912, Adjusted R-squared: 0.9911 
F-statistic: 3.259e+04 on 5 and 1455 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation biotech: 
======================================== 
biotech = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + const + trend 

                   Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1        -0.0618969  0.0352756  -1.755  0.07953 .  
biotech.l1        0.9826416  0.0047016 209.002  &lt; 2e-16 ***
drug.l1          -0.5104846  0.1737440  -2.938  0.00335 ** 
small_biotech.l1 -0.0319371  0.0145236  -2.199  0.02804 *  
const            13.4257467  3.1367749   4.280 1.99e-05 ***
trend            -0.0001188  0.0004906  -0.242  0.80864    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 7.837 on 1455 degrees of freedom
Multiple R-Squared: 0.9796, Adjusted R-squared: 0.9795 
F-statistic: 1.396e+04 on 5 and 1455 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation drug: 
===================================== 
drug = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + const + trend 

                   Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1        -2.885e-03  1.416e-03  -2.037 0.041826 *  
biotech.l1        2.219e-05  1.888e-04   0.118 0.906420    
drug.l1           9.642e-01  6.976e-03 138.222  &lt; 2e-16 ***
small_biotech.l1  6.788e-04  5.831e-04   1.164 0.244607    
const             4.220e-01  1.259e-01   3.351 0.000826 ***
trend            -6.794e-06  1.970e-05  -0.345 0.730207    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.3147 on 1455 degrees of freedom
Multiple R-Squared: 0.949,  Adjusted R-squared: 0.9488 
F-statistic:  5413 on 5 and 1455 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation small_biotech: 
============================================== 
small_biotech = pharma.l1 + biotech.l1 + drug.l1 + small_biotech.l1 + const + trend 

                   Estimate Std. Error t value Pr(&gt;|t|)    
pharma.l1        -6.191e-03  1.062e-02  -0.583    0.560    
biotech.l1        1.889e-03  1.416e-03   1.334    0.183    
drug.l1           5.867e-03  5.233e-02   0.112    0.911    
small_biotech.l1  9.937e-01  4.374e-03 227.149   &lt;2e-16 ***
const            -5.266e-02  9.448e-01  -0.056    0.956    
trend             3.358e-05  1.478e-04   0.227    0.820    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 2.361 on 1455 degrees of freedom
Multiple R-Squared: 0.984,  Adjusted R-squared: 0.984 
F-statistic: 1.794e+04 on 5 and 1455 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
               pharma biotech    drug small_biotech
pharma        0.41618  0.4514 0.03365       0.27877
biotech       0.45144 61.4255 0.92748      -4.64132
drug          0.03365  0.9275 0.09902       0.04706
small_biotech 0.27877 -4.6413 0.04706       5.57253

Correlation matrix of residuals:
               pharma  biotech    drug small_biotech
pharma        1.00000  0.08929 0.16577       0.18305
biotech       0.08929  1.00000 0.37608      -0.25087
drug          0.16577  0.37608 1.00000       0.06336
small_biotech 0.18305 -0.25087 0.06336       1.00000</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>After doing the cross-validation test, we can see that the VAR(1) model has a better performance than the VAR(10) model, which is consistent with the initial model selection.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">=</span> <span class="dv">5</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>best_performance <span class="ot">&lt;-</span> <span class="cn">Inf</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>fold_s <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(stock_ts)<span class="sc">/</span>folds)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2020</span><span class="sc">:</span><span class="dv">2024</span>),<span class="at">each =</span><span class="dv">365</span>) <span class="co">#year</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>folds){</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> (fold<span class="dv">-1</span>)<span class="sc">*</span>fold_s<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">&lt;-</span> fold<span class="sc">*</span>fold_s</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  train_model <span class="ot">&lt;-</span> stock_ts[<span class="sc">-</span>(start<span class="sc">:</span>end), ]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  test_model <span class="ot">&lt;-</span> stock_ts[start<span class="sc">:</span>end, ]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(train_model, <span class="at">lag.max =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"both"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  best_lag <span class="ot">&lt;-</span> sel<span class="sc">$</span>selection[<span class="dv">1</span>]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the fit models</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">10</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">nrow</span>(test_model)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the prediction</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">n.ahead =</span> h)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> h)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  pred_pfe <span class="ot">&lt;-</span> pred<span class="sc">$</span>fcst<span class="sc">$</span>pharma[,<span class="dv">1</span>]</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  pred_pfe2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fcst<span class="sc">$</span>pharma[,<span class="dv">1</span>]</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_pfe <span class="sc">-</span> test_model[, <span class="st">"pharma"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  mse2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_pfe2 <span class="sc">-</span> test_model[, <span class="st">"pharma"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  rmse1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse1, <span class="fu">data.frame</span>(<span class="at">pharma =</span> <span class="fu">sqrt</span>(mse)))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  rmse2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse2, <span class="fu">data.frame</span>(<span class="at">pharma =</span> <span class="fu">sqrt</span>(mse2)))</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mse <span class="sc">&lt;</span> best_performance){</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(mse2 <span class="sc">&lt;</span> best_performance){</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit2</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse2</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the RMSE of two models</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmse1<span class="sc">$</span>pharma, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Fold"</span>, <span class="at">ylab =</span> <span class="st">"RMSE"</span>, <span class="at">main =</span> <span class="st">"RMSE of VAR(10) and VAR(1)"</span>)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(rmse2<span class="sc">$</span>pharma, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"VAR(10)"</span>, <span class="st">"VAR(1)"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/cv_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>The models are created using the VAR(10) and VAR(1) models, and the serial correlation test is performed. The results show that the residuals are not serially correlated, which is a good sign. What’s more, the plots show that the residuals are normally distributed. Last but not least, VAR(1) has a much lower p-value than VAR(10).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>var_model_1 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(stock_ts, <span class="at">p=</span><span class="dv">10</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>stock.serial <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_1, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>stock.serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_1
Chi-squared = 65.342, df = 32, p-value = 0.0004536</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock.serial, <span class="at">names =</span> <span class="st">"pharma"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock.serial, <span class="at">names =</span> <span class="st">"biotech"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock.serial, <span class="at">names =</span> <span class="st">"drug"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock.serial, <span class="at">names =</span> <span class="st">"small_biotech"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>var_model_2 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(stock_ts, <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>stock_2.serial <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_2, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>) </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>stock_2.serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_2
Chi-squared = 366.69, df = 176, p-value = 1.665e-15</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock_2.serial, <span class="at">names =</span> <span class="st">"pharma"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock_2.serial, <span class="at">names =</span> <span class="st">"biotech"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock_2.serial, <span class="at">names =</span> <span class="st">"drug"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stock_2.serial, <span class="at">names =</span> <span class="st">"small_biotech"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_1-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>The Pfizer (pharma) fan chart shows a first increase then decrease trend with more significant fluctuation in the forecasted period, suggesting higher volatility or uncertainty in its future stock price. On the other hand, Vertex (biotech) demonstrates a first increase then a little decrease trend with less forecasted variance, which may indicate market confidence in its stability. Teva (drug) shows a first little decrease then increase trend with some level of volatility, though not as pronounced as Pfizer, which could reflect a moderate level of uncertainty in its market dynamics. Lastly, SAGE (small_biotech) exhibits small increase trend with greater uncertainty, which is typical for smaller biotech companies that may have high growth potential but also higher risks due to factors such as funding, clinical trial outcomes, and regulatory approvals. For the relationships between these segments, the forecasted stock prices of Pfizer and Vertex are positively correlated, while the stock prices of Teva and SAGE are negatively correlated.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(fitvar2, <span class="at">n.ahead =</span> <span class="dv">365</span>, <span class="at">ci =</span> <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$pharma
           fcst    lower    upper        CI
  [1,] 39.51463 38.25022 40.77903  1.264405
  [2,] 39.60336 37.82967 41.37705  1.773690
  [3,] 39.68967 37.53401 41.84533  2.155660
  [4,] 39.77363 37.30260 42.24467  2.471035
  [5,] 39.85532 37.11168 42.59895  2.743638
  [6,] 39.93478 36.94895 42.92062  2.985836
  [7,] 40.01210 36.80704 43.21715  3.205054
  [8,] 40.08732 36.68114 43.49349  3.406175
  [9,] 40.16051 36.56789 43.75312  3.592617
 [10,] 40.23171 36.46483 43.99860  3.766884
 [11,] 40.30100 36.37012 44.23187  3.930872
 [12,] 40.36841 36.28235 44.45446  4.086058
 [13,] 40.43400 36.20038 44.66761  4.233616
 [14,] 40.49781 36.12332 44.87231  4.374495
 [15,] 40.55990 36.05042 45.06938  4.509476
 [16,] 40.62031 35.98110 45.25952  4.639206
 [17,] 40.67908 35.91485 45.44331  4.764231
 [18,] 40.73626 35.85125 45.62127  4.885011
 [19,] 40.79188 35.78994 45.79382  5.001939
 [20,] 40.84599 35.73063 45.96135  5.115356
 [21,] 40.89862 35.67307 46.12418  5.225554
 [22,] 40.94982 35.61703 46.28261  5.332788
 [23,] 40.99961 35.56233 46.43689  5.437281
 [24,] 41.04804 35.50881 46.58727  5.539230
 [25,] 41.09513 35.45632 46.73394  5.638809
 [26,] 41.14091 35.40475 46.87708  5.736169
 [27,] 41.18543 35.35398 47.01688  5.831449
 [28,] 41.22871 35.30394 47.15348  5.924770
 [29,] 41.27078 35.25454 47.28702  6.016242
 [30,] 41.31166 35.20570 47.41762  6.105962
 [31,] 41.35139 35.15737 47.54541  6.194021
 [32,] 41.39000 35.10950 47.67050  6.280499
 [33,] 41.42750 35.06203 47.79297  6.365467
 [34,] 41.46393 35.01493 47.91292  6.448994
 [35,] 41.49930 34.96816 48.03044  6.531139
 [36,] 41.53365 34.92169 48.14561  6.611959
 [37,] 41.56699 34.87549 48.25850  6.691504
 [38,] 41.59936 34.82953 48.36918  6.769822
 [39,] 41.63076 34.78380 48.47771  6.846956
 [40,] 41.66122 34.73827 48.58417  6.922947
 [41,] 41.69076 34.69293 48.68860  6.997831
 [42,] 41.71941 34.64777 48.79106  7.071645
 [43,] 41.74718 34.60276 48.89160  7.144419
 [44,] 41.77409 34.55790 48.99027  7.216185
 [45,] 41.80015 34.51318 49.08712  7.286972
 [46,] 41.82539 34.46859 49.18220  7.356806
 [47,] 41.84983 34.42412 49.27554  7.425712
 [48,] 41.87348 34.37976 49.36719  7.493714
 [49,] 41.89635 34.33552 49.45718  7.560834
 [50,] 41.91847 34.29137 49.54556  7.627095
 [51,] 41.93984 34.24733 49.63236  7.692516
 [52,] 41.96049 34.20338 49.71761  7.757116
 [53,] 41.98043 34.15952 49.80135  7.820914
 [54,] 41.99968 34.11575 49.88360  7.883928
 [55,] 42.01824 34.07206 49.96441  7.946174
 [56,] 42.03613 34.02846 50.04380  8.007668
 [57,] 42.05337 33.98494 50.12179  8.068425
 [58,] 42.06996 33.94150 50.19843  8.128460
 [59,] 42.08593 33.89814 50.27372  8.187788
 [60,] 42.10128 33.85486 50.34770  8.246421
 [61,] 42.11603 33.81166 50.42040  8.304374
 [62,] 42.13019 33.76853 50.49184  8.361658
 [63,] 42.14376 33.72548 50.56205  8.418285
 [64,] 42.15677 33.68250 50.63103  8.474269
 [65,] 42.16921 33.63960 50.69883  8.529619
 [66,] 42.18111 33.59677 50.76546  8.584347
 [67,] 42.19248 33.55402 50.83094  8.638463
 [68,] 42.20332 33.51134 50.89530  8.691979
 [69,] 42.21364 33.46874 50.95854  8.744903
 [70,] 42.22346 33.42621 51.02070  8.797245
 [71,] 42.23278 33.38377 51.08180  8.849016
 [72,] 42.24162 33.34139 51.14184  8.900223
 [73,] 42.24998 33.29910 51.20085  8.950877
 [74,] 42.25787 33.25688 51.25885  9.000985
 [75,] 42.26530 33.21475 51.31586  9.050556
 [76,] 42.27228 33.17269 51.37188  9.099598
 [77,] 42.27883 33.13071 51.42695  9.148119
 [78,] 42.28494 33.08881 51.48106  9.196128
 [79,] 42.29062 33.04699 51.53425  9.243630
 [80,] 42.29589 33.00526 51.58652  9.290635
 [81,] 42.30075 32.96360 51.63790  9.337148
 [82,] 42.30521 32.92203 51.68839  9.383178
 [83,] 42.30928 32.88055 51.73801  9.428731
 [84,] 42.31296 32.83915 51.78677  9.473813
 [85,] 42.31627 32.79784 51.83470  9.518431
 [86,] 42.31920 32.75661 51.88179  9.562592
 [87,] 42.32177 32.71547 51.92807  9.606301
 [88,] 42.32399 32.67442 51.97355  9.649565
 [89,] 42.32585 32.63346 52.01824  9.692390
 [90,] 42.32738 32.59260 52.06216  9.734782
 [91,] 42.32856 32.55182 52.10531  9.776746
 [92,] 42.32942 32.51113 52.14771  9.818288
 [93,] 42.32996 32.47054 52.18937  9.859413
 [94,] 42.33018 32.43005 52.23030  9.900126
 [95,] 42.33008 32.38965 52.27052  9.940434
 [96,] 42.32969 32.34935 52.31003  9.980340
 [97,] 42.32899 32.30914 52.34884 10.019851
 [98,] 42.32800 32.26903 52.38697 10.058971
 [99,] 42.32673 32.22902 52.42443 10.097704
[100,] 42.32517 32.18912 52.46123 10.136056
[101,] 42.32334 32.14931 52.49737 10.174031
[102,] 42.32124 32.10960 52.53287 10.211633
[103,] 42.31887 32.07000 52.56774 10.248868
[104,] 42.31625 32.03051 52.60198 10.285739
[105,] 42.31337 31.99112 52.63562 10.322251
[106,] 42.31024 31.95183 52.66864 10.358408
[107,] 42.30686 31.91265 52.70108 10.394213
[108,] 42.30325 31.87358 52.73293 10.429672
[109,] 42.29941 31.83462 52.76420 10.464788
[110,] 42.29533 31.79577 52.79490 10.499566
[111,] 42.29103 31.75703 52.82504 10.534007
[112,] 42.28651 31.71840 52.85463 10.568118
[113,] 42.28178 31.67988 52.88368 10.601901
[114,] 42.27684 31.64148 52.91220 10.635360
[115,] 42.27169 31.60319 52.94018 10.668498
[116,] 42.26633 31.56501 52.96765 10.701319
[117,] 42.26078 31.52696 52.99461 10.733827
[118,] 42.25504 31.48901 53.02106 10.766025
[119,] 42.24911 31.45119 53.04702 10.797916
[120,] 42.24299 31.41349 53.07249 10.829504
[121,] 42.23669 31.37590 53.09748 10.860791
[122,] 42.23022 31.33844 53.12200 10.891782
[123,] 42.22357 31.30109 53.14605 10.922478
[124,] 42.21675 31.26387 53.16964 10.952884
[125,] 42.20977 31.22677 53.19277 10.983001
[126,] 42.20263 31.18979 53.21546 11.012835
[127,] 42.19533 31.15294 53.23771 11.042386
[128,] 42.18787 31.11622 53.25953 11.071658
[129,] 42.18027 31.07962 53.28092 11.100654
[130,] 42.17252 31.04314 53.30189 11.129377
[131,] 42.16462 31.00679 53.32245 11.157830
[132,] 42.15659 30.97057 53.34260 11.186014
[133,] 42.14842 30.93448 53.36235 11.213934
[134,] 42.14011 30.89852 53.38170 11.241591
[135,] 42.13168 30.86269 53.40066 11.268988
[136,] 42.12312 30.82699 53.41924 11.296128
[137,] 42.11443 30.79142 53.43744 11.323014
[138,] 42.10563 30.75598 53.45527 11.349647
[139,] 42.09670 30.72067 53.47273 11.376031
[140,] 42.08767 30.68550 53.48983 11.402167
[141,] 42.07852 30.65046 53.50658 11.428059
[142,] 42.06926 30.61556 53.52297 11.453708
[143,] 42.05990 30.58079 53.53902 11.479117
[144,] 42.05044 30.54615 53.55473 11.504288
[145,] 42.04088 30.51165 53.57010 11.529223
[146,] 42.03122 30.47729 53.58514 11.553925
[147,] 42.02146 30.44307 53.59986 11.578397
[148,] 42.01162 30.40898 53.61426 11.602639
[149,] 42.00168 30.37503 53.62834 11.626655
[150,] 41.99167 30.34122 53.64211 11.650446
[151,] 41.98156 30.30755 53.65558 11.674015
[152,] 41.97138 30.27402 53.66874 11.697363
[153,] 41.96112 30.24062 53.68161 11.720493
[154,] 41.95078 30.20737 53.69419 11.743407
[155,] 41.94037 30.17426 53.70647 11.766107
[156,] 41.92988 30.14129 53.71848 11.788594
[157,] 41.91933 30.10846 53.73021 11.810871
[158,] 41.90872 30.07578 53.74166 11.832940
[159,] 41.89803 30.04323 53.75284 11.854803
[160,] 41.88729 30.01083 53.76375 11.876461
[161,] 41.87649 29.97857 53.77440 11.897916
[162,] 41.86563 29.94646 53.78480 11.919170
[163,] 41.85471 29.91449 53.79494 11.940226
[164,] 41.84375 29.88266 53.80483 11.961085
[165,] 41.83273 29.85098 53.81447 11.981748
[166,] 41.82166 29.81944 53.82388 12.002217
[167,] 41.81054 29.78805 53.83304 12.022495
[168,] 41.79938 29.75680 53.84197 12.042583
[169,] 41.78818 29.72570 53.85066 12.062483
[170,] 41.77694 29.69474 53.85913 12.082195
[171,] 41.76565 29.66393 53.86738 12.101723
[172,] 41.75433 29.63326 53.87540 12.121068
[173,] 41.74298 29.60275 53.88321 12.140231
[174,] 41.73159 29.57237 53.89080 12.159213
[175,] 41.72017 29.54215 53.89818 12.178018
[176,] 41.70872 29.51207 53.90536 12.196645
[177,] 41.69724 29.48214 53.91233 12.215098
[178,] 41.68573 29.45236 53.91911 12.233376
[179,] 41.67420 29.42272 53.92568 12.251483
[180,] 41.66265 29.39323 53.93207 12.269419
[181,] 41.65107 29.36389 53.93826 12.287185
[182,] 41.63948 29.33469 53.94426 12.304784
[183,] 41.62786 29.30565 53.95008 12.322217
[184,] 41.61623 29.27675 53.95572 12.339486
[185,] 41.60459 29.24800 53.96118 12.356591
[186,] 41.59293 29.21939 53.96646 12.373534
[187,] 41.58126 29.19094 53.97157 12.390317
[188,] 41.56957 29.16263 53.97651 12.406941
[189,] 41.55788 29.13447 53.98129 12.423407
[190,] 41.54618 29.10646 53.98590 12.439718
[191,] 41.53447 29.07860 53.99035 12.455873
[192,] 41.52276 29.05089 53.99464 12.471875
[193,] 41.51104 29.02332 53.99877 12.487725
[194,] 41.49932 28.99590 54.00275 12.503424
[195,] 41.48760 28.96863 54.00658 12.518974
[196,] 41.47588 28.94151 54.01026 12.534376
[197,] 41.46416 28.91453 54.01379 12.549630
[198,] 41.45245 28.88771 54.01719 12.564740
[199,] 41.44073 28.86103 54.02044 12.579705
[200,] 41.42902 28.83450 54.02355 12.594526
[201,] 41.41732 28.80811 54.02653 12.609207
[202,] 41.40562 28.78188 54.02937 12.623746
[203,] 41.39394 28.75579 54.03208 12.638146
[204,] 41.38226 28.72985 54.03467 12.652409
[205,] 41.37059 28.70405 54.03712 12.666534
[206,] 41.35893 28.67841 54.03945 12.680523
[207,] 41.34729 28.65291 54.04166 12.694378
[208,] 41.33565 28.62755 54.04375 12.708100
[209,] 41.32404 28.60235 54.04573 12.721689
[210,] 41.31244 28.57729 54.04758 12.735148
[211,] 41.30085 28.55237 54.04933 12.748476
[212,] 41.28928 28.52761 54.05096 12.761676
[213,] 41.27773 28.50299 54.05248 12.774748
[214,] 41.26620 28.47851 54.05390 12.787693
[215,] 41.25469 28.45418 54.05521 12.800513
[216,] 41.24320 28.42999 54.05641 12.813209
[217,] 41.23174 28.40596 54.05752 12.825781
[218,] 41.22029 28.38206 54.05852 12.838231
[219,] 41.20887 28.35831 54.05943 12.850560
[220,] 41.19747 28.33470 54.06024 12.862769
[221,] 41.18610 28.31124 54.06096 12.874859
[222,] 41.17475 28.28792 54.06159 12.886831
[223,] 41.16344 28.26475 54.06212 12.898685
[224,] 41.15214 28.24172 54.06257 12.910424
[225,] 41.14088 28.21883 54.06293 12.922048
[226,] 41.12964 28.19609 54.06320 12.933558
[227,] 41.11844 28.17348 54.06339 12.944955
[228,] 41.10726 28.15102 54.06350 12.956240
[229,] 41.09612 28.12871 54.06353 12.967414
[230,] 41.08501 28.10653 54.06348 12.978477
[231,] 41.07393 28.08449 54.06336 12.989432
[232,] 41.06288 28.06260 54.06316 13.000279
[233,] 41.05187 28.04085 54.06288 13.011018
[234,] 41.04089 28.01923 54.06254 13.021651
[235,] 41.02994 27.99776 54.06212 13.032179
[236,] 41.01903 27.97643 54.06163 13.042603
[237,] 41.00816 27.95523 54.06108 13.052923
[238,] 40.99732 27.93418 54.06046 13.063140
[239,] 40.98652 27.91326 54.05977 13.073256
[240,] 40.97576 27.89248 54.05903 13.083271
[241,] 40.96503 27.87184 54.05822 13.093186
[242,] 40.95434 27.85134 54.05734 13.103002
[243,] 40.94370 27.83098 54.05641 13.112719
[244,] 40.93309 27.81075 54.05543 13.122340
[245,] 40.92252 27.79066 54.05438 13.131864
[246,] 40.91199 27.77070 54.05328 13.141292
[247,] 40.90150 27.75088 54.05213 13.150626
[248,] 40.89106 27.73119 54.05092 13.159866
[249,] 40.88065 27.71164 54.04967 13.169012
[250,] 40.87029 27.69223 54.04836 13.178067
[251,] 40.85997 27.67294 54.04700 13.187030
[252,] 40.84970 27.65379 54.04560 13.195902
[253,] 40.83946 27.63478 54.04415 13.204684
[254,] 40.82927 27.61590 54.04265 13.213378
[255,] 40.81913 27.59714 54.04111 13.221983
[256,] 40.80903 27.57853 54.03953 13.230500
[257,] 40.79897 27.56004 54.03790 13.238931
[258,] 40.78896 27.54168 54.03623 13.247276
[259,] 40.77899 27.52346 54.03453 13.255536
[260,] 40.76907 27.50536 54.03278 13.263711
[261,] 40.75920 27.48739 54.03100 13.271803
[262,] 40.74937 27.46956 54.02918 13.279812
[263,] 40.73959 27.45185 54.02733 13.287738
[264,] 40.72985 27.43427 54.02544 13.295584
[265,] 40.72016 27.41682 54.02351 13.303348
[266,] 40.71052 27.39949 54.02156 13.311033
[267,] 40.70093 27.38229 54.01957 13.318638
[268,] 40.69139 27.36522 54.01755 13.326164
[269,] 40.68189 27.34828 54.01550 13.333613
[270,] 40.67244 27.33146 54.01343 13.340985
[271,] 40.66304 27.31476 54.01132 13.348280
[272,] 40.65369 27.29819 54.00919 13.355500
[273,] 40.64439 27.28174 54.00703 13.362644
[274,] 40.63513 27.26542 54.00485 13.369714
[275,] 40.62593 27.24922 54.00264 13.376710
[276,] 40.61678 27.23314 54.00041 13.383633
[277,] 40.60767 27.21719 53.99816 13.390484
[278,] 40.59862 27.20135 53.99588 13.397263
[279,] 40.58961 27.18564 53.99358 13.403971
[280,] 40.58066 27.17005 53.99126 13.410609
[281,] 40.57175 27.15457 53.98893 13.417177
[282,] 40.56290 27.13922 53.98657 13.423675
[283,] 40.55409 27.12399 53.98420 13.430105
[284,] 40.54534 27.10887 53.98181 13.436468
[285,] 40.53664 27.09387 53.97940 13.442763
[286,] 40.52799 27.07900 53.97698 13.448991
[287,] 40.51939 27.06423 53.97454 13.455153
[288,] 40.51084 27.04959 53.97209 13.461250
[289,] 40.50234 27.03506 53.96962 13.467282
[290,] 40.49389 27.02064 53.96714 13.473250
[291,] 40.48549 27.00634 53.96465 13.479154
[292,] 40.47715 26.99215 53.96214 13.484995
[293,] 40.46886 26.97808 53.95963 13.490773
[294,] 40.46061 26.96412 53.95710 13.496490
[295,] 40.45242 26.95028 53.95457 13.502145
[296,] 40.44429 26.93655 53.95203 13.507740
[297,] 40.43620 26.92292 53.94947 13.513275
[298,] 40.42816 26.90941 53.94691 13.518750
[299,] 40.42018 26.89601 53.94435 13.524165
[300,] 40.41225 26.88273 53.94177 13.529523
[301,] 40.40437 26.86955 53.93919 13.534822
[302,] 40.39654 26.85648 53.93660 13.540064
[303,] 40.38876 26.84351 53.93401 13.545249
[304,] 40.38104 26.83066 53.93142 13.550378
[305,] 40.37337 26.81792 53.92882 13.555451
[306,] 40.36575 26.80528 53.92621 13.560469
[307,] 40.35818 26.79274 53.92361 13.565432
[308,] 40.35066 26.78032 53.92100 13.570341
[309,] 40.34319 26.76800 53.91839 13.575196
[310,] 40.33578 26.75578 53.91578 13.579998
[311,] 40.32842 26.74367 53.91316 13.584747
[312,] 40.32111 26.73166 53.91055 13.589444
[313,] 40.31385 26.71976 53.90794 13.594090
[314,] 40.30664 26.70796 53.90532 13.598684
[315,] 40.29948 26.69626 53.90271 13.603227
[316,] 40.29238 26.68466 53.90010 13.607720
[317,] 40.28533 26.67316 53.89749 13.612164
[318,] 40.27833 26.66177 53.89488 13.616558
[319,] 40.27138 26.65047 53.89228 13.620904
[320,] 40.26448 26.63928 53.88968 13.625201
[321,] 40.25763 26.62818 53.88708 13.629450
[322,] 40.25083 26.61718 53.88449 13.633652
[323,] 40.24409 26.60628 53.88190 13.637807
[324,] 40.23739 26.59548 53.87931 13.641916
[325,] 40.23075 26.58477 53.87673 13.645979
[326,] 40.22416 26.57416 53.87416 13.649996
[327,] 40.21762 26.56365 53.87159 13.653968
[328,] 40.21113 26.55323 53.86902 13.657895
[329,] 40.20469 26.54291 53.86647 13.661778
[330,] 40.19830 26.53268 53.86392 13.665617
[331,] 40.19196 26.52255 53.86137 13.669413
[332,] 40.18567 26.51250 53.85884 13.673166
[333,] 40.17943 26.50256 53.85631 13.676877
[334,] 40.17324 26.49270 53.85379 13.680545
[335,] 40.16711 26.48293 53.85128 13.684172
[336,] 40.16102 26.47326 53.84877 13.687757
[337,] 40.15498 26.46368 53.84628 13.691302
[338,] 40.14899 26.45418 53.84380 13.694806
[339,] 40.14305 26.44478 53.84132 13.698270
[340,] 40.13716 26.43547 53.83886 13.701694
[341,] 40.13132 26.42624 53.83640 13.705080
[342,] 40.12553 26.41710 53.83396 13.708426
[343,] 40.11979 26.40805 53.83152 13.711734
[344,] 40.11410 26.39909 53.82910 13.715004
[345,] 40.10845 26.39022 53.82669 13.718236
[346,] 40.10286 26.38142 53.82429 13.721431
[347,] 40.09731 26.37272 53.82190 13.724589
[348,] 40.09181 26.36410 53.81952 13.727710
[349,] 40.08636 26.35556 53.81716 13.730796
[350,] 40.08096 26.34711 53.81480 13.733845
[351,] 40.07560 26.33875 53.81246 13.736859
[352,] 40.07030 26.33046 53.81014 13.739838
[353,] 40.06504 26.32226 53.80782 13.742782
[354,] 40.05983 26.31414 53.80552 13.745692
[355,] 40.05467 26.30610 53.80323 13.748568
[356,] 40.04955 26.29814 53.80096 13.751410
[357,] 40.04448 26.29026 53.79870 13.754218
[358,] 40.03946 26.28247 53.79645 13.756994
[359,] 40.03448 26.27475 53.79422 13.759737
[360,] 40.02956 26.26711 53.79200 13.762448
[361,] 40.02467 26.25955 53.78980 13.765127
[362,] 40.01984 26.25206 53.78761 13.767774
[363,] 40.01505 26.24466 53.78544 13.770390
[364,] 40.01031 26.23733 53.78328 13.772975
[365,] 40.00561 26.23008 53.78114 13.775530

$biotech
           fcst    lower    upper        CI
  [1,] 184.8246 169.4635 200.1857  15.36110
  [2,] 186.2117 164.7341 207.6892  21.47755
  [3,] 187.5721 161.5568 213.5874  26.01531
  [4,] 188.9066 159.1869 218.6262  29.71961
  [5,] 190.2158 157.3318 223.0998  32.88396
  [6,] 191.5005 155.8392 227.1617  35.66127
  [7,] 192.7613 154.6175 230.9050  38.14377
  [8,] 193.9988 153.6064 234.3912  40.39238
  [9,] 195.2137 152.7637 237.6636  42.44995
 [10,] 196.4065 152.0584 240.7545  44.34804
 [11,] 197.5778 151.4671 243.6885  46.11069
 [12,] 198.7282 150.9714 246.4849  47.75674
 [13,] 199.8581 150.5569 249.1594  49.30126
 [14,] 200.9682 150.2116 251.7247  50.75653
 [15,] 202.0588 149.9261 254.1915  52.13270
 [16,] 203.1305 149.6922 256.5687  53.43828
 [17,] 204.1836 149.5032 258.8641  54.68045
 [18,] 205.2188 149.3534 261.0841  55.86536
 [19,] 206.2363 149.2380 263.2346  56.99829
 [20,] 207.2366 149.1527 265.3204  58.08381
 [21,] 208.2200 149.0941 267.3459  59.12592
 [22,] 209.1870 149.0589 269.3152  60.12813
 [23,] 210.1380 149.0445 271.2315  61.09352
 [24,] 211.0732 149.0484 273.0981  62.02482
 [25,] 211.9931 149.0687 274.9176  62.92447
 [26,] 212.8980 149.1033 276.6926  63.79464
 [27,] 213.7881 149.1509 278.4254  64.63726
 [28,] 214.6639 149.2098 280.1180  65.45409
 [29,] 215.5255 149.2788 281.7722  66.24670
 [30,] 216.3734 149.3569 283.3899  67.01651
 [31,] 217.2077 149.4429 284.9726  67.76483
 [32,] 218.0288 149.5360 286.5217  68.49282
 [33,] 218.8370 149.6354 288.0385  69.20156
 [34,] 219.6324 149.7403 289.5244  69.89202
 [35,] 220.4153 149.8502 290.9804  70.56510
 [36,] 221.1860 149.9644 292.4076  71.22164
 [37,] 221.9447 150.0823 293.8071  71.86238
 [38,] 222.6917 150.2036 295.1797  72.48803
 [39,] 223.4271 150.3278 296.5263  73.09923
 [40,] 224.1511 150.4545 297.8477  73.69659
 [41,] 224.8641 150.5834 299.1448  74.28066
 [42,] 225.5661 150.7142 300.4181  74.85196
 [43,] 226.2574 150.8465 301.6684  75.41097
 [44,] 226.9382 150.9801 302.8963  75.95814
 [45,] 227.6086 151.1147 304.1025  76.49389
 [46,] 228.2689 151.2503 305.2875  77.01862
 [47,] 228.9192 151.3864 306.4519  77.53270
 [48,] 229.5596 151.5231 307.5961  78.03648
 [49,] 230.1904 151.6601 308.7207  78.53028
 [50,] 230.8117 151.7973 309.8261  79.01442
 [51,] 231.4236 151.9345 310.9128  79.48918
 [52,] 232.0264 152.0716 311.9813  79.95485
 [53,] 232.6202 152.2085 313.0318  80.41169
 [54,] 233.2050 152.3451 314.0649  80.85994
 [55,] 233.7811 152.4813 315.0809  81.29984
 [56,] 234.3486 152.6170 316.0802  81.73161
 [57,] 234.9076 152.7522 317.0631  82.15548
 [58,] 235.4583 152.8867 318.0300  82.57165
 [59,] 236.0008 153.0205 318.9811  82.98030
 [60,] 236.5352 153.1535 319.9168  83.38163
 [61,] 237.0616 153.2858 320.8374  83.77582
 [62,] 237.5802 153.4171 321.7432  84.16303
 [63,] 238.0910 153.5476 322.6344  84.54344
 [64,] 238.5942 153.6770 323.5114  84.91719
 [65,] 239.0900 153.8055 324.3744  85.28445
 [66,] 239.5783 153.9330 325.2237  85.64536
 [67,] 240.0594 154.0593 326.0594  86.00005
 [68,] 240.5333 154.1846 326.8819  86.34866
 [69,] 241.0001 154.3087 327.6914  86.69133
 [70,] 241.4599 154.4317 328.4881  87.02817
 [71,] 241.9128 154.5535 329.2722  87.35932
 [72,] 242.3590 154.6741 330.0439  87.68489
 [73,] 242.7985 154.7935 330.8035  88.00499
 [74,] 243.2314 154.9116 331.5511  88.31973
 [75,] 243.6578 155.0285 332.2870  88.62922
 [76,] 244.0777 155.1442 333.0113  88.93356
 [77,] 244.4914 155.2585 333.7242  89.23286
 [78,] 244.8988 155.3716 334.4260  89.52721
 [79,] 245.3000 155.4833 335.1167  89.81670
 [80,] 245.6952 155.5938 335.7967  90.10143
 [81,] 246.0844 155.7029 336.4659  90.38149
 [82,] 246.4677 155.8107 337.1246  90.65696
 [83,] 246.8451 155.9172 337.7731  90.92793
 [84,] 247.2168 156.0223 338.4113  91.19448
 [85,] 247.5828 156.1261 339.0395  91.45669
 [86,] 247.9432 156.2286 339.6578  91.71463
 [87,] 248.2981 156.3297 340.2665  91.96839
 [88,] 248.6475 156.4294 340.8655  92.21804
 [89,] 248.9915 156.5278 341.4551  92.46365
 [90,] 249.3302 156.6249 342.0355  92.70529
 [91,] 249.6636 156.7206 342.6067  92.94302
 [92,] 249.9919 156.8150 343.1688  93.17693
 [93,] 250.3150 156.9080 343.7221  93.40706
 [94,] 250.6331 156.9996 344.2666  93.63350
 [95,] 250.9462 157.0899 344.8025  93.85629
 [96,] 251.2544 157.1789 345.3299  94.07550
 [97,] 251.5577 157.2665 345.8489  94.29120
 [98,] 251.8562 157.3528 346.3597  94.50343
 [99,] 252.1500 157.4377 346.8623  94.71225
[100,] 252.4391 157.5214 347.3568  94.91774
[101,] 252.7236 157.6036 347.8435  95.11992
[102,] 253.0035 157.6846 348.3223  95.31887
[103,] 253.2789 157.7642 348.7935  95.51463
[104,] 253.5498 157.8426 349.2571  95.70726
[105,] 253.8164 157.9196 349.7132  95.89681
[106,] 254.0786 157.9953 350.1619  96.08332
[107,] 254.3366 158.0697 350.6034  96.26684
[108,] 254.5903 158.1428 351.0377  96.44743
[109,] 254.8398 158.2147 351.4649  96.62513
[110,] 255.0852 158.2852 351.8852  96.79998
[111,] 255.3265 158.3545 352.2986  96.97203
[112,] 255.5639 158.4225 352.7052  97.14132
[113,] 255.7972 158.4893 353.1051  97.30791
[114,] 256.0266 158.5548 353.4984  97.47182
[115,] 256.2521 158.6190 353.8852  97.63311
[116,] 256.4738 158.6820 354.2657  97.79181
[117,] 256.6918 158.7438 354.6397  97.94796
[118,] 256.9060 158.8044 355.0076  98.10161
[119,] 257.1165 158.8637 355.3693  98.25279
[120,] 257.3234 158.9218 355.7249  98.40154
[121,] 257.5266 158.9788 356.0745  98.54790
[122,] 257.7264 159.0345 356.4183  98.69190
[123,] 257.9226 159.0890 356.7562  98.83359
[124,] 258.1154 159.1424 357.0884  98.97300
[125,] 258.3047 159.1946 357.4149  99.11015
[126,] 258.4907 159.2456 357.7358  99.24510
[127,] 258.6733 159.2954 358.0512  99.37787
[128,] 258.8527 159.3442 358.3612  99.50849
[129,] 259.0288 159.3917 358.6658  99.63701
[130,] 259.2016 159.4382 358.9651  99.76344
[131,] 259.3714 159.4835 359.2592  99.88783
[132,] 259.5379 159.5277 359.5481 100.01020
[133,] 259.7014 159.5708 359.8320 100.13059
[134,] 259.8619 159.6128 360.1109 100.24902
[135,] 260.0193 159.6538 360.3848 100.36554
[136,] 260.1738 159.6936 360.6539 100.48015
[137,] 260.3253 159.7324 360.9182 100.59290
[138,] 260.4739 159.7701 361.1777 100.70382
[139,] 260.6196 159.8067 361.4326 100.81293
[140,] 260.7626 159.8423 361.6828 100.92026
[141,] 260.9027 159.8769 361.9285 101.02583
[142,] 261.0401 159.9104 362.1697 101.12968
[143,] 261.1747 159.9429 362.4066 101.23183
[144,] 261.3067 159.9744 362.6390 101.33231
[145,] 261.4360 160.0049 362.8671 101.43114
[146,] 261.5627 160.0343 363.0911 101.52835
[147,] 261.6868 160.0629 363.3108 101.62397
[148,] 261.8084 160.0904 363.5264 101.71801
[149,] 261.9274 160.1169 363.7379 101.81051
[150,] 262.0440 160.1425 363.9455 101.90148
[151,] 262.1581 160.1671 364.1490 101.99095
[152,] 262.2698 160.1908 364.3487 102.07895
[153,] 262.3791 160.2136 364.5446 102.16549
[154,] 262.4860 160.2354 364.7366 102.25061
[155,] 262.5906 160.2563 364.9249 102.33431
[156,] 262.6929 160.2763 365.1095 102.41663
[157,] 262.7930 160.2954 365.2905 102.49759
[158,] 262.8908 160.3136 365.4680 102.57720
[159,] 262.9863 160.3309 365.6418 102.65549
[160,] 263.0798 160.3473 365.8122 102.73249
[161,] 263.1710 160.3628 365.9792 102.80820
[162,] 263.2602 160.3775 366.1428 102.88265
[163,] 263.3472 160.3913 366.3031 102.95586
[164,] 263.4322 160.4043 366.4600 103.02785
[165,] 263.5151 160.4165 366.6138 103.09864
[166,] 263.5961 160.4278 366.7643 103.16824
[167,] 263.6750 160.4383 366.9117 103.23669
[168,] 263.7520 160.4480 367.0560 103.30399
[169,] 263.8270 160.4569 367.1972 103.37016
[170,] 263.9002 160.4650 367.3354 103.43523
[171,] 263.9715 160.4723 367.4707 103.49920
[172,] 264.0409 160.4788 367.6030 103.56210
[173,] 264.1085 160.4845 367.7324 103.62395
[174,] 264.1742 160.4895 367.8590 103.68476
[175,] 264.2382 160.4937 367.9828 103.74454
[176,] 264.3005 160.4972 368.1038 103.80332
[177,] 264.3610 160.4999 368.2221 103.86112
[178,] 264.4198 160.5019 368.3378 103.91793
[179,] 264.4770 160.5032 368.4508 103.97380
[180,] 264.5324 160.5037 368.5611 104.02872
[181,] 264.5863 160.5035 368.6690 104.08271
[182,] 264.6385 160.5027 368.7743 104.13580
[183,] 264.6891 160.5011 368.8771 104.18799
[184,] 264.7382 160.4989 368.9775 104.23930
[185,] 264.7857 160.4959 369.0754 104.28974
[186,] 264.8317 160.4923 369.1710 104.33933
[187,] 264.8762 160.4881 369.2642 104.38808
[188,] 264.9192 160.4832 369.3552 104.43601
[189,] 264.9607 160.4776 369.4438 104.48313
[190,] 265.0008 160.4714 369.5303 104.52945
[191,] 265.0395 160.4645 369.6145 104.57499
[192,] 265.0768 160.4571 369.6966 104.61976
[193,] 265.1127 160.4490 369.7765 104.66377
[194,] 265.1473 160.4402 369.8543 104.70703
[195,] 265.1805 160.4309 369.9301 104.74957
[196,] 265.2124 160.4210 370.0038 104.79138
[197,] 265.2430 160.4105 370.0755 104.83249
[198,] 265.2723 160.3994 370.1452 104.87290
[199,] 265.3004 160.3878 370.2130 104.91263
[200,] 265.3272 160.3755 370.2789 104.95168
[201,] 265.3528 160.3627 370.3429 104.99008
[202,] 265.3772 160.3494 370.4050 105.02782
[203,] 265.4004 160.3355 370.4653 105.06493
[204,] 265.4224 160.3210 370.5238 105.10141
[205,] 265.4433 160.3060 370.5806 105.13727
[206,] 265.4630 160.2905 370.6356 105.17253
[207,] 265.4817 160.2745 370.6889 105.20719
[208,] 265.4992 160.2579 370.7405 105.24127
[209,] 265.5157 160.2409 370.7904 105.27478
[210,] 265.5310 160.2233 370.8387 105.30771
[211,] 265.5454 160.2053 370.8855 105.34010
[212,] 265.5587 160.1867 370.9306 105.37194
[213,] 265.5709 160.1677 370.9742 105.40324
[214,] 265.5822 160.1482 371.0162 105.43401
[215,] 265.5925 160.1283 371.0568 105.46427
[216,] 265.6019 160.1078 371.0959 105.49402
[217,] 265.6102 160.0870 371.1335 105.52327
[218,] 265.6177 160.0656 371.1697 105.55203
[219,] 265.6242 160.0439 371.2045 105.58031
[220,] 265.6298 160.0216 371.2379 105.60812
[221,] 265.6345 159.9990 371.2699 105.63546
[222,] 265.6383 159.9760 371.3006 105.66234
[223,] 265.6413 159.9525 371.3300 105.68878
[224,] 265.6434 159.9286 371.3581 105.71478
[225,] 265.6446 159.9043 371.3850 105.74034
[226,] 265.6451 159.8796 371.4106 105.76548
[227,] 265.6447 159.8545 371.4349 105.79020
[228,] 265.6436 159.8291 371.4581 105.81451
[229,] 265.6416 159.8032 371.4800 105.83842
[230,] 265.6389 159.7770 371.5008 105.86193
[231,] 265.6354 159.7504 371.5205 105.88506
[232,] 265.6312 159.7234 371.5390 105.90780
[233,] 265.6263 159.6961 371.5565 105.93018
[234,] 265.6206 159.6685 371.5728 105.95218
[235,] 265.6143 159.6404 371.5881 105.97382
[236,] 265.6072 159.6121 371.6023 105.99511
[237,] 265.5995 159.5834 371.6155 106.01605
[238,] 265.5911 159.5544 371.6277 106.03665
[239,] 265.5820 159.5251 371.6389 106.05691
[240,] 265.5723 159.4954 371.6491 106.07685
[241,] 265.5619 159.4655 371.6584 106.09646
[242,] 265.5510 159.4352 371.6667 106.11575
[243,] 265.5394 159.4046 371.6741 106.13474
[244,] 265.5272 159.3738 371.6806 106.15341
[245,] 265.5144 159.3426 371.6862 106.17179
[246,] 265.5011 159.3112 371.6909 106.18987
[247,] 265.4872 159.2795 371.6948 106.20767
[248,] 265.4727 159.2475 371.6979 106.22518
[249,] 265.4577 159.2152 371.7001 106.24241
[250,] 265.4421 159.1827 371.7015 106.25937
[251,] 265.4260 159.1500 371.7021 106.27605
[252,] 265.4094 159.1169 371.7019 106.29248
[253,] 265.3923 159.0837 371.7009 106.30865
[254,] 265.3747 159.0501 371.6993 106.32456
[255,] 265.3566 159.0164 371.6968 106.34022
[256,] 265.3380 158.9824 371.6937 106.35564
[257,] 265.3190 158.9482 371.6898 106.37082
[258,] 265.2995 158.9137 371.6853 106.38576
[259,] 265.2796 158.8791 371.6800 106.40047
[260,] 265.2592 158.8442 371.6741 106.41496
[261,] 265.2384 158.8091 371.6676 106.42922
[262,] 265.2171 158.7739 371.6604 106.44326
[263,] 265.1955 158.7384 371.6526 106.45709
[264,] 265.1734 158.7027 371.6441 106.47071
[265,] 265.1510 158.6669 371.6351 106.48412
[266,] 265.1281 158.6308 371.6255 106.49733
[267,] 265.1049 158.5946 371.6153 106.51034
[268,] 265.0813 158.5582 371.6045 106.52315
[269,] 265.0574 158.5216 371.5931 106.53577
[270,] 265.0331 158.4849 371.5813 106.54821
[271,] 265.0084 158.4480 371.5689 106.56045
[272,] 264.9834 158.4109 371.5559 106.57252
[273,] 264.9581 158.3737 371.5425 106.58441
[274,] 264.9324 158.3363 371.5286 106.59612
[275,] 264.9065 158.2988 371.5141 106.60767
[276,] 264.8802 158.2612 371.4992 106.61904
[277,] 264.8536 158.2234 371.4839 106.63025
[278,] 264.8267 158.1854 371.4680 106.64130
[279,] 264.7996 158.1474 371.4518 106.65218
[280,] 264.7721 158.1092 371.4351 106.66292
[281,] 264.7444 158.0709 371.4179 106.67349
[282,] 264.7164 158.0325 371.4004 106.68392
[283,] 264.6882 157.9940 371.3824 106.69420
[284,] 264.6597 157.9554 371.3640 106.70433
[285,] 264.6309 157.9166 371.3453 106.71432
[286,] 264.6020 157.8778 371.3261 106.72418
[287,] 264.5727 157.8388 371.3066 106.73389
[288,] 264.5433 157.7998 371.2868 106.74347
[289,] 264.5136 157.7607 371.2665 106.75292
[290,] 264.4837 157.7215 371.2460 106.76223
[291,] 264.4536 157.6822 371.2250 106.77142
[292,] 264.4233 157.6428 371.2038 106.78049
[293,] 264.3928 157.6034 371.1822 106.78943
[294,] 264.3621 157.5639 371.1604 106.79825
[295,] 264.3312 157.5243 371.1382 106.80695
[296,] 264.3002 157.4846 371.1157 106.81554
[297,] 264.2689 157.4449 371.0929 106.82401
[298,] 264.2375 157.4051 371.0699 106.83237
[299,] 264.2059 157.3653 371.0466 106.84062
[300,] 264.1742 157.3254 371.0230 106.84876
[301,] 264.1423 157.2855 370.9991 106.85679
[302,] 264.1103 157.2455 370.9750 106.86472
[303,] 264.0781 157.2055 370.9506 106.87255
[304,] 264.0458 157.1655 370.9260 106.88027
[305,] 264.0133 157.1254 370.9012 106.88790
[306,] 263.9807 157.0853 370.8761 106.89543
[307,] 263.9480 157.0451 370.8508 106.90286
[308,] 263.9151 157.0049 370.8253 106.91020
[309,] 263.8822 156.9647 370.7996 106.91745
[310,] 263.8491 156.9245 370.7737 106.92461
[311,] 263.8159 156.8843 370.7476 106.93167
[312,] 263.7827 156.8440 370.7213 106.93865
[313,] 263.7493 156.8037 370.6948 106.94555
[314,] 263.7158 156.7635 370.6682 106.95236
[315,] 263.6823 156.7232 370.6413 106.95908
[316,] 263.6486 156.6829 370.6143 106.96573
[317,] 263.6149 156.6426 370.5872 106.97229
[318,] 263.5811 156.6023 370.5599 106.97877
[319,] 263.5472 156.5620 370.5324 106.98518
[320,] 263.5133 156.5217 370.5048 106.99151
[321,] 263.4792 156.4815 370.4770 106.99777
[322,] 263.4452 156.4412 370.4491 107.00395
[323,] 263.4110 156.4010 370.4211 107.01006
[324,] 263.3768 156.3607 370.3929 107.01609
[325,] 263.3426 156.3205 370.3647 107.02206
[326,] 263.3083 156.2803 370.3363 107.02796
[327,] 263.2740 156.2402 370.3078 107.03379
[328,] 263.2396 156.2000 370.2791 107.03955
[329,] 263.2052 156.1599 370.2504 107.04525
[330,] 263.1707 156.1198 370.2216 107.05088
[331,] 263.1362 156.0798 370.1927 107.05645
[332,] 263.1017 156.0398 370.1637 107.06195
[333,] 263.0672 155.9998 370.1346 107.06740
[334,] 263.0326 155.9599 370.1054 107.07278
[335,] 262.9981 155.9200 370.0762 107.07810
[336,] 262.9635 155.8801 370.0468 107.08336
[337,] 262.9289 155.8403 370.0174 107.08857
[338,] 262.8943 155.8005 369.9880 107.09372
[339,] 262.8596 155.7608 369.9585 107.09881
[340,] 262.8250 155.7212 369.9289 107.10385
[341,] 262.7904 155.6816 369.8992 107.10883
[342,] 262.7558 155.6420 369.8695 107.11376
[343,] 262.7211 155.6025 369.8398 107.11864
[344,] 262.6865 155.5631 369.8100 107.12346
[345,] 262.6519 155.5237 369.7801 107.12823
[346,] 262.6173 155.4844 369.7503 107.13295
[347,] 262.5827 155.4451 369.7204 107.13762
[348,] 262.5482 155.4059 369.6904 107.14225
[349,] 262.5136 155.3668 369.6604 107.14682
[350,] 262.4791 155.3277 369.6304 107.15135
[351,] 262.4446 155.2888 369.6004 107.15582
[352,] 262.4101 155.2499 369.5704 107.16026
[353,] 262.3757 155.2110 369.5403 107.16464
[354,] 262.3412 155.1722 369.5102 107.16898
[355,] 262.3068 155.1336 369.4801 107.17328
[356,] 262.2725 155.0950 369.4500 107.17753
[357,] 262.2382 155.0564 369.4199 107.18174
[358,] 262.2039 155.0180 369.3898 107.18591
[359,] 262.1696 154.9796 369.3597 107.19003
[360,] 262.1354 154.9413 369.3296 107.19412
[361,] 262.1013 154.9031 369.2994 107.19816
[362,] 262.0672 154.8650 369.2693 107.20216
[363,] 262.0331 154.8270 369.2392 107.20612
[364,] 261.9991 154.7891 369.2091 107.21004
[365,] 261.9651 154.7512 369.1791 107.21392

$drug
           fcst    lower     upper        CI
  [1,] 9.243400 8.626662  9.860138 0.6167380
  [2,] 9.246342 8.389797 10.102887 0.8565454
  [3,] 9.248851 8.218328 10.279374 1.0305233
  [4,] 9.250951 8.081680 10.420222 1.1692710
  [5,] 9.252664 7.967723 10.537606 1.2849413
  [6,] 9.254013 7.870094 10.637933 1.3839198
  [7,] 9.255019 7.784928 10.725109 1.4700904
  [8,] 9.255700 7.709659 10.801742 1.5460415
  [9,] 9.256077 7.642467 10.869687 1.6136102
 [10,] 9.256167 7.582006 10.930329 1.6741613
 [11,] 9.255988 7.527244 10.984733 1.7287445
 [12,] 9.255556 7.477366 11.033746 1.7781896
 [13,] 9.254887 7.431720 11.078053 1.8231666
 [14,] 9.253995 7.389769 11.118221 1.8642263
 [15,] 9.252896 7.351067 11.154724 1.9018283
 [16,] 9.251602 7.315242 11.187962 1.9363605
 [17,] 9.250127 7.281973 11.218281 1.9681539
 [18,] 9.248483 7.250990 11.245977 1.9974937
 [19,] 9.246682 7.222055 11.271309 2.0246269
 [20,] 9.244736 7.194966 11.294505 2.0497695
 [21,] 9.242654 7.169543 11.315765 2.0731110
 [22,] 9.240447 7.145628 11.335265 2.0948187
 [23,] 9.238125 7.123084 11.353166 2.1150410
 [24,] 9.235697 7.101787 11.369607 2.1339100
 [25,] 9.233172 7.081628 11.384715 2.1515438
 [26,] 9.230558 7.062509 11.398606 2.1680482
 [27,] 9.227863 7.044345 11.411381 2.1835182
 [28,] 9.225095 7.027055 11.423134 2.1980395
 [29,] 9.222260 7.010571 11.433950 2.2116896
 [30,] 9.219367 6.994828 11.443905 2.2245385
 [31,] 9.216421 6.979771 11.453070 2.2366499
 [32,] 9.213428 6.965346 11.461509 2.2480814
 [33,] 9.210394 6.951508 11.469280 2.2588857
 [34,] 9.207325 6.938215 11.476436 2.2691107
 [35,] 9.204226 6.925426 11.483027 2.2788001
 [36,] 9.201103 6.913109 11.489097 2.2879940
 [37,] 9.197959 6.901230 11.494688 2.2967290
 [38,] 9.194799 6.889761 11.499838 2.3050385
 [39,] 9.191628 6.878675 11.504582 2.3129534
 [40,] 9.188450 6.867948 11.508951 2.3205018
 [41,] 9.185267 6.857558 11.512977 2.3277098
 [42,] 9.182085 6.847484 11.516686 2.3346012
 [43,] 9.178906 6.837708 11.520104 2.3411979
 [44,] 9.175734 6.828214 11.523254 2.3475202
 [45,] 9.172571 6.818984 11.526158 2.3535867
 [46,] 9.169420 6.810006 11.528835 2.3594147
 [47,] 9.166285 6.801265 11.531305 2.3650200
 [48,] 9.163167 6.792750 11.533584 2.3704173
 [49,] 9.160069 6.784449 11.535689 2.3756202
 [50,] 9.156994 6.776352 11.537635 2.3806412
 [51,] 9.153942 6.768450 11.539434 2.3854920
 [52,] 9.150917 6.760734 11.541100 2.3901832
 [53,] 9.147920 6.753195 11.542645 2.3947249
 [54,] 9.144953 6.745826 11.544079 2.3991263
 [55,] 9.142017 6.738621 11.545413 2.4033958
 [56,] 9.139114 6.731572 11.546655 2.4075416
 [57,] 9.136245 6.724674 11.547816 2.4115709
 [58,] 9.133412 6.717921 11.548902 2.4154905
 [59,] 9.130615 6.711308 11.549922 2.4193070
 [60,] 9.127857 6.704831 11.550883 2.4230261
 [61,] 9.125137 6.698484 11.551790 2.4266533
 [62,] 9.122457 6.692263 11.552651 2.4301939
 [63,] 9.119818 6.686166 11.553470 2.4336524
 [64,] 9.117220 6.680187 11.554254 2.4370335
 [65,] 9.114665 6.674324 11.555006 2.4403411
 [66,] 9.112152 6.668573 11.555731 2.4435792
 [67,] 9.109683 6.662931 11.556434 2.4467513
 [68,] 9.107257 6.657397 11.557118 2.4498608
 [69,] 9.104876 6.651966 11.557787 2.4529108
 [70,] 9.102540 6.646636 11.558444 2.4559042
 [71,] 9.100249 6.641405 11.559093 2.4588437
 [72,] 9.098004 6.636272 11.559735 2.4617319
 [73,] 9.095804 6.631233 11.560375 2.4645711
 [74,] 9.093650 6.626286 11.561014 2.4673636
 [75,] 9.091542 6.621431 11.561654 2.4701115
 [76,] 9.089481 6.616664 11.562297 2.4728166
 [77,] 9.087466 6.611985 11.562946 2.4754809
 [78,] 9.085497 6.607391 11.563603 2.4781059
 [79,] 9.083574 6.602881 11.564268 2.4806934
 [80,] 9.081699 6.598454 11.564943 2.4832447
 [81,] 9.079869 6.594108 11.565630 2.4857613
 [82,] 9.078086 6.589841 11.566331 2.4882446
 [83,] 9.076349 6.585653 11.567045 2.4906956
 [84,] 9.074658 6.581542 11.567774 2.4931157
 [85,] 9.073013 6.577507 11.568519 2.4955059
 [86,] 9.071414 6.573547 11.569281 2.4978672
 [87,] 9.069861 6.569660 11.570061 2.5002005
 [88,] 9.068353 6.565846 11.570859 2.5025068
 [89,] 9.066890 6.562103 11.571677 2.5047870
 [90,] 9.065471 6.558430 11.572513 2.5070418
 [91,] 9.064098 6.554826 11.573370 2.5092719
 [92,] 9.062769 6.551291 11.574247 2.5114781
 [93,] 9.061484 6.547823 11.575145 2.5136611
 [94,] 9.060242 6.544421 11.576064 2.5158215
 [95,] 9.059044 6.541085 11.577004 2.5179599
 [96,] 9.057890 6.537813 11.577966 2.5200768
 [97,] 9.056777 6.534604 11.578950 2.5221729
 [98,] 9.055708 6.531459 11.579956 2.5242485
 [99,] 9.054680 6.528375 11.580984 2.5263042
[100,] 9.053693 6.525353 11.582034 2.5283404
[101,] 9.052748 6.522391 11.583106 2.5303575
[102,] 9.051844 6.519488 11.584200 2.5323560
[103,] 9.050980 6.516644 11.585316 2.5343362
[104,] 9.050156 6.513858 11.586455 2.5362985
[105,] 9.049372 6.511129 11.587615 2.5382433
[106,] 9.048627 6.508456 11.588798 2.5401709
[107,] 9.047920 6.505839 11.590002 2.5420815
[108,] 9.047252 6.503277 11.591228 2.5439756
[109,] 9.046622 6.500769 11.592475 2.5458533
[110,] 9.046029 6.498314 11.593744 2.5477150
[111,] 9.045473 6.495912 11.595034 2.5495608
[112,] 9.044953 6.493562 11.596345 2.5513912
[113,] 9.044470 6.491264 11.597676 2.5532062
[114,] 9.044022 6.489016 11.599028 2.5550062
[115,] 9.043610 6.486818 11.600401 2.5567912
[116,] 9.043232 6.484670 11.601793 2.5585617
[117,] 9.042888 6.482570 11.603206 2.5603176
[118,] 9.042578 6.480519 11.604637 2.5620593
[119,] 9.042301 6.478515 11.606088 2.5637870
[120,] 9.042058 6.476557 11.607558 2.5655007
[121,] 9.041846 6.474646 11.609047 2.5672007
[122,] 9.041667 6.472780 11.610554 2.5688871
[123,] 9.041519 6.470959 11.612079 2.5705601
[124,] 9.041402 6.469183 11.613622 2.5722199
[125,] 9.041316 6.467450 11.615183 2.5738665
[126,] 9.041260 6.465760 11.616760 2.5755002
[127,] 9.041234 6.464112 11.618355 2.5771211
[128,] 9.041236 6.462507 11.619966 2.5787292
[129,] 9.041268 6.460943 11.621593 2.5803248
[130,] 9.041328 6.459420 11.623236 2.5819080
[131,] 9.041415 6.457937 11.624894 2.5834788
[132,] 9.041531 6.456493 11.626568 2.5850374
[133,] 9.041673 6.455089 11.628257 2.5865840
[134,] 9.041841 6.453723 11.629960 2.5881186
[135,] 9.042036 6.452395 11.631678 2.5896413
[136,] 9.042257 6.451104 11.633409 2.5911523
[137,] 9.042502 6.449851 11.635154 2.5926516
[138,] 9.042773 6.448633 11.636912 2.5941394
[139,] 9.043068 6.447452 11.638684 2.5956158
[140,] 9.043387 6.446306 11.640467 2.5970808
[141,] 9.043729 6.445195 11.642263 2.5985345
[142,] 9.044095 6.444117 11.644072 2.5999771
[143,] 9.044483 6.443074 11.645891 2.6014086
[144,] 9.044893 6.442064 11.647722 2.6028291
[145,] 9.045326 6.441087 11.649564 2.6042387
[146,] 9.045779 6.440142 11.651417 2.6056376
[147,] 9.046254 6.439229 11.653280 2.6070257
[148,] 9.046750 6.438347 11.655153 2.6084032
[149,] 9.047266 6.437496 11.657036 2.6097701
[150,] 9.047802 6.436675 11.658928 2.6111265
[151,] 9.048357 6.435884 11.660830 2.6124726
[152,] 9.048931 6.435123 11.662740 2.6138083
[153,] 9.049525 6.434391 11.664658 2.6151338
[154,] 9.050136 6.433687 11.666585 2.6164492
[155,] 9.050766 6.433011 11.668520 2.6177544
[156,] 9.051413 6.432363 11.670462 2.6190497
[157,] 9.052077 6.431742 11.672412 2.6203350
[158,] 9.052758 6.431148 11.674369 2.6216104
[159,] 9.053456 6.430580 11.676332 2.6228760
[160,] 9.054170 6.430038 11.678302 2.6241319
[161,] 9.054900 6.429522 11.680278 2.6253782
[162,] 9.055645 6.429030 11.682260 2.6266148
[163,] 9.056406 6.428564 11.684248 2.6278420
[164,] 9.057181 6.428121 11.686241 2.6290596
[165,] 9.057971 6.427703 11.688238 2.6302679
[166,] 9.058774 6.427307 11.690241 2.6314669
[167,] 9.059592 6.426935 11.692249 2.6326566
[168,] 9.060423 6.426586 11.694260 2.6338371
[169,] 9.061267 6.426259 11.696276 2.6350085
[170,] 9.062124 6.425953 11.698295 2.6361708
[171,] 9.062994 6.425669 11.700318 2.6373241
[172,] 9.063875 6.425407 11.702344 2.6384685
[173,] 9.064769 6.425165 11.704373 2.6396040
[174,] 9.065674 6.424943 11.706405 2.6407307
[175,] 9.066591 6.424742 11.708439 2.6418486
[176,] 9.067518 6.424560 11.710476 2.6429578
[177,] 9.068456 6.424398 11.712515 2.6440584
[178,] 9.069405 6.424255 11.714555 2.6451504
[179,] 9.070364 6.424130 11.716598 2.6462338
[180,] 9.071332 6.424023 11.718641 2.6473088
[181,] 9.072310 6.423935 11.720686 2.6483754
[182,] 9.073298 6.423864 11.722732 2.6494337
[183,] 9.074294 6.423811 11.724778 2.6504836
[184,] 9.075300 6.423774 11.726825 2.6515253
[185,] 9.076313 6.423754 11.728872 2.6525588
[186,] 9.077335 6.423751 11.730919 2.6535842
[187,] 9.078365 6.423764 11.732967 2.6546015
[188,] 9.079403 6.423792 11.735014 2.6556108
[189,] 9.080448 6.423836 11.737060 2.6566121
[190,] 9.081500 6.423895 11.739106 2.6576055
[191,] 9.082559 6.423968 11.741150 2.6585911
[192,] 9.083625 6.424057 11.743194 2.6595688
[193,] 9.084698 6.424159 11.745237 2.6605388
[194,] 9.085777 6.424276 11.747278 2.6615011
[195,] 9.086861 6.424406 11.749317 2.6624557
[196,] 9.087952 6.424549 11.751355 2.6634028
[197,] 9.089048 6.424706 11.753391 2.6643422
[198,] 9.090150 6.424876 11.755424 2.6652742
[199,] 9.091256 6.425058 11.757455 2.6661988
[200,] 9.092368 6.425252 11.759484 2.6671159
[201,] 9.093484 6.425459 11.761510 2.6680257
[202,] 9.094605 6.425677 11.763533 2.6689281
[203,] 9.095730 6.425907 11.765554 2.6698234
[204,] 9.096860 6.426148 11.767571 2.6707114
[205,] 9.097993 6.426400 11.769585 2.6715923
[206,] 9.099129 6.426663 11.771595 2.6724660
[207,] 9.100270 6.426937 11.773602 2.6733327
[208,] 9.101413 6.427221 11.775606 2.6741924
[209,] 9.102560 6.427515 11.777605 2.6750451
[210,] 9.103710 6.427819 11.779601 2.6758909
[211,] 9.104862 6.428132 11.781592 2.6767298
[212,] 9.106017 6.428455 11.783579 2.6775619
[213,] 9.107174 6.428787 11.785562 2.6783872
[214,] 9.108334 6.429128 11.787540 2.6792058
[215,] 9.109496 6.429478 11.789513 2.6800177
[216,] 9.110659 6.429836 11.791482 2.6808229
[217,] 9.111824 6.430203 11.793446 2.6816216
[218,] 9.112991 6.430577 11.795405 2.6824136
[219,] 9.114159 6.430960 11.797358 2.6831992
[220,] 9.115328 6.431350 11.799307 2.6839783
[221,] 9.116499 6.431748 11.801250 2.6847509
[222,] 9.117670 6.432153 11.803187 2.6855172
[223,] 9.118842 6.432565 11.805119 2.6862771
[224,] 9.120015 6.432984 11.807046 2.6870308
[225,] 9.121188 6.433410 11.808966 2.6877781
[226,] 9.122362 6.433842 11.810881 2.6885193
[227,] 9.123535 6.434281 11.812790 2.6892543
[228,] 9.124709 6.434726 11.814692 2.6899831
[229,] 9.125883 6.435177 11.816589 2.6907059
[230,] 9.127056 6.435634 11.818479 2.6914226
[231,] 9.128229 6.436096 11.820362 2.6921333
[232,] 9.129402 6.436564 11.822240 2.6928381
[233,] 9.130574 6.437037 11.824110 2.6935369
[234,] 9.131745 6.437515 11.825975 2.6942298
[235,] 9.132915 6.437998 11.827832 2.6949169
[236,] 9.134084 6.438486 11.829682 2.6955981
[237,] 9.135253 6.438979 11.831526 2.6962736
[238,] 9.136419 6.439476 11.833363 2.6969434
[239,] 9.137585 6.439978 11.835193 2.6976075
[240,] 9.138749 6.440483 11.837015 2.6982659
[241,] 9.139912 6.440993 11.838831 2.6989187
[242,] 9.141073 6.441507 11.840639 2.6995660
[243,] 9.142232 6.442024 11.842439 2.7002077
[244,] 9.143389 6.442545 11.844233 2.7008439
[245,] 9.144544 6.443070 11.846019 2.7014746
[246,] 9.145697 6.443597 11.847797 2.7020999
[247,] 9.146848 6.444128 11.849568 2.7027198
[248,] 9.147997 6.444662 11.851331 2.7033344
[249,] 9.149143 6.445199 11.853087 2.7039437
[250,] 9.150287 6.445739 11.854835 2.7045477
[251,] 9.151428 6.446282 11.856575 2.7051464
[252,] 9.152567 6.446827 11.858307 2.7057400
[253,] 9.153702 6.447374 11.860031 2.7063283
[254,] 9.154835 6.447924 11.861747 2.7069116
[255,] 9.155965 6.448476 11.863455 2.7074897
[256,] 9.157092 6.449030 11.865155 2.7080628
[257,] 9.158216 6.449585 11.866847 2.7086309
[258,] 9.159337 6.450143 11.868531 2.7091939
[259,] 9.160454 6.450702 11.870206 2.7097520
[260,] 9.161569 6.451263 11.871874 2.7103052
[261,] 9.162679 6.451826 11.873533 2.7108535
[262,] 9.163787 6.452390 11.875184 2.7113969
[263,] 9.164890 6.452955 11.876826 2.7119356
[264,] 9.165990 6.453521 11.878460 2.7124694
[265,] 9.167087 6.454088 11.880085 2.7129985
[266,] 9.168180 6.454657 11.881702 2.7135228
[267,] 9.169268 6.455226 11.883311 2.7140425
[268,] 9.170353 6.455796 11.884911 2.7145575
[269,] 9.171434 6.456366 11.886502 2.7150680
[270,] 9.172511 6.456938 11.888085 2.7155738
[271,] 9.173584 6.457509 11.889659 2.7160750
[272,] 9.174653 6.458081 11.891225 2.7165718
[273,] 9.175718 6.458654 11.892782 2.7170640
[274,] 9.176778 6.459226 11.894330 2.7175518
[275,] 9.177834 6.459799 11.895870 2.7180352
[276,] 9.178886 6.460372 11.897400 2.7185142
[277,] 9.179934 6.460945 11.898922 2.7189888
[278,] 9.180976 6.461517 11.900436 2.7194591
[279,] 9.182015 6.462090 11.901940 2.7199251
[280,] 9.183049 6.462662 11.903436 2.7203868
[281,] 9.184078 6.463234 11.904922 2.7208443
[282,] 9.185103 6.463805 11.906400 2.7212975
[283,] 9.186123 6.464376 11.907869 2.7217466
[284,] 9.187138 6.464946 11.909329 2.7221916
[285,] 9.188148 6.465516 11.910781 2.7226324
[286,] 9.189154 6.466085 11.912223 2.7230692
[287,] 9.190155 6.466653 11.913656 2.7235019
[288,] 9.191150 6.467220 11.915081 2.7239306
[289,] 9.192141 6.467786 11.916497 2.7243552
[290,] 9.193127 6.468351 11.917903 2.7247759
[291,] 9.194108 6.468916 11.919301 2.7251927
[292,] 9.195084 6.469479 11.920690 2.7256056
[293,] 9.196055 6.470041 11.922070 2.7260146
[294,] 9.197021 6.470601 11.923441 2.7264197
[295,] 9.197982 6.471161 11.924803 2.7268210
[296,] 9.198937 6.471718 11.926156 2.7272185
[297,] 9.199887 6.472275 11.927500 2.7276123
[298,] 9.200832 6.472830 11.928835 2.7280023
[299,] 9.201772 6.473384 11.930161 2.7283886
[300,] 9.202707 6.473935 11.931478 2.7287713
[301,] 9.203636 6.474486 11.932786 2.7291503
[302,] 9.204560 6.475034 11.934085 2.7295256
[303,] 9.205478 6.475581 11.935376 2.7298974
[304,] 9.206391 6.476126 11.936657 2.7302656
[305,] 9.207299 6.476669 11.937929 2.7306302
[306,] 9.208202 6.477210 11.939193 2.7309914
[307,] 9.209099 6.477750 11.940448 2.7313490
[308,] 9.209990 6.478287 11.941693 2.7317032
[309,] 9.210876 6.478822 11.942930 2.7320540
[310,] 9.211756 6.479355 11.944158 2.7324013
[311,] 9.212631 6.479886 11.945377 2.7327453
[312,] 9.213501 6.480415 11.946587 2.7330859
[313,] 9.214365 6.480942 11.947788 2.7334232
[314,] 9.215223 6.481466 11.948980 2.7337572
[315,] 9.216076 6.481988 11.950164 2.7340879
[316,] 9.216923 6.482508 11.951338 2.7344153
[317,] 9.217765 6.483025 11.952504 2.7347396
[318,] 9.218601 6.483540 11.953661 2.7350606
[319,] 9.219431 6.484053 11.954810 2.7353785
[320,] 9.220256 6.484563 11.955949 2.7356932
[321,] 9.221075 6.485070 11.957080 2.7360048
[322,] 9.221888 6.485575 11.958202 2.7363133
[323,] 9.222696 6.486078 11.959315 2.7366187
[324,] 9.223498 6.486577 11.960419 2.7369210
[325,] 9.224295 6.487074 11.961515 2.7372204
[326,] 9.225086 6.487569 11.962602 2.7375167
[327,] 9.225871 6.488061 11.963681 2.7378101
[328,] 9.226650 6.488550 11.964751 2.7381005
[329,] 9.227424 6.489036 11.965812 2.7383879
[330,] 9.228192 6.489519 11.966864 2.7386725
[331,] 9.228954 6.490000 11.967908 2.7389542
[332,] 9.229711 6.490478 11.968944 2.7392331
[333,] 9.230462 6.490953 11.969971 2.7395091
[334,] 9.231207 6.491425 11.970989 2.7397822
[335,] 9.231946 6.491894 11.971999 2.7400527
[336,] 9.232680 6.492360 11.973000 2.7403203
[337,] 9.233408 6.492823 11.973993 2.7405852
[338,] 9.234130 6.493283 11.974978 2.7408474
[339,] 9.234847 6.493740 11.975954 2.7411069
[340,] 9.235558 6.494194 11.976922 2.7413637
[341,] 9.236263 6.494645 11.977881 2.7416178
[342,] 9.236963 6.495093 11.978832 2.7418694
[343,] 9.237657 6.495538 11.979775 2.7421183
[344,] 9.238345 6.495980 11.980709 2.7423646
[345,] 9.239027 6.496419 11.981636 2.7426084
[346,] 9.239704 6.496854 11.982554 2.7428497
[347,] 9.240375 6.497287 11.983463 2.7430884
[348,] 9.241040 6.497716 11.984365 2.7433246
[349,] 9.241700 6.498142 11.985259 2.7435583
[350,] 9.242354 6.498565 11.986144 2.7437896
[351,] 9.243003 6.498984 11.987021 2.7440185
[352,] 9.243645 6.499400 11.987890 2.7442449
[353,] 9.244282 6.499813 11.988751 2.7444690
[354,] 9.244914 6.500223 11.989605 2.7446907
[355,] 9.245540 6.500630 11.990450 2.7449100
[356,] 9.246160 6.501033 11.991287 2.7451270
[357,] 9.246774 6.501433 11.992116 2.7453417
[358,] 9.247383 6.501829 11.992938 2.7455541
[359,] 9.247987 6.502223 11.993751 2.7457642
[360,] 9.248585 6.502613 11.994557 2.7459721
[361,] 9.249177 6.502999 11.995355 2.7461778
[362,] 9.249764 6.503382 11.996145 2.7463812
[363,] 9.250345 6.503762 11.996927 2.7465825
[364,] 9.250920 6.504139 11.997702 2.7467815
[365,] 9.251490 6.504512 11.998469 2.7469785

$small_biotech
           fcst     lower    upper        CI
  [1,] 46.71585 42.089118 51.34258  4.626729
  [2,] 46.57477 40.058207 53.09133  6.516562
  [3,] 46.43671 38.487990 54.38542  7.948716
  [4,] 46.30160 37.160417 55.44279  9.141184
  [5,] 46.16940 35.990595 56.34821 10.178805
  [6,] 46.04005 34.934758 57.14534 11.105291
  [7,] 45.91349 33.966766 57.86022 11.946726
  [8,] 45.78968 33.069495 58.50987 12.720186
  [9,] 45.66856 32.230976 59.10615 13.437587
 [10,] 45.55009 31.442446 59.65774 14.107645
 [11,] 45.43422 30.697245 60.17119 14.736972
 [12,] 45.32089 29.990164 60.65162 15.330729
 [13,] 45.21007 29.317035 61.10311 15.893039
 [14,] 45.10171 28.674452 61.52898 16.427263
 [15,] 44.99577 28.059589 61.93196 16.936184
 [16,] 44.89220 27.470066 62.31434 17.422139
 [17,] 44.79097 26.903855 62.67808 17.887115
 [18,] 44.69203 26.359208 63.02485 18.332819
 [19,] 44.59534 25.834604 63.35607 18.760733
 [20,] 44.50086 25.328710 63.67301 19.172150
 [21,] 44.40856 24.840347 63.97677 19.568211
 [22,] 44.31839 24.368467 64.26832 19.949928
 [23,] 44.23033 23.912130 64.54854 20.318203
 [24,] 44.14434 23.470491 64.81818 20.673847
 [25,] 44.06037 23.042786 65.07796 21.017588
 [26,] 43.97841 22.628317 65.32850 21.350090
 [27,] 43.89840 22.226451 65.57036 21.671952
 [28,] 43.82033 21.836605 65.80406 21.983725
 [29,] 43.74416 21.458243 66.03007 22.285912
 [30,] 43.66985 21.090871 66.24882 22.578977
 [31,] 43.59738 20.734031 66.46072 22.863345
 [32,] 43.52671 20.387297 66.66612 23.139413
 [33,] 43.45782 20.050273 66.86537 23.407547
 [34,] 43.39068 19.722589 67.05876 23.668087
 [35,] 43.32525 19.403899 67.24660 23.921352
 [36,] 43.26152 19.093877 67.42915 24.167638
 [37,] 43.19944 18.792219 67.60667 24.407223
 [38,] 43.13900 18.498636 67.77937 24.640369
 [39,] 43.08018 18.212856 67.94749 24.867319
 [40,] 43.02293 17.934623 68.11123 25.088306
 [41,] 42.96724 17.663693 68.27078 25.303546
 [42,] 42.91308 17.399836 68.42633 25.513245
 [43,] 42.86043 17.142832 68.57803 25.717598
 [44,] 42.80926 16.892472 68.72605 25.916788
 [45,] 42.75955 16.648559 68.87054 26.110991
 [46,] 42.71128 16.410902 69.01165 26.300373
 [47,] 42.66441 16.179320 69.14950 26.485092
 [48,] 42.61894 15.953640 69.28424 26.665298
 [49,] 42.57483 15.733697 69.41596 26.841133
 [50,] 42.53207 15.519332 69.54480 27.012737
 [51,] 42.49063 15.310391 69.67087 27.180238
 [52,] 42.45049 15.106730 69.79425 27.343761
 [53,] 42.41164 14.908208 69.91506 27.503428
 [54,] 42.37404 14.714689 70.03339 27.659350
 [55,] 42.33768 14.526043 70.14932 27.811640
 [56,] 42.30255 14.342145 70.26295 27.960402
 [57,] 42.26861 14.162875 70.37435 28.105737
 [58,] 42.23586 13.988115 70.48360 28.247742
 [59,] 42.20426 13.817753 70.59078 28.386511
 [60,] 42.17381 13.651681 70.69595 28.522134
 [61,] 42.14449 13.489793 70.79919 28.654697
 [62,] 42.11627 13.331987 70.90056 28.784284
 [63,] 42.08914 13.178166 71.00012 28.910976
 [64,] 42.06308 13.028234 71.09793 29.034849
 [65,] 42.03808 12.882099 71.19406 29.155979
 [66,] 42.01411 12.739671 71.28855 29.274438
 [67,] 41.99116 12.600863 71.38145 29.390296
 [68,] 41.96921 12.465592 71.47283 29.503620
 [69,] 41.94825 12.333775 71.56273 29.614476
 [70,] 41.92826 12.205334 71.65119 29.722927
 [71,] 41.90923 12.080191 71.73826 29.829034
 [72,] 41.89113 11.958272 71.82398 29.932856
 [73,] 41.87395 11.839503 71.90841 30.034451
 [74,] 41.85769 11.723813 71.99156 30.133875
 [75,] 41.84231 11.611134 72.07349 30.231180
 [76,] 41.82782 11.501399 72.15424 30.326420
 [77,] 41.81419 11.394542 72.23383 30.419645
 [78,] 41.80140 11.290499 72.31231 30.510904
 [79,] 41.78945 11.189210 72.38970 30.600245
 [80,] 41.77833 11.090612 72.46604 30.687714
 [81,] 41.76801 10.994648 72.54136 30.773357
 [82,] 41.75848 10.901260 72.61570 30.857218
 [83,] 41.74973 10.810392 72.68907 30.939337
 [84,] 41.74175 10.721990 72.76151 31.019758
 [85,] 41.73452 10.636000 72.83304 31.098521
 [86,] 41.72803 10.552369 72.90370 31.175663
 [87,] 41.72227 10.471049 72.97350 31.251225
 [88,] 41.71723 10.391988 73.04247 31.325241
 [89,] 41.71289 10.315138 73.11064 31.397749
 [90,] 41.70924 10.240453 73.17802 31.468783
 [91,] 41.70626 10.167886 73.24464 31.538378
 [92,] 41.70396 10.097392 73.31053 31.606567
 [93,] 41.70231 10.028926 73.37569 31.673382
 [94,] 41.70130  9.962446 73.44016 31.738855
 [95,] 41.70093  9.897910 73.50394 31.803017
 [96,] 41.70117  9.835276 73.56707 31.865897
 [97,] 41.70203  9.774505 73.62955 31.927524
 [98,] 41.70348  9.715556 73.69141 31.987928
 [99,] 41.70553  9.658391 73.75266 32.047135
[100,] 41.70815  9.602972 73.81332 32.105173
[101,] 41.71133  9.549263 73.87340 32.162069
[102,] 41.71508  9.497228 73.93292 32.217847
[103,] 41.71936  9.446831 73.99190 32.272534
[104,] 41.72419  9.398037 74.05034 32.326153
[105,] 41.72954  9.350813 74.10827 32.378728
[106,] 41.73541  9.305126 74.16569 32.430283
[107,] 41.74178  9.260943 74.22262 32.480841
[108,] 41.74866  9.218232 74.27908 32.530423
[109,] 41.75601  9.176963 74.33507 32.579051
[110,] 41.76385  9.137105 74.39060 32.626747
[111,] 41.77216  9.098627 74.44569 32.673531
[112,] 41.78092  9.061502 74.50035 32.719423
[113,] 41.79014  9.025699 74.55459 32.764443
[114,] 41.79980  8.991192 74.60841 32.808610
[115,] 41.80990  8.957953 74.66184 32.851943
[116,] 41.82041  8.925954 74.71487 32.894460
[117,] 41.83135  8.895170 74.76753 32.936179
[118,] 41.84269  8.865575 74.81981 32.977117
[119,] 41.85444  8.837143 74.87173 33.017293
[120,] 41.86657  8.809849 74.92329 33.056721
[121,] 41.87909  8.783670 74.97451 33.095419
[122,] 41.89198  8.758581 75.02539 33.133403
[123,] 41.90525  8.734559 75.07593 33.170687
[124,] 41.91887  8.711581 75.12616 33.207288
[125,] 41.93285  8.689625 75.17606 33.243220
[126,] 41.94717  8.668669 75.22566 33.278497
[127,] 41.96182  8.648691 75.27496 33.313134
[128,] 41.97681  8.629669 75.32396 33.347145
[129,] 41.99213  8.611585 75.37267 33.380543
[130,] 42.00776  8.594416 75.42110 33.413341
[131,] 42.02369  8.578143 75.46925 33.445552
[132,] 42.03994  8.562747 75.51713 33.477189
[133,] 42.05647  8.548208 75.56474 33.508264
[134,] 42.07330  8.534508 75.61209 33.538790
[135,] 42.09041  8.521628 75.65918 33.568778
[136,] 42.10779  8.509550 75.70603 33.598239
[137,] 42.12544  8.498257 75.75263 33.627185
[138,] 42.14336  8.487731 75.79899 33.655627
[139,] 42.16153  8.477955 75.84511 33.683575
[140,] 42.17995  8.468913 75.89100 33.711041
[141,] 42.19862  8.460588 75.93666 33.738034
[142,] 42.21753  8.452963 75.98209 33.764565
[143,] 42.23667  8.446025 76.02731 33.790642
[144,] 42.25603  8.439756 76.07231 33.816277
[145,] 42.27562  8.434141 76.11710 33.841478
[146,] 42.29542  8.429167 76.16167 33.866254
[147,] 42.31543  8.424818 76.20605 33.890614
[148,] 42.33565  8.421080 76.25022 33.914568
[149,] 42.35606  8.417940 76.29419 33.938124
[150,] 42.37667  8.415382 76.33796 33.961289
[151,] 42.39747  8.413395 76.38154 33.984073
[152,] 42.41845  8.411964 76.42493 34.006483
[153,] 42.43960  8.411078 76.46813 34.028527
[154,] 42.46093  8.410722 76.51115 34.050213
[155,] 42.48243  8.410885 76.55398 34.071548
[156,] 42.50409  8.411555 76.59663 34.092539
[157,] 42.52591  8.412718 76.63911 34.113194
[158,] 42.54789  8.414365 76.68141 34.133520
[159,] 42.57001  8.416483 76.72353 34.153523
[160,] 42.59227  8.419061 76.76548 34.173211
[161,] 42.61468  8.422088 76.80727 34.192589
[162,] 42.63722  8.425553 76.84888 34.211664
[163,] 42.65989  8.429445 76.89033 34.230442
[164,] 42.68268  8.433754 76.93161 34.248929
[165,] 42.70560  8.438470 76.97273 34.267132
[166,] 42.72864  8.443583 77.01369 34.285056
[167,] 42.75179  8.449082 77.05449 34.302706
[168,] 42.77505  8.454958 77.09514 34.320089
[169,] 42.79841  8.461203 77.13562 34.337210
[170,] 42.82188  8.467805 77.17595 34.354073
[171,] 42.84544  8.474757 77.21613 34.370685
[172,] 42.86910  8.482050 77.25615 34.387050
[173,] 42.89285  8.489674 77.29602 34.403174
[174,] 42.91668  8.497621 77.33574 34.419060
[175,] 42.94060  8.505883 77.37531 34.434715
[176,] 42.96459  8.514451 77.41473 34.450141
[177,] 42.98866  8.523318 77.45401 34.465345
[178,] 43.01281  8.532475 77.49314 34.480330
[179,] 43.03702  8.541915 77.53212 34.495101
[180,] 43.06129  8.551630 77.57095 34.509662
[181,] 43.08563  8.561612 77.60964 34.524016
[182,] 43.11002  8.571855 77.64819 34.538169
[183,] 43.13447  8.582350 77.68660 34.552124
[184,] 43.15898  8.593092 77.72486 34.565885
[185,] 43.18353  8.604073 77.76298 34.579455
[186,] 43.20812  8.615286 77.80096 34.592838
[187,] 43.23276  8.626726 77.83880 34.606039
[188,] 43.25744  8.638384 77.87650 34.619059
[189,] 43.28216  8.650255 77.91406 34.631904
[190,] 43.30691  8.662333 77.95148 34.644576
[191,] 43.33169  8.674612 77.98877 34.657078
[192,] 43.35650  8.687085 78.02591 34.669413
[193,] 43.38133  8.699747 78.06292 34.681586
[194,] 43.40619  8.712592 78.09979 34.693598
[195,] 43.43107  8.725614 78.13652 34.705453
[196,] 43.45596  8.738808 78.17312 34.717154
[197,] 43.48087  8.752168 78.20957 34.728703
[198,] 43.50579  8.765690 78.24590 34.740104
[199,] 43.53073  8.779367 78.28208 34.751358
[200,] 43.55566  8.793195 78.31813 34.762470
[201,] 43.58061  8.807169 78.35405 34.773440
[202,] 43.60556  8.821284 78.38983 34.784273
[203,] 43.63050  8.835535 78.42547 34.794969
[204,] 43.65545  8.849917 78.46098 34.805533
[205,] 43.68039  8.864426 78.49636 34.815966
[206,] 43.70533  8.879058 78.53160 34.826270
[207,] 43.73025  8.893807 78.56670 34.836447
[208,] 43.75517  8.908670 78.60167 34.846501
[209,] 43.78007  8.923642 78.63651 34.856432
[210,] 43.80496  8.938720 78.67121 34.866244
[211,] 43.82984  8.953899 78.70577 34.875938
[212,] 43.85469  8.969174 78.74021 34.885516
[213,] 43.87952  8.984544 78.77451 34.894981
[214,] 43.90434  9.000002 78.80867 34.904333
[215,] 43.92912  9.015547 78.84270 34.913576
[216,] 43.95388  9.031173 78.87659 34.922710
[217,] 43.97862  9.046878 78.91035 34.931738
[218,] 44.00332  9.062658 78.94398 34.940662
[219,] 44.02799  9.078510 78.97747 34.949482
[220,] 44.05263  9.094429 79.01083 34.958201
[221,] 44.07723  9.110414 79.04406 34.966821
[222,] 44.10180  9.126461 79.07715 34.975342
[223,] 44.12633  9.142565 79.11010 34.983768
[224,] 44.15082  9.158726 79.14292 34.992098
[225,] 44.17527  9.174939 79.17561 35.000335
[226,] 44.19968  9.191201 79.20816 35.008480
[227,] 44.22404  9.207510 79.24058 35.016534
[228,] 44.24836  9.223863 79.27286 35.024500
[229,] 44.27263  9.240257 79.30501 35.032377
[230,] 44.29686  9.256689 79.33703 35.040168
[231,] 44.32103  9.273156 79.36891 35.047874
[232,] 44.34515  9.289657 79.40065 35.055497
[233,] 44.36922  9.306188 79.43226 35.063036
[234,] 44.39324  9.322748 79.46374 35.070494
[235,] 44.41721  9.339333 79.49508 35.077873
[236,] 44.44111  9.355941 79.52628 35.085172
[237,] 44.46496  9.372570 79.55736 35.092393
[238,] 44.48875  9.389218 79.58829 35.099537
[239,] 44.51249  9.405882 79.61909 35.106606
[240,] 44.53616  9.422560 79.64976 35.113600
[241,] 44.55977  9.439251 79.68029 35.120521
[242,] 44.58332  9.455951 79.71069 35.127369
[243,] 44.60681  9.472660 79.74095 35.134145
[244,] 44.63023  9.489374 79.77108 35.140852
[245,] 44.65358  9.506093 79.80107 35.147488
[246,] 44.67687  9.522814 79.83093 35.154056
[247,] 44.70009  9.539535 79.86065 35.160556
[248,] 44.72324  9.556255 79.89023 35.166989
[249,] 44.74633  9.572972 79.91968 35.173356
[250,] 44.76934  9.589684 79.94900 35.179659
[251,] 44.79229  9.606389 79.97818 35.185896
[252,] 44.81516  9.623086 80.00723 35.192071
[253,] 44.83796  9.639772 80.03614 35.198183
[254,] 44.86068  9.656448 80.06491 35.204233
[255,] 44.88333  9.673110 80.09355 35.210222
[256,] 44.90591  9.689758 80.12206 35.216151
[257,] 44.92841  9.706390 80.15043 35.222020
[258,] 44.95084  9.723005 80.17867 35.227830
[259,] 44.97318  9.739601 80.20677 35.233582
[260,] 44.99545  9.756176 80.23473 35.239277
[261,] 45.01765  9.772731 80.26256 35.244915
[262,] 45.03976  9.789262 80.29026 35.250497
[263,] 45.06179  9.805769 80.31782 35.256024
[264,] 45.08375  9.822252 80.34524 35.261496
[265,] 45.10562  9.838707 80.37254 35.266914
[266,] 45.12741  9.855135 80.39969 35.272278
[267,] 45.14912  9.871534 80.42671 35.277590
[268,] 45.17075  9.887904 80.45360 35.282849
[269,] 45.19230  9.904242 80.48036 35.288057
[270,] 45.21376  9.920548 80.50697 35.293213
[271,] 45.23514  9.936822 80.53346 35.298319
[272,] 45.25644  9.953061 80.55981 35.303375
[273,] 45.27765  9.969265 80.58603 35.308382
[274,] 45.29877  9.985433 80.61211 35.313339
[275,] 45.31981 10.001564 80.63806 35.318248
[276,] 45.34077 10.017657 80.66388 35.323110
[277,] 45.36164 10.033712 80.68956 35.327924
[278,] 45.38242 10.049727 80.71511 35.332691
[279,] 45.40311 10.065702 80.74053 35.337412
[280,] 45.42372 10.081635 80.76581 35.342087
[281,] 45.44424 10.097526 80.79096 35.346716
[282,] 45.46468 10.113375 80.81598 35.351301
[283,] 45.48502 10.129180 80.84086 35.355841
[284,] 45.50528 10.144940 80.86561 35.360337
[285,] 45.52545 10.160656 80.89023 35.364789
[286,] 45.54552 10.176326 80.91472 35.369199
[287,] 45.56552 10.191950 80.93908 35.373565
[288,] 45.58542 10.207527 80.96331 35.377889
[289,] 45.60523 10.223056 80.98740 35.382172
[290,] 45.62495 10.238537 81.01136 35.386413
[291,] 45.64458 10.253970 81.03519 35.390612
[292,] 45.66412 10.269353 81.05890 35.394771
[293,] 45.68358 10.284686 81.08247 35.398890
[294,] 45.70294 10.299969 81.10591 35.402969
[295,] 45.72221 10.315200 81.12922 35.407009
[296,] 45.74139 10.330380 81.15240 35.411009
[297,] 45.76048 10.345509 81.17545 35.414970
[298,] 45.77948 10.360585 81.19837 35.418893
[299,] 45.79839 10.375608 81.22116 35.422778
[300,] 45.81720 10.390578 81.24383 35.426625
[301,] 45.83593 10.405494 81.26636 35.430435
[302,] 45.85456 10.420355 81.28877 35.434208
[303,] 45.87311 10.435163 81.31105 35.437944
[304,] 45.89156 10.449915 81.33320 35.441644
[305,] 45.90992 10.464612 81.35523 35.445308
[306,] 45.92819 10.479254 81.37713 35.448936
[307,] 45.94637 10.493839 81.39890 35.452528
[308,] 45.96445 10.508369 81.42054 35.456086
[309,] 45.98245 10.522841 81.44206 35.459609
[310,] 46.00035 10.537257 81.46345 35.463097
[311,] 46.01817 10.551615 81.48472 35.466552
[312,] 46.03589 10.565916 81.50586 35.469972
[313,] 46.05352 10.580160 81.52688 35.473359
[314,] 46.07106 10.594345 81.54777 35.476713
[315,] 46.08851 10.608472 81.56854 35.480034
[316,] 46.10586 10.622540 81.58918 35.483322
[317,] 46.12313 10.636550 81.60971 35.486577
[318,] 46.14030 10.650501 81.63010 35.489801
[319,] 46.15739 10.664393 81.65038 35.492993
[320,] 46.17438 10.678225 81.67053 35.496153
[321,] 46.19128 10.691998 81.69056 35.499282
[322,] 46.20809 10.705711 81.71047 35.502380
[323,] 46.22481 10.719365 81.73026 35.505448
[324,] 46.24144 10.732958 81.74993 35.508485
[325,] 46.25798 10.746492 81.76947 35.511491
[326,] 46.27443 10.759965 81.78890 35.514468
[327,] 46.29079 10.773378 81.80821 35.517415
[328,] 46.30706 10.786730 81.82740 35.520333
[329,] 46.32324 10.800022 81.84646 35.523221
[330,] 46.33933 10.813253 81.86541 35.526081
[331,] 46.35534 10.826423 81.88425 35.528912
[332,] 46.37125 10.839533 81.90296 35.531714
[333,] 46.38707 10.852581 81.92156 35.534489
[334,] 46.40280 10.865569 81.94004 35.537235
[335,] 46.41845 10.878495 81.95840 35.539953
[336,] 46.43400 10.891360 81.97665 35.542645
[337,] 46.44947 10.904164 81.99478 35.545308
[338,] 46.46485 10.916907 82.01280 35.547945
[339,] 46.48014 10.929589 82.03070 35.550555
[340,] 46.49535 10.942210 82.04849 35.553139
[341,] 46.51046 10.954769 82.06616 35.555696
[342,] 46.52549 10.967267 82.08372 35.558227
[343,] 46.54044 10.979703 82.10117 35.560732
[344,] 46.55529 10.992079 82.11850 35.563212
[345,] 46.57006 11.004393 82.13572 35.565666
[346,] 46.58474 11.016646 82.15284 35.568095
[347,] 46.59934 11.028837 82.16983 35.570499
[348,] 46.61385 11.040968 82.18672 35.572878
[349,] 46.62827 11.053037 82.20350 35.575232
[350,] 46.64261 11.065045 82.22017 35.577563
[351,] 46.65686 11.076992 82.23673 35.579868
[352,] 46.67103 11.088878 82.25318 35.582150
[353,] 46.68511 11.100703 82.26952 35.584409
[354,] 46.69911 11.112467 82.28575 35.586643
[355,] 46.71302 11.124170 82.30188 35.588855
[356,] 46.72685 11.135812 82.31790 35.591043
[357,] 46.74060 11.147393 82.33381 35.593208
[358,] 46.75426 11.158914 82.34962 35.595351
[359,] 46.76784 11.170374 82.36532 35.597471
[360,] 46.78134 11.181774 82.38091 35.599568
[361,] 46.79476 11.193113 82.39640 35.601644
[362,] 46.80809 11.204392 82.41179 35.603697
[363,] 46.82134 11.215611 82.42707 35.605729
[364,] 46.83451 11.226770 82.44225 35.607739
[365,] 46.84760 11.237868 82.45732 35.609727</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/forecast_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="how-the-lifestyle-influences-the-mortality-rates-of-major-diseases" class="level1">
<h1>2. How the lifestyle influences the mortality rates of major diseases?</h1>
<p>Lifestyle factors such as smoking prevalence and alcohol consumption are significant determinants of mortality rates from major diseases like cancer, heart disease, and diabetes. Smoking is a well-known risk factor for many types of cancer and cardiovascular diseases, and it exacerbates the complications associated with diabetes. Similarly, excessive alcohol consumption is linked to a range of health issues, including liver diseases, cardiovascular problems, and certain cancers. A <code>VAR</code> model incorporating these lifestyle variables could reveal the extent to which changes in smoking and drinking behaviors might predict fluctuations in mortality rates from these diseases, reflecting the impact of public health interventions and societal shifts in behavior.</p>
<p><strong>(VAR) Mortality rates of major disease(Cancer, Heart Disease, Diabetes) ~ Smoking Prevalance + Alcohol Consumption</strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Data Visualization</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">VARselect</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Initial Model Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Cross-Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Model Creation and Diagnostics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Forecasting</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>The top panel shows a declining trend in total deaths of major diseases, suggesting improvements in healthcare or effective disease prevention and management strategies over time.The middle panel indicates a steady decline in adult smoking rates, which historically correlates with public health initiatives and smoking cessation programs. This trend is consistent with the falling mortality rates, supporting the view that reduced smoking prevalence can lead to lower mortality from smoking-related diseases. The bottom panel shows alcohol consumption, which seems relatively stable with slight fluctuations. The stability in alcohol consumption, juxtaposed against declining mortality rates, might imply that alcohol may not be as significant a factor in the total mortality rate from these major diseases as smoking, or it may suggest that the effects of alcohol consumption on mortality may be more complex and influenced by other factors such as drinking patterns or socioeconomic status.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lifestyle_mortality_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(lifestyle_mortality[,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>)], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1970</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lifestyle_mortality_ts[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="at">facets=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"#27aeef"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Variables Influencing the Total Mortality Rates of Major Diseases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/data_visualization_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Based on the VARselect function, the optimal p for VAR(p) is 6.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(lifestyle_mortality_ts, <span class="at">lag.max=</span><span class="dv">6</span>, <span class="at">type=</span><span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     6      6      6      6 

$criteria
               1        2        3         4          5          6
AIC(n)  4.021194 1.537451 1.349325 0.6786107 -0.4376741 -1.2718053
HQ(n)   4.246761 1.898358 1.845573 1.3101986  0.3292540 -0.3695368
SC(n)   4.629440 2.510645 2.687467 2.3817008  1.6303638  1.1611806
FPE(n) 55.932829 4.710134 3.982071 2.1112004  0.7329008  0.3476392</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>We run the VAR() model with p = 6.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitvar3<span class="ot">&lt;-</span>vars<span class="sc">::</span><span class="fu">VAR</span>(lifestyle_mortality_ts, <span class="at">p=</span><span class="dv">6</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: Total_Deaths, Num_Adult_Smokers, Alcohol_Consumption 
Deterministic variables: both 
Sample size: 44 
Log Likelihood: -99.32 
Roots of the characteristic polynomial:
0.9935 0.9935 0.9883 0.9883 0.9373 0.9373 0.9347 0.9347 0.8843 0.8843 0.8782 0.8755 0.8755 0.8695 0.8695 0.8461 0.8461  0.26
Call:
vars::VAR(y = lifestyle_mortality_ts, p = 6, type = "both")


Estimation results for equation Total_Deaths: 
============================================= 
Total_Deaths = Total_Deaths.l1 + Num_Adult_Smokers.l1 + Alcohol_Consumption.l1 + Total_Deaths.l2 + Num_Adult_Smokers.l2 + Alcohol_Consumption.l2 + Total_Deaths.l3 + Num_Adult_Smokers.l3 + Alcohol_Consumption.l3 + Total_Deaths.l4 + Num_Adult_Smokers.l4 + Alcohol_Consumption.l4 + Total_Deaths.l5 + Num_Adult_Smokers.l5 + Alcohol_Consumption.l5 + Total_Deaths.l6 + Num_Adult_Smokers.l6 + Alcohol_Consumption.l6 + const + trend 

                         Estimate Std. Error t value Pr(&gt;|t|)    
Total_Deaths.l1        -6.446e-01  5.319e-01  -1.212  0.23736    
Num_Adult_Smokers.l1    2.409e+01  1.124e+01   2.143  0.04242 *  
Alcohol_Consumption.l1  1.342e+03  8.250e+02   1.627  0.11678    
Total_Deaths.l2        -3.610e-01  4.218e-01  -0.856  0.40043    
Num_Adult_Smokers.l2   -1.993e+01  8.816e+00  -2.260  0.03314 *  
Alcohol_Consumption.l2 -2.566e+03  1.199e+03  -2.141  0.04266 *  
Total_Deaths.l3         2.425e+00  1.457e+00   1.664  0.10905    
Num_Adult_Smokers.l3    7.741e+00  1.054e+01   0.734  0.46979    
Alcohol_Consumption.l3  9.710e+02  8.584e+02   1.131  0.26919    
Total_Deaths.l4         5.088e-03  8.193e-01   0.006  0.99510    
Num_Adult_Smokers.l4   -5.067e+01  1.188e+01  -4.264  0.00027 ***
Alcohol_Consumption.l4  1.800e+02  6.809e+02   0.264  0.79374    
Total_Deaths.l5        -1.127e+00  1.106e+00  -1.019  0.31852    
Num_Adult_Smokers.l5    2.687e+01  1.497e+01   1.794  0.08537 .  
Alcohol_Consumption.l5 -5.069e+02  4.427e+02  -1.145  0.26351    
Total_Deaths.l6         3.191e-01  7.187e-01   0.444  0.66098    
Num_Adult_Smokers.l6   -9.528e+00  1.061e+01  -0.898  0.37826    
Alcohol_Consumption.l6  3.972e+02  2.094e+02   1.897  0.06997 .  
const                   1.532e+03  2.178e+03   0.703  0.48857    
trend                  -2.570e-01  5.959e-01  -0.431  0.67012    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 46.1 on 24 degrees of freedom
Multiple R-Squared: 0.827,  Adjusted R-squared:  0.69 
F-statistic: 6.037 on 19 and 24 DF,  p-value: 3.204e-05 


Estimation results for equation Num_Adult_Smokers: 
================================================== 
Num_Adult_Smokers = Total_Deaths.l1 + Num_Adult_Smokers.l1 + Alcohol_Consumption.l1 + Total_Deaths.l2 + Num_Adult_Smokers.l2 + Alcohol_Consumption.l2 + Total_Deaths.l3 + Num_Adult_Smokers.l3 + Alcohol_Consumption.l3 + Total_Deaths.l4 + Num_Adult_Smokers.l4 + Alcohol_Consumption.l4 + Total_Deaths.l5 + Num_Adult_Smokers.l5 + Alcohol_Consumption.l5 + Total_Deaths.l6 + Num_Adult_Smokers.l6 + Alcohol_Consumption.l6 + const + trend 

                         Estimate Std. Error t value Pr(&gt;|t|)    
Total_Deaths.l1         -0.014574   0.018253  -0.798 0.432461    
Num_Adult_Smokers.l1     0.821901   0.385720   2.131 0.043549 *  
Alcohol_Consumption.l1  70.999042  28.311290   2.508 0.019316 *  
Total_Deaths.l2         -0.067179   0.014474  -4.641 0.000103 ***
Num_Adult_Smokers.l2    -0.159797   0.302534  -0.528 0.602213    
Alcohol_Consumption.l2 -62.389930  41.132719  -1.517 0.142381    
Total_Deaths.l3          0.047173   0.049994   0.944 0.354788    
Num_Adult_Smokers.l3     1.248181   0.361712   3.451 0.002081 ** 
Alcohol_Consumption.l3  30.909512  29.459138   1.049 0.304522    
Total_Deaths.l4          0.037187   0.028116   1.323 0.198421    
Num_Adult_Smokers.l4    -1.932315   0.407786  -4.739 8.07e-05 ***
Alcohol_Consumption.l4 -22.573892  23.365545  -0.966 0.343620    
Total_Deaths.l5          0.016786   0.037953   0.442 0.662237    
Num_Adult_Smokers.l5     0.524944   0.513849   1.022 0.317162    
Alcohol_Consumption.l5  -8.083185  15.193102  -0.532 0.599596    
Total_Deaths.l6          0.019777   0.024663   0.802 0.430495    
Num_Adult_Smokers.l6    -1.058650   0.364242  -2.906 0.007742 ** 
Alcohol_Consumption.l6   4.951450   7.187283   0.689 0.497481    
const                   19.545547  74.756063   0.261 0.795970    
trend                   -0.008017   0.020451  -0.392 0.698495    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 1.582 on 24 degrees of freedom
Multiple R-Squared: 0.923,  Adjusted R-squared: 0.8621 
F-statistic: 15.15 on 19 and 24 DF,  p-value: 4.496e-09 


Estimation results for equation Alcohol_Consumption: 
==================================================== 
Alcohol_Consumption = Total_Deaths.l1 + Num_Adult_Smokers.l1 + Alcohol_Consumption.l1 + Total_Deaths.l2 + Num_Adult_Smokers.l2 + Alcohol_Consumption.l2 + Total_Deaths.l3 + Num_Adult_Smokers.l3 + Alcohol_Consumption.l3 + Total_Deaths.l4 + Num_Adult_Smokers.l4 + Alcohol_Consumption.l4 + Total_Deaths.l5 + Num_Adult_Smokers.l5 + Alcohol_Consumption.l5 + Total_Deaths.l6 + Num_Adult_Smokers.l6 + Alcohol_Consumption.l6 + const + trend 

                         Estimate Std. Error t value Pr(&gt;|t|)    
Total_Deaths.l1         2.695e-04  2.058e-04   1.309 0.202786    
Num_Adult_Smokers.l1    4.560e-03  4.349e-03   1.048 0.304903    
Alcohol_Consumption.l1  1.025e+00  3.192e-01   3.212 0.003727 ** 
Total_Deaths.l2        -1.159e-03  1.632e-04  -7.103 2.42e-07 ***
Num_Adult_Smokers.l2   -1.840e-03  3.411e-03  -0.539 0.594664    
Alcohol_Consumption.l2 -8.813e-01  4.638e-01  -1.900 0.069477 .  
Total_Deaths.l3         4.231e-04  5.637e-04   0.750 0.460253    
Num_Adult_Smokers.l3    3.165e-03  4.079e-03   0.776 0.445357    
Alcohol_Consumption.l3 -3.112e-01  3.322e-01  -0.937 0.358160    
Total_Deaths.l4         6.835e-04  3.170e-04   2.156 0.041329 *  
Num_Adult_Smokers.l4   -2.001e-02  4.598e-03  -4.352 0.000216 ***
Alcohol_Consumption.l4  3.231e-01  2.635e-01   1.226 0.231972    
Total_Deaths.l5        -6.804e-04  4.280e-04  -1.590 0.124925    
Num_Adult_Smokers.l5   -3.243e-04  5.794e-03  -0.056 0.955826    
Alcohol_Consumption.l5 -1.505e-01  1.713e-01  -0.879 0.388369    
Total_Deaths.l6        -1.036e-04  2.781e-04  -0.373 0.712768    
Num_Adult_Smokers.l6   -1.395e-03  4.107e-03  -0.340 0.737027    
Alcohol_Consumption.l6  4.935e-02  8.104e-02   0.609 0.548273    
const                   3.121e+00  8.429e-01   3.703 0.001112 ** 
trend                  -6.576e-05  2.306e-04  -0.285 0.777959    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.01784 on 24 degrees of freedom
Multiple R-Squared: 0.984,  Adjusted R-squared: 0.9714 
F-statistic: 77.82 on 19 and 24 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
                    Total_Deaths Num_Adult_Smokers Alcohol_Consumption
Total_Deaths           2124.9081          64.60675           0.5627289
Num_Adult_Smokers        64.6067           2.50256           0.0109549
Alcohol_Consumption       0.5627           0.01095           0.0003182

Correlation matrix of residuals:
                    Total_Deaths Num_Adult_Smokers Alcohol_Consumption
Total_Deaths              1.0000            0.8860              0.6844
Num_Adult_Smokers         0.8860            1.0000              0.3882
Alcohol_Consumption       0.6844            0.3882              1.0000</code></pre>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>We use cross-validation to compare two models: VAR(6) and VAR(5). And the best model which is selected by the cross-validation process is <code>VAR(6)</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Cross-validation</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">=</span> <span class="dv">5</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>best_performance <span class="ot">&lt;-</span> <span class="cn">Inf</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>fold_s <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(lifestyle_mortality_ts)<span class="sc">/</span>folds)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1970</span><span class="sc">:</span><span class="dv">2019</span>),<span class="at">each =</span><span class="dv">1</span>) <span class="co">#year</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>folds){</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> (fold<span class="dv">-1</span>)<span class="sc">*</span>fold_s<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">&lt;-</span> fold<span class="sc">*</span>fold_s</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  train_model <span class="ot">&lt;-</span> lifestyle_mortality_ts[<span class="sc">-</span>(start<span class="sc">:</span>end), ]</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  test_model <span class="ot">&lt;-</span> lifestyle_mortality_ts[start<span class="sc">:</span>end, ]</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(train_model, <span class="at">lag.max =</span> <span class="dv">6</span>, <span class="at">type =</span> <span class="st">"both"</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  best_lag <span class="ot">&lt;-</span> sel<span class="sc">$</span>selection[<span class="dv">1</span>]</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the fit models</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">6</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">5</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">nrow</span>(test_model)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the prediction</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">n.ahead =</span> h)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> h)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  pred_deaths <span class="ot">&lt;-</span> pred<span class="sc">$</span>fcst<span class="sc">$</span>Total_Deaths[,<span class="dv">1</span>]</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  pred_deaths2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fcst<span class="sc">$</span>Total_Deaths[,<span class="dv">1</span>]</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_deaths <span class="sc">-</span> test_model[, <span class="st">"Total_Deaths"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  mse2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_deaths2 <span class="sc">-</span> test_model[, <span class="st">"Total_Deaths"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  rmse1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse1, <span class="fu">data.frame</span>(<span class="at">Total_Deaths =</span> <span class="fu">sqrt</span>(mse)))</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  rmse2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse2, <span class="fu">data.frame</span>(<span class="at">Total_Deaths =</span> <span class="fu">sqrt</span>(mse2)))</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mse <span class="sc">&lt;</span> best_performance){</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(mse2 <span class="sc">&lt;</span> best_performance){</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit2</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse2</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the RMSE of two models</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmse1<span class="sc">$</span>Total_Deaths, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Fold"</span>, <span class="at">ylab =</span> <span class="st">"RMSE"</span>, <span class="at">main =</span> <span class="st">"RMSE of VAR(6) and VAR(5)"</span>)</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(rmse2<span class="sc">$</span>Total_Deaths, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"VAR(6)"</span>, <span class="st">"VAR(5)"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/cross_validation_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<p>The models VAR(6) and VAR(5) are created. The serial correlation test is performed on both models. The results show that the VAR(6) model has a lower p-value, indicating that the residuals are not serially correlated. Based on the p-value and ACF plots, the VAR(6) model is selected as the final model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>var_model_3 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(lifestyle_mortality_ts, <span class="at">p=</span><span class="dv">6</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>lm.serial <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_3, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>) </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>lm.serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_3
Chi-squared = 181.05, df = 54, p-value = 1.221e-15</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial, <span class="at">names =</span> <span class="st">"Total_Deaths"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial, <span class="at">names =</span> <span class="st">"Num_Adult_Smokers"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial, <span class="at">names =</span> <span class="st">"Alcohol_Consumption"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>var_model_4 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(lifestyle_mortality_ts, <span class="at">p=</span><span class="dv">5</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>lm.serial2 <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_4, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>lm.serial2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_4
Chi-squared = 164.16, df = 63, p-value = 5.846e-11</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial2, <span class="at">names =</span> <span class="st">"Total_Deaths"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial2, <span class="at">names =</span> <span class="st">"Num_Adult_Smokers"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm.serial2, <span class="at">names =</span> <span class="st">"Alcohol_Consumption"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_creation_2-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<p><code>Total Major Diseases Deaths</code> show a first increasing then decreasing trend, indicating an expectation of decline but with some uncertainty. The <code>Number of Adult Smokers</code> shows an increase trend, then decrease. The <code>Alcohol Consumption</code> shows a small increase, and then a huge decrease.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forecasting</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(fitvar3, <span class="at">n.ahead =</span> <span class="dv">5</span>, <span class="at">ci =</span> <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$Total_Deaths
         fcst    lower    upper        CI
[1,] 584.4412 494.0932 674.7891  90.34792
[2,] 570.3451 467.3448 673.3455 103.00035
[3,] 591.2256 483.8303 698.6208 107.39527
[4,] 595.1272 471.2067 719.0478 123.92054
[5,] 504.2740 374.7316 633.8164 129.54244

$Num_Adult_Smokers
         fcst    lower    upper       CI
[1,] 44.06137 40.96081 47.16193 3.100558
[2,] 47.52614 43.22556 51.82671 4.300575
[3,] 48.32198 43.45892 53.18505 4.863062
[4,] 51.34189 45.42781 57.25597 5.914080
[5,] 49.74122 43.66348 55.81896 6.077737

$Alcohol_Consumption
         fcst    lower    upper         CI
[1,] 2.486055 2.451094 2.521015 0.03496093
[2,] 2.658562 2.584408 2.732715 0.07415365
[3,] 2.507023 2.418532 2.595514 0.08849080
[4,] 2.335424 2.174391 2.496458 0.16103368
[5,] 2.249375 2.072146 2.426603 0.17722881</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/forecast_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="how-the-average-life-expectancy-of-the-us-be-influenced-by-the-mortality-rates-of-cancer-heart-diseases-diabetes-and-infant-mortality-rates" class="level1">
<h1>3. How the average life expectancy of the US be influenced by the mortality rates of Cancer, Heart Diseases, Diabetes, and infant mortality rates?</h1>
<p>The average life expectancy in the U.S. could be influenced by the mortality rates of major diseases like Cancer, Heart Diseases, and Diabetes, as well as infant mortality rates, because these are significant indicators of overall population health. If mortality rates from these diseases decrease due to better healthcare, prevention, and treatment, life expectancy is likely to increase. <code>An ARIMAX model</code> that incorporates these mortality rates as exogenous variables would allow for an assessment of how changes in these rates could impact average life expectancy. The inclusion of infant mortality rates accounts for early-life factors, which are crucial determinants of life expectancy trends.</p>
<p><strong>(ARIMAX) Average Life Expectancy ~ Mortality rates of major disease(Cancer, Heart Diseases, Diabetes) + Infant Mortality rates</strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Data Visualization</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Auto ARIMA</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Manual Model Fitting</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Best Models Residuals</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">Cross-Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false">Forecasting</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>As illustrated by the plots, average life expectancy shows an upward trend, which is typically a sign of improving overall health and healthcare in a population. Concurrently, mortality rates from cancer, heart disease, and diabetes are declining, which could be a contributing factor to increasing life expectancy. Similarly, the declining trend in infant mortality rates is another positive indicator, as lower infant mortality is directly related to higher life expectancy.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(life_expectancy_mortality_ts, <span class="at">facets=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"#27aeef"</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Variables Influencing the Average Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/data_visualization_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Based on the results we got, we can see the <code>Auto ARIMA</code> function select the model ARMA(2,0). And the residuals are not correlated.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  life_expectancy_mortality_ts[, <span class="st">"Death_Cancer"</span>],</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  life_expectancy_mortality_ts[, <span class="st">"Death_Heart_Disease"</span>],</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  life_expectancy_mortality_ts[, <span class="st">"Death_Diabetes"</span>],</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  life_expectancy_mortality_ts[, <span class="st">"Infant_Mortality_Rates"</span>]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>fit_expectancy_mortality <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(life_expectancy_mortality_ts[, <span class="st">"Life_Expectancy"</span>], <span class="at">xreg =</span> xreg)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_expectancy_mortality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: life_expectancy_mortality_ts[, "Life_Expectancy"] 
Regression with ARIMA(2,0,0) errors 

Coefficients:
         ar1      ar2  intercept
      1.0801  -0.7378    84.9804
s.e.  0.1820   0.1521     0.4888
      life_expectancy_mortality_ts[, "Death_Cancer"]
                                              0.0038
s.e.                                          0.0060
      life_expectancy_mortality_ts[, "Death_Heart_Disease"]
                                                    -0.0174
s.e.                                                 0.0026
      life_expectancy_mortality_ts[, "Death_Diabetes"]
                                               -0.1160
s.e.                                            0.0244
      life_expectancy_mortality_ts[, "Infant_Mortality_Rates"]
                                                       -0.2179
s.e.                                                    0.1484

sigma^2 = 0.002603:  log likelihood = 34.41
AIC=-52.82   AICc=-39.73   BIC=-44.85

Training set error measures:
                       ME     RMSE        MAE          MPE       MAPE      MASE
Training set 0.0002198822 0.041134 0.02996728 0.0002854916 0.03825511 0.2085635
                   ACF1
Training set -0.1195763</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residuals</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_expectancy_mortality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/auto_arima_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(2,0,0) errors
Q* = 3.3216, df = 3, p-value = 0.3446

Model df: 2.   Total lags used: 5</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Firstly, we fit the regression model of Life Expectancy on the mortality rates of major diseases and infant mortality rates. The model shows that the mortality rates of cancer, heart disease, and diabetes are significant predictors of life expectancy. Then we take the residuals of this model and fit several ARIMA models to them. We’ll choose the best ARIMA model based on the AIC and BIC values. As we can see from the results, the best ARIMA models are <code>ARMA(2,2)</code>, and <code>ARMA(2,1)</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the dataset to time series</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality<span class="sc">$</span>Life_Expectancy <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality<span class="sc">$</span>Life_Expectancy, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality<span class="sc">$</span>Death_Cancer <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality<span class="sc">$</span>Death_Cancer, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality<span class="sc">$</span>Death_Heart_Disease <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality<span class="sc">$</span>Death_Heart_Disease, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality<span class="sc">$</span>Death_Diabetes <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality<span class="sc">$</span>Death_Diabetes, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>life_expectancy_mortality<span class="sc">$</span>Infant_Mortality_Rates <span class="ot">&lt;-</span> <span class="fu">ts</span>(life_expectancy_mortality<span class="sc">$</span>Infant_Mortality_Rates, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2019</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="do">############# First fit the linear model##########</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>fit.reg_expectancy_mortality <span class="ot">&lt;-</span> <span class="fu">lm</span>(Life_Expectancy <span class="sc">~</span> Death_Cancer <span class="sc">+</span> Death_Heart_Disease <span class="sc">+</span> Death_Diabetes <span class="sc">+</span> Infant_Mortality_Rates, <span class="at">data =</span> life_expectancy_mortality)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg_expectancy_mortality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Life_Expectancy ~ Death_Cancer + Death_Heart_Disease + 
    Death_Diabetes + Infant_Mortality_Rates, data = life_expectancy_mortality)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.16589 -0.03271  0.01128  0.03038  0.13291 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            84.663004   0.621863 136.144  &lt; 2e-16 ***
Death_Cancer            0.017860   0.009697   1.842   0.0853 .  
Death_Heart_Disease    -0.020004   0.003182  -6.286 1.46e-05 ***
Death_Diabetes         -0.072540   0.035171  -2.063   0.0569 .  
Infant_Mortality_Rates -0.630844   0.270555  -2.332   0.0341 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.07763 on 15 degrees of freedom
Multiple R-squared:  0.9927,    Adjusted R-squared:  0.9908 
F-statistic: 510.3 on 4 and 15 DF,  p-value: 7.929e-16</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual Fit</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>res.fit_em <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg_expectancy_mortality), <span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(res.fit_em, <span class="at">lag.max =</span> <span class="dv">30</span>) <span class="co"># q=1,2,3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_fitting_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(res.fit_em, <span class="at">lag.max =</span> <span class="dv">30</span>) <span class="co"># p=1,2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/model_fitting_3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We don't need differencing as the data is already stationary</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual Fitting the models</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>d<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">*</span><span class="dv">25</span>),<span class="at">nrow=</span><span class="dv">25</span>) <span class="co"># roughly nrow = 5x2 (see below)</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)<span class="co"># p=0,1,2,3 : 4</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(q <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)<span class="co"># q=0,1,2,3 :4</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit_em, <span class="at">order=</span><span class="fu">c</span>(p,d,q),<span class="at">include.drift=</span><span class="cn">TRUE</span>) </span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p,d,q,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(output)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co">#temp</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">p</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">q</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">AICc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-45.22928</td>
<td style="text-align: right;">-42.24209</td>
<td style="text-align: right;">-43.72928</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-50.83552</td>
<td style="text-align: right;">-46.85259</td>
<td style="text-align: right;">-48.16886</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-49.30000</td>
<td style="text-align: right;">-44.32134</td>
<td style="text-align: right;">-45.01429</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-52.44608</td>
<td style="text-align: right;">-46.47169</td>
<td style="text-align: right;">-45.98454</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-47.11440</td>
<td style="text-align: right;">-43.13147</td>
<td style="text-align: right;">-44.44773</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-49.05043</td>
<td style="text-align: right;">-44.07177</td>
<td style="text-align: right;">-44.76472</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-50.98358</td>
<td style="text-align: right;">-45.00918</td>
<td style="text-align: right;">-44.52204</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-50.94297</td>
<td style="text-align: right;">-43.97284</td>
<td style="text-align: right;">-41.60963</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-53.40464</td>
<td style="text-align: right;">-48.42598</td>
<td style="text-align: right;">-49.11892</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-58.69264</td>
<td style="text-align: right;">-52.71825</td>
<td style="text-align: right;">-52.23111</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-59.06576</td>
<td style="text-align: right;">-52.09564</td>
<td style="text-align: right;">-49.73243</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-58.88831</td>
<td style="text-align: right;">-50.92245</td>
<td style="text-align: right;">-45.79740</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-52.83544</td>
<td style="text-align: right;">-46.86104</td>
<td style="text-align: right;">-46.37390</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-56.77333</td>
<td style="text-align: right;">-49.80321</td>
<td style="text-align: right;">-47.44000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-55.37811</td>
<td style="text-align: right;">-47.41225</td>
<td style="text-align: right;">-42.28720</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-57.28889</td>
<td style="text-align: right;">-48.32730</td>
<td style="text-align: right;">-39.28889</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#output</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
11 2 0 2 -59.06576 -52.09564 -49.73243</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
10 2 0 1 -58.69264 -52.71825 -52.23111</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
10 2 0 1 -58.69264 -52.71825 -52.23111</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<p>Here, we do the model diagnostics for the best models we got from the manual fitting. The best models are <code>ARMA(2,2)</code> and <code>ARMA(2,1)</code>. From the results, we can say <code>ARMA(2,1)</code> is the better model. Let’s move to the cross-validation step to find which model is better to forecast.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit_em, <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "initial  value -2.651140 "                                 
  [2] "iter   2 value -2.892889"                                  
  [3] "iter   3 value -2.906275"                                  
  [4] "iter   4 value -2.937897"                                  
  [5] "iter   5 value -3.007801"                                  
  [6] "iter   6 value -3.044662"                                  
  [7] "iter   7 value -3.141007"                                  
  [8] "iter   8 value -3.157433"                                  
  [9] "iter   9 value -3.184432"                                  
 [10] "iter  10 value -3.252894"                                  
 [11] "iter  11 value -3.310655"                                  
 [12] "iter  12 value -3.318604"                                  
 [13] "iter  13 value -3.362692"                                  
 [14] "iter  14 value -3.379019"                                  
 [15] "iter  15 value -3.383407"                                  
 [16] "iter  16 value -3.391760"                                  
 [17] "iter  17 value -3.405274"                                  
 [18] "iter  17 value -3.405274"                                  
 [19] "iter  18 value -3.408156"                                  
 [20] "iter  19 value -3.408261"                                  
 [21] "iter  20 value -3.409250"                                  
 [22] "iter  21 value -3.409495"                                  
 [23] "iter  22 value -3.409950"                                  
 [24] "iter  23 value -3.410259"                                  
 [25] "iter  24 value -3.410551"                                  
 [26] "iter  25 value -3.410884"                                  
 [27] "iter  26 value -3.411122"                                  
 [28] "iter  27 value -3.411460"                                  
 [29] "iter  28 value -3.411684"                                  
 [30] "iter  29 value -3.412018"                                  
 [31] "iter  30 value -3.412241"                                  
 [32] "iter  31 value -3.412567"                                  
 [33] "iter  32 value -3.412795"                                  
 [34] "iter  33 value -3.413112"                                  
 [35] "iter  34 value -3.413347"                                  
 [36] "iter  35 value -3.413654"                                  
 [37] "iter  36 value -3.413898"                                  
 [38] "iter  37 value -3.414194"                                  
 [39] "iter  38 value -3.414447"                                  
 [40] "iter  39 value -3.414733"                                  
 [41] "iter  40 value -3.414995"                                  
 [42] "iter  41 value -3.415269"                                  
 [43] "iter  42 value -3.415541"                                  
 [44] "iter  43 value -3.415804"                                  
 [45] "iter  44 value -3.416086"                                  
 [46] "iter  45 value -3.416337"                                  
 [47] "iter  46 value -3.416630"                                  
 [48] "iter  47 value -3.416869"                                  
 [49] "iter  48 value -3.417172"                                  
 [50] "iter  49 value -3.417398"                                  
 [51] "iter  50 value -3.417713"                                  
 [52] "iter  51 value -3.417926"                                  
 [53] "iter  52 value -3.418252"                                  
 [54] "iter  53 value -3.418453"                                  
 [55] "iter  54 value -3.418790"                                  
 [56] "iter  55 value -3.418977"                                  
 [57] "iter  56 value -3.419326"                                  
 [58] "iter  57 value -3.419500"                                  
 [59] "iter  58 value -3.419861"                                  
 [60] "iter  59 value -3.420021"                                  
 [61] "iter  60 value -3.420394"                                  
 [62] "iter  61 value -3.420540"                                  
 [63] "iter  62 value -3.420926"                                  
 [64] "iter  63 value -3.421057"                                  
 [65] "iter  64 value -3.421457"                                  
 [66] "iter  65 value -3.421573"                                  
 [67] "iter  66 value -3.421986"                                  
 [68] "iter  67 value -3.422087"                                  
 [69] "iter  68 value -3.422514"                                  
 [70] "iter  69 value -3.422599"                                  
 [71] "iter  70 value -3.423040"                                  
 [72] "iter  71 value -3.423109"                                  
 [73] "iter  72 value -3.423565"                                  
 [74] "iter  73 value -3.423618"                                  
 [75] "iter  74 value -3.424088"                                  
 [76] "iter  75 value -3.424124"                                  
 [77] "iter  76 value -3.424609"                                  
 [78] "iter  77 value -3.424629"                                  
 [79] "iter  78 value -3.425129"                                  
 [80] "iter  79 value -3.425132"                                  
 [81] "iter  80 value -3.425648"                                  
 [82] "iter  81 value -3.425718"                                  
 [83] "iter  82 value -3.425755"                                  
 [84] "iter  83 value -3.425771"                                  
 [85] "iter  84 value -3.426276"                                  
 [86] "iter  85 value -3.426347"                                  
 [87] "iter  86 value -3.426381"                                  
 [88] "iter  87 value -3.426462"                                  
 [89] "iter  88 value -3.426486"                                  
 [90] "iter  89 value -3.426568"                                  
 [91] "iter  90 value -3.426592"                                  
 [92] "iter  91 value -3.426673"                                  
 [93] "iter  92 value -3.426698"                                  
 [94] "iter  93 value -3.426779"                                  
 [95] "iter  94 value -3.426804"                                  
 [96] "iter  95 value -3.426884"                                  
 [97] "iter  96 value -3.426909"                                  
 [98] "iter  97 value -3.426990"                                  
 [99] "iter  98 value -3.427015"                                  
[100] "iter  99 value -3.427095"                                  
[101] "iter 100 value -3.427120"                                  
[102] "final  value -3.427120 "                                   
[103] "stopped after 100 iterations"                              
[104] "initial  value -2.699617 "                                 
[105] "iter   2 value -2.911025"                                  
[106] "iter   3 value -2.942243"                                  
[107] "iter   4 value -2.953901"                                  
[108] "iter   5 value -3.013882"                                  
[109] "iter   6 value -3.055169"                                  
[110] "iter   7 value -3.062883"                                  
[111] "iter   8 value -3.116825"                                  
[112] "iter   9 value -3.124528"                                  
[113] "iter  10 value -3.158764"                                  
[114] "iter  11 value -3.169523"                                  
[115] "iter  12 value -3.179768"                                  
[116] "iter  13 value -3.179821"                                  
[117] "iter  14 value -3.180894"                                  
[118] "iter  15 value -3.183756"                                  
[119] "iter  16 value -3.184007"                                  
[120] "iter  17 value -3.185137"                                  
[121] "iter  18 value -3.186624"                                  
[122] "iter  19 value -3.187004"                                  
[123] "iter  20 value -3.187024"                                  
[124] "iter  21 value -3.187026"                                  
[125] "iter  21 value -3.187026"                                  
[126] "iter  21 value -3.187026"                                  
[127] "final  value -3.187026 "                                   
[128] "converged"                                                 
[129] "&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;"                              
[130] " "                                                         
[131] "Coefficients: "                                            
[132] "      Estimate     SE t.value p.value"                     
[133] "ar1     1.2162 0.2088  5.8237  0.0000"                     
[134] "ar2    -0.8495 0.1514 -5.6129  0.0000"                     
[135] "ma1    -1.1512 0.5411 -2.1277  0.0504"                     
[136] "ma2     0.1512 0.5189  0.2915  0.7747"                     
[137] "xmean   0.0007 0.0021  0.3500  0.7312"                     
[138] ""                                                          
[139] "sigma^2 estimated as 0.001317917 on 15 degrees of freedom "
[140] " "                                                         
[141] "AIC = -2.936175  AICc = -2.72189  BIC = -2.637456 "        
[142] " "                                                         </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit_em, <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "initial  value -2.651140 "                                 
  [2] "iter   2 value -2.905712"                                  
  [3] "iter   3 value -2.915018"                                  
  [4] "iter   4 value -2.932119"                                  
  [5] "iter   5 value -2.958665"                                  
  [6] "iter   6 value -2.986696"                                  
  [7] "iter   7 value -3.018482"                                  
  [8] "iter   8 value -3.083446"                                  
  [9] "iter   9 value -3.094075"                                  
 [10] "iter  10 value -3.097043"                                  
 [11] "iter  11 value -3.097922"                                  
 [12] "iter  12 value -3.234201"                                  
 [13] "iter  13 value -3.299118"                                  
 [14] "iter  14 value -3.321504"                                  
 [15] "iter  15 value -3.350087"                                  
 [16] "iter  16 value -3.361102"                                  
 [17] "iter  17 value -3.374836"                                  
 [18] "iter  18 value -3.377059"                                  
 [19] "iter  19 value -3.380334"                                  
 [20] "iter  20 value -3.383157"                                  
 [21] "iter  21 value -3.383197"                                  
 [22] "iter  22 value -3.399364"                                  
 [23] "iter  23 value -3.402564"                                  
 [24] "iter  23 value -3.402564"                                  
 [25] "iter  24 value -3.414677"                                  
 [26] "iter  24 value -3.414677"                                  
 [27] "iter  25 value -3.415728"                                  
 [28] "iter  26 value -3.415788"                                  
 [29] "iter  27 value -3.416127"                                  
 [30] "iter  28 value -3.416258"                                  
 [31] "iter  29 value -3.416470"                                  
 [32] "iter  30 value -3.416618"                                  
 [33] "iter  31 value -3.416804"                                  
 [34] "iter  32 value -3.416953"                                  
 [35] "iter  33 value -3.417136"                                  
 [36] "iter  34 value -3.417282"                                  
 [37] "iter  35 value -3.417467"                                  
 [38] "iter  36 value -3.417610"                                  
 [39] "iter  37 value -3.417798"                                  
 [40] "iter  38 value -3.417936"                                  
 [41] "iter  39 value -3.418129"                                  
 [42] "iter  40 value -3.418263"                                  
 [43] "iter  41 value -3.418460"                                  
 [44] "iter  42 value -3.418589"                                  
 [45] "iter  43 value -3.418790"                                  
 [46] "iter  44 value -3.418915"                                  
 [47] "iter  45 value -3.419121"                                  
 [48] "iter  46 value -3.419241"                                  
 [49] "iter  47 value -3.419451"                                  
 [50] "iter  48 value -3.419566"                                  
 [51] "iter  49 value -3.419781"                                  
 [52] "iter  50 value -3.419891"                                  
 [53] "iter  51 value -3.420111"                                  
 [54] "iter  52 value -3.420216"                                  
 [55] "iter  53 value -3.420441"                                  
 [56] "iter  54 value -3.420541"                                  
 [57] "iter  55 value -3.420771"                                  
 [58] "iter  56 value -3.420865"                                  
 [59] "iter  57 value -3.421100"                                  
 [60] "iter  58 value -3.421189"                                  
 [61] "iter  59 value -3.421429"                                  
 [62] "iter  60 value -3.421513"                                  
 [63] "iter  61 value -3.421758"                                  
 [64] "iter  62 value -3.421836"                                  
 [65] "iter  63 value -3.422087"                                  
 [66] "iter  64 value -3.422160"                                  
 [67] "iter  65 value -3.422415"                                  
 [68] "iter  66 value -3.422483"                                  
 [69] "iter  67 value -3.422744"                                  
 [70] "iter  68 value -3.422805"                                  
 [71] "iter  69 value -3.423072"                                  
 [72] "iter  70 value -3.423128"                                  
 [73] "iter  71 value -3.423400"                                  
 [74] "iter  72 value -3.423449"                                  
 [75] "iter  73 value -3.423727"                                  
 [76] "iter  74 value -3.423771"                                  
 [77] "iter  75 value -3.424055"                                  
 [78] "iter  76 value -3.424092"                                  
 [79] "iter  77 value -3.424382"                                  
 [80] "iter  78 value -3.424413"                                  
 [81] "iter  79 value -3.424708"                                  
 [82] "iter  80 value -3.424734"                                  
 [83] "iter  81 value -3.425035"                                  
 [84] "iter  82 value -3.425054"                                  
 [85] "iter  83 value -3.425361"                                  
 [86] "iter  84 value -3.425374"                                  
 [87] "iter  85 value -3.425687"                                  
 [88] "iter  86 value -3.425694"                                  
 [89] "iter  87 value -3.426013"                                  
 [90] "iter  88 value -3.426062"                                  
 [91] "iter  89 value -3.426079"                                  
 [92] "iter  90 value -3.426079"                                  
 [93] "iter  91 value -3.426410"                                  
 [94] "iter  92 value -3.426460"                                  
 [95] "iter  93 value -3.426476"                                  
 [96] "iter  94 value -3.426528"                                  
 [97] "iter  95 value -3.426543"                                  
 [98] "iter  96 value -3.426595"                                  
 [99] "iter  97 value -3.426610"                                  
[100] "iter  98 value -3.426662"                                  
[101] "iter  99 value -3.426677"                                  
[102] "iter 100 value -3.426729"                                  
[103] "final  value -3.426729 "                                   
[104] "stopped after 100 iterations"                              
[105] "initial  value -2.699617 "                                 
[106] "iter   2 value -2.935051"                                  
[107] "iter   3 value -2.947145"                                  
[108] "iter   4 value -2.958274"                                  
[109] "iter   5 value -2.990007"                                  
[110] "iter   6 value -3.044065"                                  
[111] "iter   7 value -3.069038"                                  
[112] "iter   8 value -3.086065"                                  
[113] "iter   9 value -3.108245"                                  
[114] "iter  10 value -3.117474"                                  
[115] "iter  11 value -3.121246"                                  
[116] "iter  12 value -3.160135"                                  
[117] "iter  13 value -3.177161"                                  
[118] "iter  14 value -3.182063"                                  
[119] "iter  15 value -3.183726"                                  
[120] "iter  16 value -3.184448"                                  
[121] "iter  17 value -3.184590"                                  
[122] "iter  18 value -3.184621"                                  
[123] "iter  19 value -3.184621"                                  
[124] "iter  19 value -3.184621"                                  
[125] "final  value -3.184621 "                                   
[126] "converged"                                                 
[127] "&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;"                              
[128] " "                                                         
[129] "Coefficients: "                                            
[130] "      Estimate     SE t.value p.value"                     
[131] "ar1     1.1617 0.1334  8.7077  0.0000"                     
[132] "ar2    -0.8128 0.1240 -6.5545  0.0000"                     
[133] "ma1    -1.0000 0.1476 -6.7744  0.0000"                     
[134] "xmean   0.0006 0.0023  0.2703  0.7904"                     
[135] ""                                                          
[136] "sigma^2 estimated as 0.001347482 on 16 degrees of freedom "
[137] " "                                                         
[138] "AIC = -3.031366  AICc = -2.898033  BIC = -2.782433 "       
[139] " "                                                         </code></pre>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>Based on the results of cross-validation, we can see that the <code>ARMA(2,1)</code> model has a lower RMSE value compared to the ARMA(2,2) model in most of the time. Therefore, we can say that the ARMA(2,1) model is the better model to forecast.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(res.fit_em)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co"># Assuming 5 is the maximum number of observations for testing</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="dv">8</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="dv">8</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">tsp</span>(res.fit_em)[<span class="dv">1</span>] <span class="sc">+</span> (k <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the training set</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  train_end <span class="ot">&lt;-</span> st <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  xtrain <span class="ot">&lt;-</span> <span class="fu">window</span>(res.fit_em, <span class="at">end =</span> train_end)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the testing set</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  test_start <span class="ot">&lt;-</span> train_end <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  test_end <span class="ot">&lt;-</span> <span class="fu">min</span>(st <span class="sc">+</span> i, <span class="fu">tsp</span>(res.fit_em)[<span class="dv">2</span>])</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  xtest <span class="ot">&lt;-</span> <span class="fu">window</span>(res.fit_em, <span class="at">start =</span> test_start, <span class="at">end =</span> test_end)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">include.drift =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> <span class="dv">4</span>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">include.drift =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">"ML"</span>)</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  fcast2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit2, <span class="at">h =</span> <span class="dv">4</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  rmse1[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((fcast<span class="sc">$</span>mean <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  rmse2[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((fcast2<span class="sc">$</span>mean <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, rmse2, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">"horizon"</span>, <span class="at">ylab =</span> <span class="st">"RMSE"</span>)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, rmse1, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">3</span>)</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"fit2"</span>, <span class="st">"fit1"</span>), <span class="at">col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/cross_validation_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<p>The forecast, with ARMA(2,1) error terms, indicates that average life expectancy in the US is expected to continue increasing, but with a degree of uncertainty, as represented by the widening confidence intervals. This suggests optimism about future health outcomes. As we can see, the death rates due to cancer, heart disease, and diabetes are decreasing, and the infant mortality rate is also decreasing, which could be reasons for the increase in life expectancy. What’s more, we can find from Question 2 that the number of smokers and the alcohol consumption rate are decreasing, which could also increase the life expectancy in the US. Meanwhile, we can see a decrease of average life expectancy around 2020, which could be due to the COVID-19 pandemic.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fit_em <span class="ot">&lt;-</span> <span class="fu">Arima</span>(life_expectancy_mortality_ts[, <span class="st">"Life_Expectancy"</span>], <span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xreg =</span> life_expectancy_mortality_ts[, <span class="fu">c</span>(<span class="st">'Death_Cancer'</span>, <span class="st">'Death_Heart_Disease'</span>, <span class="st">'Death_Diabetes'</span>, <span class="st">'Infant_Mortality_Rates'</span>)])</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_em)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: life_expectancy_mortality_ts[, "Life_Expectancy"] 
Regression with ARIMA(2,0,1) errors 

Coefficients:
         ar1      ar2      ma1  intercept  Death_Cancer  Death_Heart_Disease
      1.3451  -0.9196  -1.0000    85.5236        0.0017              -0.0146
s.e.  0.0955   0.0669   0.1408     0.2952        0.0056               0.0016
      Death_Diabetes  Infant_Mortality_Rates
             -0.1386                 -0.2536
s.e.          0.0220                  0.1511

sigma^2 = 0.0014:  log likelihood = 39.31
AIC=-60.63   AICc=-42.63   BIC=-51.66

Training set error measures:
                       ME       RMSE        MAE         MPE       MAPE
Training set 0.0008543314 0.02897839 0.02014405 0.001093736 0.02571722
                  MASE       ACF1
Training set 0.1401967 -0.1625128</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cancer_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(life_expectancy_mortality_ts[, <span class="st">"Death_Cancer"</span>]) </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">forecast</span>(cancer_fit)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>heart_disease_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(life_expectancy_mortality_ts[, <span class="st">"Death_Heart_Disease"</span>])</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>ft2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(heart_disease_fit)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>diabetes_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(life_expectancy_mortality_ts[, <span class="st">"Death_Diabetes"</span>])</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>ft3 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(diabetes_fit)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>infant_mortality_fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(life_expectancy_mortality_ts[, <span class="st">"Infant_Mortality_Rates"</span>])</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>ft4 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(infant_mortality_fit)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">Cancer =</span> ft<span class="sc">$</span>mean,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">Heart_Disease =</span> ft2<span class="sc">$</span>mean,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">Diabetes =</span> ft3<span class="sc">$</span>mean,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">Infant_Mortality =</span> ft4<span class="sc">$</span>mean)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_em, <span class="at">xreg=</span>xreg)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fcast) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Average Life Expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/forecast_3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="will-the-us-average-life-expectancy-increase-with-prescription-drug-expenditure" class="level1">
<h1>4. Will the US Average Life Expectancy Increase with Prescription Drug Expenditure?</h1>
<p>There were previous research studies that showed the more rapid adoption of new drugs has substantial benefits in the form of increased life expectancy, higher productivity and lower non-drug health care expenditure <strong>(Baker, &amp; Fugh-Berman, 2009)</strong>. In this section, we will investigate the relationship between the average life expectancy in the US and the prescription drug expenditure.</p>
<ul>
<li><strong>(VAR) Average Life Expectancy ~ Prescription Drug Expenditure</strong></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Data Visualization</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">VARselect</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Initial Model Selection</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Cross-Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">Model Creation and Diagnostics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">Forecasting</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>The graph presents the trends of average life expectancy alongside prescription drug expenditure over the years. <code>Average Life expectancy</code> shows an increase over time until a sharp drop in 2020, which could be due to the COVID-19 pandemic. The <code>prescription drug expenditure</code> appears to have a consistent upward trend, indicating growing costs or increased consumption of medications.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>healthcare_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(healthcare_data[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2005</span>), <span class="at">end =</span> <span class="dv">2023</span>, <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(healthcare_ts, <span class="at">facets =</span> <span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"#27aeef"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Life Expectancy vs Health Insurance Coverage and Prescription Drug Expenditure"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/data_visualization_4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>The <code>VARselect</code> function is used to select the optimal <code>p</code> for the VAR model. From the results, we can see that the optimal <code>p</code> are 3 and 4.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(healthcare_ts, <span class="at">lag.max =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     4      4      3      3 

$criteria
               1         2         3         4
AIC(n)  3.417688  3.013839  2.712314  2.545620
HQ(n)   3.413665  3.007805  2.704269  2.535564
SC(n)   3.795314  3.580279  3.467567  3.489687
FPE(n) 31.315351 22.385979 19.262274 22.149823</code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>Based on the <code>VARselect</code> results, we fit the VAR model with <code>p=3</code> and <code>p=4</code> to the dataset. And the <code>VAR(3)</code> model is better, based on the residual errors and number of significant variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitvar4<span class="ot">&lt;-</span>vars<span class="sc">::</span><span class="fu">VAR</span>(healthcare_ts, <span class="at">p=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: Life_Expectancy, Prescription_Drug_Expenditure 
Deterministic variables: both 
Sample size: 16 
Log Likelihood: -51.578 
Roots of the characteristic polynomial:
 1.12  1.12 1.096 0.8173 0.8173 0.0876
Call:
vars::VAR(y = healthcare_ts, p = 3, type = "both")


Estimation results for equation Life_Expectancy: 
================================================ 
Life_Expectancy = Life_Expectancy.l1 + Prescription_Drug_Expenditure.l1 + Life_Expectancy.l2 + Prescription_Drug_Expenditure.l2 + Life_Expectancy.l3 + Prescription_Drug_Expenditure.l3 + const + trend 

                                  Estimate Std. Error t value Pr(&gt;|t|)  
Life_Expectancy.l1                0.555793   0.299310   1.857   0.1004  
Prescription_Drug_Expenditure.l1 -0.015476   0.017402  -0.889   0.3998  
Life_Expectancy.l2               -0.717527   0.374989  -1.913   0.0920 .
Prescription_Drug_Expenditure.l2  0.018246   0.019666   0.928   0.3807  
Life_Expectancy.l3                1.316801   0.540176   2.438   0.0407 *
Prescription_Drug_Expenditure.l3 -0.007517   0.008621  -0.872   0.4086  
const                            -9.771491  40.477954  -0.241   0.8153  
trend                            -0.084929   0.166056  -0.511   0.6229  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 0.432 on 8 degrees of freedom
Multiple R-Squared: 0.7032, Adjusted R-squared: 0.4435 
F-statistic: 2.707 on 7 and 8 DF,  p-value: 0.09318 


Estimation results for equation Prescription_Drug_Expenditure: 
============================================================== 
Prescription_Drug_Expenditure = Life_Expectancy.l1 + Prescription_Drug_Expenditure.l1 + Life_Expectancy.l2 + Prescription_Drug_Expenditure.l2 + Life_Expectancy.l3 + Prescription_Drug_Expenditure.l3 + const + trend 

                                   Estimate Std. Error t value Pr(&gt;|t|)   
Life_Expectancy.l1                 -9.23836    4.72385  -1.956  0.08623 . 
Prescription_Drug_Expenditure.l1    0.75815    0.27465   2.760  0.02466 * 
Life_Expectancy.l2                 -6.59986    5.91825  -1.115  0.29715   
Prescription_Drug_Expenditure.l2   -0.76668    0.31038  -2.470  0.03870 * 
Life_Expectancy.l3                 -4.37751    8.52532  -0.513  0.62150   
Prescription_Drug_Expenditure.l3    0.08615    0.13606   0.633  0.54428   
const                            1745.30910  638.84243   2.732  0.02577 * 
trend                               9.84516    2.62077   3.757  0.00557 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 6.819 on 8 degrees of freedom
Multiple R-Squared: 0.9903, Adjusted R-squared: 0.9817 
F-statistic: 116.3 on 7 and 8 DF,  p-value: 2.065e-07 



Covariance matrix of residuals:
                              Life_Expectancy Prescription_Drug_Expenditure
Life_Expectancy                        0.1867                       -0.1631
Prescription_Drug_Expenditure         -0.1631                       46.4947

Correlation matrix of residuals:
                              Life_Expectancy Prescription_Drug_Expenditure
Life_Expectancy                       1.00000                      -0.05536
Prescription_Drug_Expenditure        -0.05536                       1.00000</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitvar5<span class="ot">&lt;-</span>vars<span class="sc">::</span><span class="fu">VAR</span>(healthcare_ts, <span class="at">p=</span><span class="dv">4</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: Life_Expectancy, Prescription_Drug_Expenditure 
Deterministic variables: both 
Sample size: 15 
Log Likelihood: -41.66 
Roots of the characteristic polynomial:
1.318 1.318 1.054 1.016 1.016 0.8372 0.8372 0.06897
Call:
vars::VAR(y = healthcare_ts, p = 4, type = "both")


Estimation results for equation Life_Expectancy: 
================================================ 
Life_Expectancy = Life_Expectancy.l1 + Prescription_Drug_Expenditure.l1 + Life_Expectancy.l2 + Prescription_Drug_Expenditure.l2 + Life_Expectancy.l3 + Prescription_Drug_Expenditure.l3 + Life_Expectancy.l4 + Prescription_Drug_Expenditure.l4 + const + trend 

                                   Estimate Std. Error t value Pr(&gt;|t|)
Life_Expectancy.l1                2.893e-01  4.009e-01   0.722    0.503
Prescription_Drug_Expenditure.l1  1.229e-04  2.408e-02   0.005    0.996
Life_Expectancy.l2               -5.435e-01  4.431e-01  -1.227    0.275
Prescription_Drug_Expenditure.l2 -3.475e-03  2.733e-02  -0.127    0.904
Life_Expectancy.l3                2.897e-01  1.678e+00   0.173    0.870
Prescription_Drug_Expenditure.l3  2.069e-02  2.863e-02   0.723    0.502
Life_Expectancy.l4                1.450e+00  1.448e+00   1.001    0.363
Prescription_Drug_Expenditure.l4 -7.628e-03  1.050e-02  -0.727    0.500
const                            -3.715e+01  7.590e+01  -0.489    0.645
trend                            -2.966e-01  3.118e-01  -0.951    0.385


Residual standard error: 0.4636 on 5 degrees of freedom
Multiple R-Squared: 0.7767, Adjusted R-squared: 0.3749 
F-statistic: 1.933 on 9 and 5 DF,  p-value: 0.2422 


Estimation results for equation Prescription_Drug_Expenditure: 
============================================================== 
Prescription_Drug_Expenditure = Life_Expectancy.l1 + Prescription_Drug_Expenditure.l1 + Life_Expectancy.l2 + Prescription_Drug_Expenditure.l2 + Life_Expectancy.l3 + Prescription_Drug_Expenditure.l3 + Life_Expectancy.l4 + Prescription_Drug_Expenditure.l4 + const + trend 

                                  Estimate Std. Error t value Pr(&gt;|t|)  
Life_Expectancy.l1                -14.3214     5.3702  -2.667   0.0445 *
Prescription_Drug_Expenditure.l1    0.5250     0.3225   1.628   0.1645  
Life_Expectancy.l2                 -9.4113     5.9349  -1.586   0.1737  
Prescription_Drug_Expenditure.l2   -0.7647     0.3660  -2.089   0.0910 .
Life_Expectancy.l3                -47.2844    22.4822  -2.103   0.0894 .
Prescription_Drug_Expenditure.l3   -0.1577     0.3835  -0.411   0.6980  
Life_Expectancy.l4                 33.8285    19.4019   1.744   0.1417  
Prescription_Drug_Expenditure.l4   -0.1149     0.1406  -0.817   0.4510  
const                            3187.3370  1016.6616   3.135   0.0258 *
trend                              14.9545     4.1767   3.580   0.0159 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 6.209 on 5 degrees of freedom
Multiple R-Squared: 0.9944, Adjusted R-squared: 0.9843 
F-statistic: 98.59 on 9 and 5 DF,  p-value: 4.317e-05 



Covariance matrix of residuals:
                              Life_Expectancy Prescription_Drug_Expenditure
Life_Expectancy                        0.2149                       -0.5582
Prescription_Drug_Expenditure         -0.5582                       38.5562

Correlation matrix of residuals:
                              Life_Expectancy Prescription_Drug_Expenditure
Life_Expectancy                        1.0000                       -0.1939
Prescription_Drug_Expenditure         -0.1939                        1.0000</code></pre>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<p>The <code>cross-validation</code> is used to find the best model for forecasting. It selects <code>VAR(3)</code> as the best model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">=</span> <span class="dv">5</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>best_performance <span class="ot">&lt;-</span> <span class="cn">Inf</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>fold_s <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(healthcare_ts)<span class="sc">/</span>folds)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2022</span>),<span class="at">each =</span><span class="dv">1</span>) <span class="co">#year</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>folds){</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> (fold<span class="dv">-1</span>)<span class="sc">*</span>fold_s<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  end <span class="ot">&lt;-</span> fold<span class="sc">*</span>fold_s</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  train_model <span class="ot">&lt;-</span> healthcare_ts[<span class="sc">-</span>(start<span class="sc">:</span>end), ]</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  test_model <span class="ot">&lt;-</span> healthcare_ts[start<span class="sc">:</span>end, ]</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">VARselect</span>(train_model, <span class="at">lag.max =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"both"</span>)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  best_lag <span class="ot">&lt;-</span> sel<span class="sc">$</span>selection[<span class="dv">1</span>]</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the fit models</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">4</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(train_model, <span class="at">p=</span><span class="dv">3</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">nrow</span>(test_model)</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the prediction</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">n.ahead =</span> h)</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>  pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> h)</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>  pred_life <span class="ot">&lt;-</span> pred<span class="sc">$</span>fcst<span class="sc">$</span>Life_Expectancy[,<span class="dv">1</span>]</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>  pred_life2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fcst<span class="sc">$</span>Life_Expectancy[,<span class="dv">1</span>]</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_life <span class="sc">-</span> test_model[, <span class="st">"Life_Expectancy"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>  mse2 <span class="ot">&lt;-</span> <span class="fu">mean</span>((pred_life2 <span class="sc">-</span> test_model[, <span class="st">"Life_Expectancy"</span>])<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>  rmse1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse1, <span class="fu">data.frame</span>(<span class="at">Life_Expectancy =</span> <span class="fu">sqrt</span>(mse)))</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>  rmse2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rmse2, <span class="fu">data.frame</span>(<span class="at">Life_Expectancy =</span> <span class="fu">sqrt</span>(mse2)))</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mse <span class="sc">&lt;</span> best_performance){</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(mse2 <span class="sc">&lt;</span> best_performance){</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>    best_model <span class="ot">&lt;-</span> fit2</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>    best_performance <span class="ot">&lt;-</span> mse2</span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the RMSE of two models</span></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmse1<span class="sc">$</span>Life_Expectancy, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Fold"</span>, <span class="at">ylab =</span> <span class="st">"RMSE"</span>, <span class="at">main =</span> <span class="st">"RMSE of VAR(3) and VAR(4)"</span>)</span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(rmse2<span class="sc">$</span>Life_Expectancy, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"VAR(4)"</span>, <span class="st">"VAR(3)"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/cross_validation_4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<p>Model <code>VAR(3)</code> is a better fit without serial correlation, based on the low p-value and ACF plots. Model VAR(3) is then used to forecast the average life expectancy and prescription drug expenditure.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VAR(3)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>var_model_5 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(healthcare_ts, <span class="at">p=</span><span class="dv">3</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>life.serial <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_5, <span class="at">lags.pt =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>) </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>life.serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_5
Chi-squared = 11.835, df = 4, p-value = 0.01862</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(life.serial, <span class="at">names =</span> <span class="st">"Life_Expectancy"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(life.serial, <span class="at">names =</span> <span class="st">"Prescription_Drug_Expenditure"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VAR(4)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>var_model_6 <span class="ot">&lt;-</span> vars<span class="sc">::</span><span class="fu">VAR</span>(healthcare_ts, <span class="at">p=</span><span class="dv">4</span>, <span class="at">type=</span> <span class="st">"both"</span>, <span class="at">season =</span> <span class="cn">NULL</span>, <span class="at">exog =</span> <span class="cn">NULL</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>life_2.serial <span class="ot">&lt;-</span> <span class="fu">serial.test</span>(var_model_6, <span class="at">lags.pt =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"PT.asymptotic"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>life_2.serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (asymptotic)

data:  Residuals of VAR object var_model_6
Chi-squared = 30.728, df = 0, p-value &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(life_2.serial, <span class="at">names =</span> <span class="st">"Life_Expectancy"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(life_2.serial, <span class="at">names =</span> <span class="st">"Prescription_Drug_Expenditure"</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/best_model_residuals_4-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<p>The forecast plot shows the predicted values for <code>Life Expectancy</code> and <code>Prescription Drug Expenditure</code> for the next several years. The forecasted values are based on the <code>VAR(3)</code> model.</p>
<p>The <code>fanchart</code> for life expectancy suggests a first decrease and then an increase trend, while the prescription drug expenditure is expected to increase over the next several years. We can speculate that the decrease in life expectancy could be due to the COVID-19 pandemic, which has had a significant impact on public health. Then the prescription drug expenditure is expected to increase, which will cause a rise in average life expectancy. Our forecasting conclusion aligns perfectly with the previous research findings.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forecasting</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">fit.pr =</span> <span class="fu">predict</span>(fitvar4, <span class="at">n.ahead =</span> <span class="dv">10</span>, <span class="at">ci =</span> <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$Life_Expectancy
          fcst    lower    upper        CI
 [1,] 76.44938 75.60260 77.29617 0.8467877
 [2,] 74.53820 73.54215 75.53424 0.9960452
 [3,] 75.86014 74.83897 76.88131 1.0211716
 [4,] 75.13810 73.85523 76.42097 1.2828725
 [5,] 71.14905 69.42541 72.87268 1.7236337
 [6,] 71.22022 69.45785 72.98259 1.7623740
 [7,] 72.61743 70.83283 74.40203 1.7846038
 [8,] 67.67221 65.10940 70.23502 2.5628092
 [9,] 64.19359 61.53640 66.85077 2.6571863
[10,] 67.22979 64.51337 69.94621 2.7164196

$Prescription_Drug_Expenditure
          fcst    lower    upper       CI
 [1,] 422.2153 408.8509 435.5797 13.36441
 [2,] 432.9074 414.1659 451.6489 18.74149
 [3,] 465.8879 441.3460 490.4297 24.54183
 [4,] 502.0095 474.7731 529.2459 27.23641
 [5,] 521.1881 493.3974 548.9787 27.79063
 [6,] 556.5518 526.6893 586.4144 29.86255
 [7,] 610.4465 576.4960 644.3971 33.95058
 [8,] 639.7759 604.3627 675.1890 35.41315
 [9,] 669.7366 631.6595 707.8136 38.07708
[10,] 743.1114 698.6160 787.6068 44.49539</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fanchart</span>(fit.pr, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/forecast_4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="how-public-health-crisiscovid-19-influences-the-financial-market-of-healthcare" class="level1">
<h1>5. How Public Health Crisis(Covid-19) influences the financial market of Healthcare</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Data Visualization</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Auto ARIMA</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Model Fitting</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">Best Models Residuals</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false">Cross-Validation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-6" role="tab" aria-controls="tabset-5-6" aria-selected="false">Fit the Best Model</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-7" role="tab" aria-controls="tabset-5-7" aria-selected="false">Forecasting</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>covid_stock_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(covid_stock[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)], <span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)), <span class="at">frequency =</span> <span class="dv">365</span>) <span class="co"># Daily data</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(covid_stock_ts[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)], <span class="at">facets=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"#27aeef"</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Variables Influencing the Healthcare Financial Market"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/data_visualization_5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>The <code>Auto ARIMA</code> function suggest the best ARIMA model for the given data is ARIMA(0,1,0).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">TEVA =</span> covid_stock_ts[, <span class="st">"TEVA"</span>],</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">VRTX =</span> covid_stock_ts[, <span class="st">"VRTX"</span>],</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">SAGE =</span> covid_stock_ts[, <span class="st">"SAGE"</span>],</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_cases =</span> covid_stock_ts[, <span class="st">"new_cases"</span>])</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>fit_health_finance <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(covid_stock_ts[, <span class="st">"PFE"</span>], <span class="at">xreg =</span> xreg)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_health_finance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: covid_stock_ts[, "PFE"] 
Regression with ARIMA(0,1,0) errors 

Coefficients:
        drift    TEVA    VRTX     SAGE  new_cases
      -0.0041  0.3077  0.0424  -0.0192          0
s.e.   0.0049  0.1119  0.0063   0.0165          0

sigma^2 = 0.4624:  log likelihood = -619.49
AIC=1250.98   AICc=1251.12   BIC=1277.38

Training set error measures:
                      ME      RMSE       MAE          MPE     MAPE       MASE
Training set 3.78327e-05 0.6765729 0.4705595 -0.005928339 1.084673 0.05370965
                    ACF1
Training set -0.02671866</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residuals</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_health_finance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_TS_model_files/figure-html/auto_arima_5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(0,1,0) errors
Q* = 239.51, df = 121, p-value = 8.155e-10

Model df: 0.   Total lags used: 121</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p>I first created a regression of the stock price of Pfizer(PFE) with the stock prices of Vertex Pharmaceuticals(VRTX), Teva Pharmaceutical Industries(TEVA), Sage Therapeutics(SAGE), and the new cases of Covid-19. Then I examined the residuals and fitted the models manually to find the best model based on AIC, BIC, and AICc. Next, I checked the models by doing cross-validation.</p>
<p>After fitting the models manually, I found that the best model is SARIMA(2,0,1)(0,1,0)[365] and SARIMA(1,0,0)(0,1,0)[365] based on AIC, BIC, and AICc.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the data to time series</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>covid_stock<span class="sc">$</span>SPFE<span class="ot">&lt;-</span><span class="fu">ts</span>(covid_stock<span class="sc">$</span>PFE,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>covid_stock<span class="sc">$</span>VRTX<span class="ot">&lt;-</span><span class="fu">ts</span>(covid_stock<span class="sc">$</span>VRTX,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>covid_stock<span class="sc">$</span>TEVA<span class="ot">&lt;-</span><span class="fu">ts</span>(covid_stock<span class="sc">$</span>TEVA,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>covid_stock<span class="sc">$</span>SAGE<span class="ot">&lt;-</span><span class="fu">ts</span>(covid_stock<span class="sc">$</span>SAGE,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>covid_stock<span class="sc">$</span>new_cases<span class="ot">&lt;-</span><span class="fu">ts</span>(covid_stock<span class="sc">$</span>new_cases,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="do">############# First fit the linear model##########</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>fit.reg_health_finance <span class="ot">&lt;-</span> <span class="fu">lm</span>(PFE <span class="sc">~</span> VRTX <span class="sc">+</span> TEVA <span class="sc">+</span> SAGE <span class="sc">+</span> new_cases, <span class="at">data=</span>covid_stock)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg_health_finance)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg_health_finance), <span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-14"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(res.fit, <span class="at">lag.max =</span> <span class="dv">30</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(res.fit, <span class="at">lag.max =</span> <span class="dv">30</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co"># We have to difference the data</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>(<span class="dv">365</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtsdisplay</span>()</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual Fitting the models</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="co">#p=8, q=8, d=2, P=1, Q=1, D=1, s=365</span></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>SARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,P1,Q1,d1,d2,data){</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  D<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>  s<span class="ot">=</span><span class="dv">365</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>  ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">9</span><span class="sc">*</span><span class="dv">42</span>),<span class="at">nrow=</span><span class="dv">42</span>)</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(P <span class="cf">in</span> P1<span class="sc">:</span>P1)</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(Q <span class="cf">in</span> Q1<span class="sc">:</span>Q1)</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(d <span class="cf">in</span> d1<span class="sc">:</span>d2)</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">+</span>P<span class="sc">+</span>D<span class="sc">+</span>Q<span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>            model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">seasonal=</span><span class="fu">c</span>(P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>))</span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>            ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,P<span class="dv">-1</span>,D,Q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>            i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print(i)</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>  temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"P"</span>,<span class="st">"D"</span>,<span class="st">"Q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>  temp</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a><span class="do">##q=1,3 Q=1 , p=1,2, P=1,2 d=0,1 </span></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>output<span class="ot">=</span><span class="fu">SARIMA.c</span>(<span class="at">p1=</span><span class="dv">1</span>,<span class="at">p2=</span><span class="dv">8</span>,<span class="at">q1=</span><span class="dv">1</span>,<span class="at">q2=</span><span class="dv">8</span>,<span class="at">P1=</span><span class="dv">1</span>,<span class="at">Q1=</span><span class="dv">1</span>,<span class="at">d1=</span><span class="dv">0</span>,<span class="at">d2=</span><span class="dv">1</span>,<span class="at">data=</span>res.fit)</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a><span class="co">#output</span></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),]</span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'----------------------------BEST MODEL----------------------------------------------'</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the order and include the seasonal components for the best model</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>model_output_health_finance_best <span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period=</span><span class="dv">365</span>),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_output_health_finance_best)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'--------------------------SECOND BEST MODEL------------------------------------------'</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the order and include the seasonal components for the second best model</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>model_output_health_finance_second_best <span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period=</span><span class="dv">365</span>),</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_output_health_finance_second_best)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>len <span class="ot">&lt;-</span> <span class="fu">length</span>(res.fit)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>train_size <span class="ot">&lt;-</span> len <span class="sc">-</span> x</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">tsp</span>(res.fit)[<span class="dv">1</span>]<span class="sc">+</span>(<span class="dv">292-1</span>)<span class="sc">/</span><span class="dv">365</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store the forecast errors</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>errors1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(x)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>errors2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(x)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the forecast horizon</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>x) {</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  train_ts <span class="ot">&lt;-</span> <span class="fu">window</span>(res.fit, <span class="at">end=</span><span class="fu">c</span>(st <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>                                                                              model1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>                                                                                              <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period=</span><span class="dv">365</span>),</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>                                                                                              <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>                                                                                                </span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  model2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seasonal=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">period=</span><span class="dv">365</span>),</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>  forecast1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model1, <span class="at">h=</span><span class="dv">2</span>)</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>  forecast2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(model2, <span class="at">h=</span><span class="dv">2</span>)</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>  errors1[i] <span class="ot">&lt;-</span> res.fit[train_size <span class="sc">+</span> i] <span class="sc">-</span> forecast1<span class="sc">$</span>mean</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>  errors2[i] <span class="ot">&lt;-</span> res.fit[train_size <span class="sc">+</span> i] <span class="sc">-</span> forecast2<span class="sc">$</span>mean</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RMSE for each model</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(errors1<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(errors2<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for plotting</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>rmse_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span>x,</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE_Model1 =</span> <span class="fu">sqrt</span>(<span class="fu">cumsum</span>(errors1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">1</span><span class="sc">:</span>x),</span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE_Model2 =</span> <span class="fu">sqrt</span>(<span class="fu">cumsum</span>(errors2<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">1</span><span class="sc">:</span>x)</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="co">#print(paste("MAE Model 1:", mae_B))</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"RMSE Model 1:"</span>, rmse1))</span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="co">#print(paste("MAE Model 2:", mae_sB))</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"RMSE Model 2:"</span>, rmse2))</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compare models based on MAE and RMSE</span></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>compare_models <span class="ot">&lt;-</span> <span class="cf">function</span>(rmse1, rmse2) {</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (rmse1 <span class="sc">&lt;</span> rmse2) {</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Model 1 is better based on RMSE"</span>)</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rmse2 <span class="sc">&lt;</span> rmse1) {</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Model 2 is better based on RMSE"</span>)</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"The models perform differently across metrics. Further analysis is required."</span>)</span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparing the models</span></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">compare_models</span>(rmse1,rmse2)</span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt the data into long format</span></span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a>rmse_long <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(rmse_data, <span class="at">id.vars =</span> <span class="st">'Time'</span>, <span class="at">variable.name =</span> <span class="st">'Model'</span>, <span class="at">value.name =</span> <span class="st">'RMSE'</span>)</span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-64"><a href="#cb94-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the RMSE for both models</span></span>
<span id="cb94-65"><a href="#cb94-65" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rmse_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> RMSE, <span class="at">colour =</span> Model)) <span class="sc">+</span></span>
<span id="cb94-66"><a href="#cb94-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb94-67"><a href="#cb94-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RMSE Comparison Over Time"</span>, <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"RMSE"</span>) <span class="sc">+</span></span>
<span id="cb94-68"><a href="#cb94-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-6-tab">

</div>
<div id="tabset-5-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-7-tab">

</div>
</div>
</div>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>[1] Yousaf, I., Pham, L., &amp; Goodell, J. W. (2023). Interconnectedness between healthcare tokens and healthcare stocks: Evidence from a quantile VAR approach. International Review of Economics &amp; Finance, 86, 271-283. <a href="https://www.sciencedirect.com/science/article/pii/S1059056023000825">Available here</a></p>
<p>[2] Haydier, E. A., Albarwari, N. H. S., &amp; Ali, T. H. (2023). The Comparison Between VAR and ARIMAX Time Series Models in Forecasting. Iraqi Journal of Statistical Sciences, 20(2), 249-262. <a href="https://www.mosuljournals.com/article_181260.html">Available here</a></p>
<p>[3] Adu, W. K., Appiahene, P., &amp; Afrifa, S. (2023). VAR, ARIMAX and ARIMA models for nowcasting unemployment rate in Ghana using Google trends. Journal of Electrical Systems and Information Technology, 10(1), 12. <a href="https://link.springer.com/article/10.1186/s43067-023-00078-1">Available here</a></p>
<p>[4] Ulyah, S. M. (2019, July). Forecasting index and stock returns by considering the effect of Indonesia pre-presidential election 2019 using ARIMAX and VARX approches. In Journal of Physics: Conference Series (Vol. 1277, No.&nbsp;1, p.&nbsp;012053). IOP Publishing. <a href="https://iopscience.iop.org/article/10.1088/1742-6596/1277/1/012053/meta">Available here</a></p>
<p>[5] Baker, D., &amp; Fugh-Berman, A. (2009). Do new drugs increase life expectancy? A critique of a Manhattan Institute paper. Journal of general internal medicine, 24(5), 678–682. <a href="https://doi.org/10.1007/s11606-009-0954-4">Available here</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>